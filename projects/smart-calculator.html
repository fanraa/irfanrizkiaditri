<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Smart Calculator — irfanrizkiaditri.site</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg: #0d0d0f;
      --card: #141418;
      --text: #ffffff;
      --accent: #4fa3ff;
      --accent-2: #7c3aed;
      --muted: #9da3b3;
      --glass: rgba(255,255,255,0.06);
      --card-border: rgba(255,255,255,0.06);
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
    }
    
    [data-theme="light"] {
      --bg: #f6f8fb;
      --card: #ffffff;
      --text: #0b1220;
      --accent: #2563eb;
      --accent-2: #7c3aed;
      --muted: #6b7280;
      --glass: rgba(0,0,0,0.05);
      --card-border: rgba(0,0,0,0.08);
    }
    
    html {
      font-family: "Poppins", sans-serif;
      font-size: clamp(14px, 1.6vw, 16px);
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      transition: background 0.25s ease, color 0.25s ease;
      line-height: 1.6;
    }
    
    a {
      text-decoration: none;
      color: inherit;
    }
    
    .container {
      width: min(94%, 1200px);
      margin: 0 auto;
    }
    
    /* HEADER */
    header {
      position: sticky;
      top: 0;
      left: 0;
      width: 100%;
      backdrop-filter: blur(12px) saturate(1.5);
      background: linear-gradient(180deg, rgba(0,0,0,0.35), transparent);
      border-bottom: 1px solid var(--card-border);
      z-index: 1500;
    }
    
    .navbar {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 0;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 1.15rem;
    }
    
    .logo i { color: var(--accent); font-size: 1.2rem; }
    .logo span { color: var(--accent); }
    
    .nav-wrap {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    
    .nav-links {
      display: flex;
      gap: 20px;
      list-style: none;
    }
    
    .nav-links a {
      padding: 6px 10px;
      font-weight: 500;
      border-radius: 8px;
      position: relative;
      transition: 0.25s;
    }
    
    .nav-links a:hover,
    .nav-links .active {
      color: var(--accent);
      transform: translateY(-2px);
    }
    
    .nav-links a::after {
      content: "";
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0%;
      height: 2px;
      background: var(--accent);
      border-radius: 6px;
      transition: 0.28s;
    }
    
    .nav-links a:hover::after,
    .nav-links .active::after {
      width: 100%;
    }
    
    /* ... (CSS lainnya untuk theme toggle, hamburger, mobile menu) ... */
     .theme-toggle { cursor: pointer; display: flex; align-items: center; }
    .switch { width: 46px; height: 26px; background: var(--glass); border: 1px solid var(--card-border); border-radius: 20px; position: relative; padding: 3px; backdrop-filter: blur(5px); }
    .knob { width: 20px; height: 20px; background: #fff; border-radius: 50%; position: absolute; top: 3px; left: 3px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); transition: 0.25s; }
    [data-theme="light"] .switch { background: linear-gradient(90deg, var(--accent), var(--accent-2)); }
    [data-theme="light"] .knob { left: 23px; }
    .hamburger { display: none; background: none; border: 0; font-size: 1.25rem; color: var(--text); padding: 6px; }
    .mobile-menu { display: none; position: absolute; right: 14px; top: 72px; background: var(--card); border: 1px solid var(--card-border); border-radius: 14px; min-width: 220px; padding: 12px; box-shadow: 0 14px 28px rgba(0, 0, 0, 0.5); animation: fadeMenu 0.3s ease; }
    .mobile-menu a { display: block; padding: 10px; border-radius: 8px; transition: 0.25s; font-weight: 500; }
    .mobile-menu.open { display: block; }
    @keyframes fadeMenu { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }
    @media (max-width: 700px) { .nav-links { display: none; } .hamburger { display: inline-flex; } }

    /* MAIN CONTENT */
    main {
      padding: 40px 0;
    }
    
    .section-title {
      text-align: center;
      margin-bottom: 28px;
    }
    
    .section-title h2 {
      font-size: 1.8rem;
      margin-bottom: 6px;
    }
    
    .section-title p {
      color: var(--muted);
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* CALCULATOR STYLES */
    .calculator-container {
      display: flex;
      flex-direction: column;
      gap: 24px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .calculator-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 18px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(8px);
      padding: 24px;
      transition: 0.25s ease;
    }
    
    .calculator-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .calculator-title {
      font-size: 1.5rem;
      font-weight: 600;
    }
    
    .mode-toggle {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .mode-btn {
      flex: 1;
      padding: 12px;
      border: 1px solid var(--card-border);
      border-radius: 12px;
      background: var(--glass);
      cursor: pointer;
      text-align: center;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .mode-btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .calculator-display {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .calculator-expression {
      font-size: 1.2rem;
      color: var(--muted);
      min-height: 24px;
      word-break: break-all;
      text-align: right;
      overflow: hidden;
    }
    
    .calculator-result {
      font-size: 2.2rem;
      font-weight: 600;
      min-height: 48px;
      text-align: right;
      overflow: hidden;
    }
    
    .calculator-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    
    .calculator-btn {
      padding: 16px 0;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--glass);
      color: var(--text);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    
    .calculator-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }
    
    .calculator-btn:active {
      transform: translateY(0);
    }
    
    .calculator-btn.operator {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: white;
    }
    
    .calculator-btn.function {
      background: var(--glass);
      color: var(--accent);
    }
    
    .calculator-btn.equals {
      background: linear-gradient(135deg, var(--success), #059669);
      color: white;
    }
    
    .calculator-btn.clear {
      background: linear-gradient(135deg, var(--danger), #dc2626);
      color: white;
    }
    
    .calculator-btn.wide {
      grid-column: span 2;
    }
    
    .scientific-panel {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      margin-top: 20px;
      display: none;
    }
    
    .scientific-panel.active {
      display: grid;
    }
    
    .error-message {
      color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
      padding: 12px;
      border-radius: 12px;
      margin-top: 15px;
      text-align: center;
      display: none;
    }
    
    /* HISTORY & CONSTANTS */
    .history-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 10px;
      margin-bottom: 10px;
    }
    
    .history-item {
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }
    
    .history-item:hover {
      background: var(--glass);
    }
    
    .history-expression {
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    .history-result {
      font-weight: 500;
      font-size: 1.1rem;
    }
    
    .constants-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    
    .constant-btn {
      padding: 12px;
      background: var(--glass);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      cursor: pointer;
      transition: 0.2s;
    }
    
    .constant-btn:hover {
      background: var(--accent);
      color: white;
      transform: translateY(-2px);
    }
    
    /* TABS */
    .calculator-tabs {
      display: flex;
      border-bottom: 1px solid var(--card-border);
      margin-bottom: 20px;
    }
    
    .calculator-tab {
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      font-weight: 500;
    }
    
    .calculator-tab.active {
      border-bottom-color: var(--accent);
      color: var(--accent);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* FOOTER */
    footer {
      margin-top: 40px;
      padding: 20px 0;
      text-align: center;
      color: var(--muted);
    }
    
    #backToTop {
      position: fixed;
      right: 16px;
      bottom: 16px;
      background: var(--accent);
      color: white;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      z-index: 100;
    }
    
    @media (max-width: 768px) {
      .calculator-buttons, .scientific-panel {
        grid-template-columns: repeat(4, 1fr);
      }
      .calculator-btn { padding: 14px 0; font-size: 1rem; }
      .constants-grid { grid-template-columns: repeat(2, 1fr); }
    }
    
    @media (max-width: 480px) {
      .calculator-buttons, .scientific-panel {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
      }
      .calculator-btn { padding: 12px 0; font-size: 0.9rem; }
    }
  </style>
</head>
<body data-theme="dark">

  <header>
    <div class="container navbar">
      <a href="#" class="logo">
        <i class="fas fa-calculator"></i>
        <span>Smart</span>Calc
      </a>
      <div class="nav-wrap">
        <nav class="nav-links">
          <a href="#" class="active">Kalkulator</a>
          <a href="javascript:history.back()">Kembali</a>
        </nav>
        <div class="theme-toggle" id="themeToggle">
          <div class="switch">
            <div class="knob"></div>
          </div>
        </div>
        <button class="hamburger" id="hamburger" aria-label="Menu Toggle">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </div>
    <div class="mobile-menu" id="mobileMenu">
      <a href="#" class="active">Kalkulator</a>
      <a href="javascript:history.back()">Kembali</a>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="section-title">
        <h2>Smart Calculator</h2>
        <p>Kalkulator ilmiah, riwayat perhitungan, dan konstanta, semua dalam satu tempat.</p>
      </div>
      
      <div class="calculator-container">
        
        <div class="calculator-card">
          <div class="calculator-header">
            <h3 class="calculator-title">Kalkulator</h3>
       
          </div>
          
          <div class="mode-toggle">
            <button class="mode-btn active" data-mode="basic">Basic</button>
            <button class="mode-btn" data-mode="scientific">Scientific</button>
          </div>
          
          <div class="calculator-display">
            <div class="calculator-expression" id="expressionDisplay"></div>
            <div class="calculator-result" id="resultDisplay">0</div>
          </div>
          
          <div class="calculator-buttons" id="basicButtons">
            <button class="calculator-btn clear" data-action="clear">AC</button>
            <button class="calculator-btn function" data-action="backspace">DEL</button>
            <button class="calculator-btn operator" data-action="÷">÷</button>
            <button class="calculator-btn operator" data-action="×">×</button>
            
            <button class="calculator-btn" data-number="7">7</button>
            <button class="calculator-btn" data-number="8">8</button>
            <button class="calculator-btn" data-number="9">9</button>
            <button class="calculator-btn operator" data-action="-">−</button>
            
            <button class="calculator-btn" data-number="4">4</button>
            <button class="calculator-btn" data-number="5">5</button>
            <button class="calculator-btn" data-number="6">6</button>
            <button class="calculator-btn operator" data-action="+">+</button>
            
            <button class="calculator-btn" data-number="1">1</button>
            <button class="calculator-btn" data-number="2">2</button>
            <button class="calculator-btn" data-number="3">3</button>
            <button class="calculator-btn equals" data-action="=">=</button>
            
            <button class="calculator-btn wide" data-number="0">0</button>
            <button class="calculator-btn" data-action=".">.</button>
          </div>
          
          <div class="scientific-panel" id="scientificButtons">
            <button class="calculator-btn function" data-func="sin">sin</button>
            <button class="calculator-btn function" data-func="cos">cos</button>
            <button class="calculator-btn function" data-func="tan">tan</button>
            <button class="calculator-btn function" data-func="log">log</button>
            <button class="calculator-btn function" data-func="ln">ln</button>
            <button class="calculator-btn function" data-func="asin">asin</button>
            <button class="calculator-btn function" data-func="acos">acos</button>
            <button class="calculator-btn function" data-func="atan">atan</button>
            <button class="calculator-btn function" data-func="sqrt">√</button>
            <button class="calculator-btn function" data-func="pow">x^y</button>
            <button class="calculator-btn function" data-func="pi">π</button>
            <button class="calculator-btn function" data-func="e">e</button>
            <button class="calculator-btn function" data-func="fact">x!</button>
            <button class="calculator-btn function" data-func="percent">%</button>
            <button class="calculator-btn function" data-func="abs">|x|</button>
            <button class="calculator-btn function" data-func="(">(</button>
            <button class="calculator-btn function" data-func=")">)</button>
            <button class="calculator-btn function" data-func="deg">deg</button>
            <button class="calculator-btn function" data-func="rad">rad</button>
            <button class="calculator-btn function" data-func="rand">rand</button>
            
            <button class="calculator-btn function" data-func="mc">MC</button>
            <button class="calculator-btn function" data-func="mr">MR</button>
            <button class="calculator-btn function" data-func="m-plus">M+</button>
            <button class="calculator-btn function" data-func="m-minus">M-</button>
            <button class="calculator-btn function" data-func="ans">Ans</button> </div>
          
          <div class="error-message" id="errorMessage"></div>
        </div>
        
        <div class="calculator-card">
          <div class="calculator-tabs">
            <div class="calculator-tab active" data-tab="history">Riwayat</div>
            <div class="calculator-tab" data-tab="constants">Konstanta</div>
          </div>
          
          <div id="tab-history" class="tab-content active">
            <h3 class="calculator-title" style="margin-bottom: 20px;">Riwayat Perhitungan</h3>
            <div class="history-list" id="historyList">
              </div>
            <button class="calculator-btn clear" id="clearHistory" style="width: 100%;">Bersihkan Riwayat</button>
          </div>
          
          <div id="tab-constants" class="tab-content">
            <h3 class="calculator-title" style="margin-bottom: 20px;">Konstanta Matematika</h3>
            <div class="constants-grid">
              <button class="constant-btn" data-const="pi">π (Pi)</button>
              <button class="constant-btn" data-const="e">e (Euler)</button>
              <button class="constant-btn" data-const="phi">φ (Golden Ratio)</button>
              <button class="constant-btn" data-const="c">c (Speed of Light)</button>
              <button class="constant-btn" data-const="g">g (Gravity)</button>
              <button class="constant-btn" data-const="G">G (Grav. Constant)</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 - irfanrizkiaditri.site</p>
    </div>
  </footer>

  <a href="#" id="backToTop" aria-label="Back to top">
    <i class="fas fa-arrow-up"></i>
  </a>

<script>
    // =========================================================
    // BAGIAN 1: DOM ELEMENTS & STATE
    // =========================================================
    
    // DOM Elements
    const expressionDisplay = document.getElementById('expressionDisplay');
    const resultDisplay = document.getElementById('resultDisplay');
    const errorMessage = document.getElementById('errorMessage');
    const basicButtons = document.getElementById('basicButtons');
    const scientificButtons = document.getElementById('scientificButtons');
    const modeButtons = document.querySelectorAll('.mode-btn');
    const tabs = document.querySelectorAll('.calculator-tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const historyList = document.getElementById('historyList');
    const clearHistoryBtn = document.getElementById('clearHistory');
    const themeToggle = document.getElementById('themeToggle');
    const calcThemeToggle = document.getElementById('calcThemeToggle');
    const constantsGrid = document.querySelector('.constants-grid');
    const body = document.body;
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobileMenu');
    const backToTop = document.getElementById('backToTop');
    
    // State Variables (LOGIKA BARU)
    let currentExpression = ''; // String ekspresi yang akan dievaluasi
    let inputDisplay = '0';     // String yang tampil di layar hasil (angka saat ini)
    let lastResult = '';        // Menyimpan hasil perhitungan terakhir (untuk 'Ans')
    let useRadians = true;      // Mode sudut (true=Radian, false=Degree)
    let memoryValue = 0;        // [FITUR BARU] Nilai memori
    let calculationHistory = JSON.parse(localStorage.getItem('calculator_history') || '[]');

    const constants = {
      pi: Math.PI,
      e: Math.E,
      phi: 1.61803398875,
      c: 299792458,
      g: 9.80665,
      G: 6.67430e-11
    };
    
    // =========================================================
    // BAGIAN 2: FUNGSI INTI KALKULATOR (LOGIKA BARU)
    // =========================================================

    // Fungsi untuk memperbarui tampilan
    function updateDisplay() {
      expressionDisplay.textContent = currentExpression;
      resultDisplay.textContent = inputDisplay;
    }

    // Menangani penekanan tombol angka
    function appendNumber(num) {
      if (inputDisplay === '0' || inputDisplay === lastResult) {
        inputDisplay = num;
      } else {
        inputDisplay += num;
      }
      currentExpression += num;
      updateDisplay();
    }
    
    // Menangani penekanan tombol operator (+, -, ×, ÷)
    function appendOperator(op) {
      let expr = currentExpression.trim();
      const lastChar = expr.slice(-1);

      // [PERBAIKAN LOGIKA] Jika karakter terakhir adalah operator, ganti operator tsb
      if (['+', '-', '×', '÷'].includes(lastChar)) {
        expr = expr.slice(0, -1).trim();
      }

      currentExpression = expr + ' ' + op + ' ';
      inputDisplay = '0'; // Siap menerima angka baru
      updateDisplay();
    }
    
    // Menangani penekanan tombol fungsi (sin, log, pi, dll)
    function appendFunction(func) {
      switch (func) {
        case 'deg':
          useRadians = false;
          showError('Mode: Derajat (Degrees)');
          break;
        case 'rad':
          useRadians = true;
          showError('Mode: Radian');
          break;
        case 'pi':
          currentExpression += 'π';
          inputDisplay = '3.14159...';
          break;
        case 'e':
          currentExpression += 'e';
          inputDisplay = '2.71828...';
          break;
        case 'sqrt': currentExpression += '√('; break;
        case 'log': currentExpression += 'log('; break;
        case 'ln': currentExpression += 'ln('; break;
        case 'pow': currentExpression += '^('; break;
        case 'fact': currentExpression += '!'; break;
        case 'percent': currentExpression += '%'; break;
        case 'abs': currentExpression += 'abs('; break;
        case 'rand':
          const rand = Math.random();
          currentExpression += rand;
          inputDisplay = rand.toString();
          break;
        case '(': currentExpression += '('; break;
        case ')': currentExpression += ')'; break;
        
        // [FITUR BARU] Logika Memori
        case 'mc':
          memoryValue = 0;
          showError('Memori dibersihkan');
          break;
        case 'mr':
          currentExpression += memoryValue;
          inputDisplay = memoryValue.toString();
          break;
        case 'm-plus':
          let valMPlus = parseFloat(inputDisplay) || 0;
          memoryValue += valMPlus;
          showError(`Memori + ${valMPlus}`);
          break;
        case 'm-minus':
          let valMMinus = parseFloat(inputDisplay) || 0;
          memoryValue -= valMMinus;
          showError(`Memori - ${valMMinus}`);
          break;
        case 'ans':
          currentExpression += lastResult;
          inputDisplay = lastResult;
          break;
        default:
          currentExpression += `${func}(`;
      }
      if (!['deg', 'rad', 'mc', 'mr', 'm-plus', 'm-minus'].includes(func)) {
        updateDisplay();
      }
    }
    
    // Menangani tombol aksi (AC, DEL, ., =)
    function handleAction(action) {
      switch (action) {
        case 'clear':
          currentExpression = '';
          inputDisplay = '0';
          lastResult = '';
          break;
        case 'backspace':
          // Menghapus dari ekspresi dan input display
          currentExpression = currentExpression.trim();
          if (currentExpression.slice(-1) === ' ') { // Hapus ' op '
            currentExpression = currentExpression.slice(0, -3);
          } else { // Hapus angka/fungsi
            currentExpression = currentExpression.slice(0, -1);
          }
          
          // Reset input display
          const parts = currentExpression.split(' ');
          inputDisplay = parts[parts.length - 1] || '0';
          break;
        case '.':
          if (!inputDisplay.includes('.')) {
            if (inputDisplay === '0' || inputDisplay === lastResult) {
              inputDisplay = '0.';
              currentExpression += '0.';
            } else {
              inputDisplay += '.';
              currentExpression += '.';
            }
          }
          break;
        case '=':
          calculate();
          break;
      }
      updateDisplay();
    }
    
    // Fungsi perhitungan utama
    function calculate() {
      // [PERBAIKAN LOGIKA] Cek kurung
      const openParen = (currentExpression.match(/\(/g) || []).length;
      const closeParen = (currentExpression.match(/\)/g) || []).length;
      if (openParen !== closeParen) {
        showError('Error: Kurung tidak seimbang!');
        return;
      }

      // [PERBAIKAN LOGIKA] Membersihkan operator di akhir
      let exprToEval = currentExpression.trim();
      if (['+', '-', '×', '÷'].includes(exprToEval.slice(-1))) {
        exprToEval = exprToEval.slice(0, -1).trim();
      }
      
      if (exprToEval === '') return;

      try {
        const result = evaluateExpression(exprToEval);
        
        lastResult = result.toString(); // Simpan hasil untuk 'Ans'
        calculationHistory.unshift({ expr: currentExpression, result: lastResult });
        localStorage.setItem('calculator_history', JSON.stringify(calculationHistory.slice(0, 20)));
        renderHistory();
        
        currentExpression = lastResult; // Hasil jadi ekspresi baru
        inputDisplay = lastResult;
        
      } catch (e) {
        console.error("Eval error:", e);
        showError('Calculation error! Periksa input Anda.');
      }
      updateDisplay();
    }

    // Fungsi evaluasi string (mesin kalkulator)
    function evaluateExpression(expr) {
      // [PERBAIKAN LOGIKA] Ganti simbol visual ke operator JS
      let processedExpr = expr
        .replace(/×/g, '*')
        .replace(/÷/g, '/')
        .replace(/π/g, 'Math.PI')
        .replace(/e/g, 'Math.E')
        .replace(/√/g, 'Math.sqrt')
        .replace(/log/g, 'Math.log10')
        .replace(/ln/g, 'Math.log')
        .replace(/\^/g, '**')
        .replace(/%/g, '/100');

      // Handle trig functions (rad/deg)
      const trigFactor = useRadians ? '' : 'Math.PI/180*';
      processedExpr = processedExpr.replace(/sin\(/g, `Math.sin(${trigFactor}`);
      processedExpr = processedExpr.replace(/cos\(/g, `Math.cos(${trigFactor}`);
      processedExpr = processedExpr.replace(/tan\(/g, `Math.tan(${trigFactor}`);
      
      const invTrigFactor = useRadians ? '' : '*(180/Math.PI)';
      processedExpr = processedExpr.replace(/asin\(/g, `(Math.asin`);
      processedExpr = processedExpr.replace(/acos\(/g, `(Math.acos`);
      processedExpr = processedExpr.replace(/atan\(/g, `(Math.atan`);
      processedExpr = processedExpr.replace(/asin\(([^)]+)\)/g, `(Math.asin($1)${invTrigFactor})`);
      processedExpr = processedExpr.replace(/acos\(([^)]+)\)/g, `(Math.acos($1)${invTrigFactor})`);
      processedExpr = processedExpr.replace(/atan\(([^)]+)\)/g, `(Math.atan($1)${invTrigFactor})`);

      // Handle factorial
      processedExpr = processedExpr.replace(/(\d+)!/g, (match, num) => {
        return factorial(parseInt(num));
      });
      
      processedExpr = processedExpr.replace(/abs\(/g, 'Math.abs(');
      
      // Final evaluation (use function constructor for safety)
      return new Function('return ' + processedExpr)();
    }
    
    function factorial(n) {
      if (n < 0) return NaN;
      if (n === 0 || n === 1) return 1;
      let result = 1;
      for (let i = 2; i <= n; i++) {
        result *= i;
      }
      return result;
    }
    
    // =========================================================
    // BAGIAN 3: EVENT LISTENERS & HELPERS
    // =========================================================
    
    // Inisialisasi
    function init() {
      renderHistory();
      setupEventListeners();
    }

    // Menyiapkan semua event listener
    function setupEventListeners() {
      // Mode buttons
      modeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          modeButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          scientificButtons.classList.toggle('active', btn.dataset.mode === 'scientific');
        });
      });

      // Tabs
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.dataset.tab;
          tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          tabContents.forEach(content => {
            content.classList.toggle('active', content.id === `tab-${tabId}`);
          });
        });
      });

      // Tombol Kalkulator (Basic)
      basicButtons.addEventListener('click', e => {
        if (!e.target.matches('.calculator-btn')) return;
        const btn = e.target;
        if (btn.dataset.number) appendNumber(btn.dataset.number);
        else if (btn.dataset.action) {
          if (['+', '-', '×', '÷'].includes(btn.dataset.action)) {
            appendOperator(btn.dataset.action);
          } else {
            handleAction(btn.dataset.action);
          }
        }
      });
      
      // Tombol Kalkulator (Scientific)
      scientificButtons.addEventListener('click', e => {
        if (!e.target.matches('.calculator-btn')) return;
        if (e.target.dataset.func) appendFunction(e.target.dataset.func);
      });

      // Tombol Konstanta
      constantsGrid.addEventListener('click', e => {
        if (!e.target.matches('.constant-btn')) return;
        const constName = e.target.dataset.const;
        currentExpression += constName;
        inputDisplay = constants[constName].toString();
        updateDisplay();
      });

      // Tombol Hapus Riwayat
      clearHistoryBtn.addEventListener('click', () => {
        calculationHistory = [];
        localStorage.removeItem('calculator_history');
        renderHistory();
      });

      // Theme toggles
      [themeToggle, calcThemeToggle].forEach(toggle => {
        toggle.addEventListener('click', toggleTheme);
      });
      
      // Mobile menu
      hamburger.addEventListener('click', () => {
        mobileMenu.classList.toggle('open');
      });
      
      // Back to top
      window.addEventListener('scroll', () => {
        backToTop.style.display = window.scrollY > 300 ? 'flex' : 'none';
      });
      backToTop.addEventListener('click', (e) => {
        e.preventDefault();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
      
      // [FITUR BARU] Event Listener untuk Keyboard
      document.addEventListener('keydown', handleKeyboardInput);
    }
    
    // [FITUR BARU] Fungsi untuk menangani input keyboard
    function handleKeyboardInput(e) {
      e.preventDefault(); // Mencegah aksi default browser
      
      if (e.key >= '0' && e.key <= '9') {
        appendNumber(e.key);
      } else if (e.key === '.') {
        handleAction('.');
      } else if (e.key === '+') {
        appendOperator('+');
      } else if (e.key === '-') {
        appendOperator('-');
      } else if (e.key === '*') {
        appendOperator('×');
      } else if (e.key === '/') {
        appendOperator('÷');
      } else if (e.key === 'Enter' || e.key === '=') {
        calculate();
      } else if (e.key === 'Backspace') {
        handleAction('backspace');
      } else if (e.key === 'Delete' || e.key.toLowerCase() === 'c') {
        handleAction('clear');
      } else if (e.key === '(') {
        appendFunction('(');
      } else if (e.key === ')') {
        appendFunction(')');
      } else if (e.key === '%') {
        appendFunction('percent');
      } else if (e.key === '!') {
        appendFunction('fact');
      }
    }
    
    // Menampilkan pesan error
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      setTimeout(() => {
        errorMessage.style.display = 'none';
      }, 2000); // Pesan tampil 2 detik
    }

    // Ganti tema
    function toggleTheme() {
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('site_theme', newTheme);
    }
    
    // Render riwayat perhitungan
    function renderHistory() {
      historyList.innerHTML = '';
      if (calculationHistory.length === 0) {
        historyList.innerHTML = '<p style="text-align:center; color: var(--muted);">Riwayat masih kosong</p>';
        return;
      }
      calculationHistory.forEach(item => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <div class="history-expression">${item.expr}</div>
          <div class="history-result">= ${item.result}</div>
        `;
        div.addEventListener('click', () => {
          currentExpression = item.expr;
          inputDisplay = item.result;
          updateDisplay();
        });
        historyList.appendChild(div);
      });
    }
    
    // =========================================================
    // BAGIAN 4: MENJALANKAN APLIKASI
    // =========================================================
    
    // Jalankan aplikasi
    init();
    
    // Atur tema dari localStorage
    const savedTheme = localStorage.getItem('site_theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);
    
</script>

</body>
</html>