import{r as s,j as e,E as C,L as F,G as A,b as $,D as B,R as V,T as W,c as I,F as J,H as K,s as b,I as O}from"./index-COUSDRnw.js";import{C as X}from"./ConfirmModal-CyNdXQx2.js";const Q=({isAdmin:i})=>{const[o,g]=s.useState([]),[T,f]=s.useState(!0),r=6,[d,c]=s.useState(r),[n,j]=s.useState(""),[a,P]=s.useState(!1),[w,v]=s.useState(!1),[N,y]=s.useState(!1),[k,S]=s.useState(null),[x,m]=s.useState(null),h=280,u=async()=>{f(!0);try{const t=await J();g(t)}catch(t){console.error(t)}finally{f(!1)}};s.useEffect(()=>{u()},[]);const E=async()=>{if(n.trim()){v(!0);try{await O({content:n.trim(),type:a?"private":"public",sender:"Anonim"}),y(!0),j(""),a||(u(),c(r)),setTimeout(()=>y(!1),3e3)}catch{b("Gagal mengirim pesan.")}finally{v(!1)}}},M=(t,l)=>{l.stopPropagation(),t&&m(t)},D=async()=>{if(!x)return;const t=x;S(t),m(null);try{await K(t),g(l=>l.filter(p=>p.id!==t)),b("Pesan dihapus.")}catch(l){b("Gagal menghapus pesan."),console.error(l)}finally{S(null)}},L=()=>{c(t=>t+r)},G=()=>{c(r);const t=document.getElementById("message-feed-top");t&&t.scrollIntoView({behavior:"smooth"})},H=t=>new Date(t).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),_=o.slice(0,d),R=d<o.length,z=d>r;return e.jsxs("div",{className:"min-h-screen bg-slate-50 relative pb-20",children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-40",style:{backgroundImage:"radial-gradient(#cbd5e1 1px, transparent 1px)",backgroundSize:"24px 24px"}}),e.jsx(X,{isOpen:!!x,title:"Hapus Pesan?",description:"Pesan ini akan dihapus secara permanen dari Public Wall. Tindakan ini tidak dapat dibatalkan.",confirmText:"Ya, Hapus",onConfirm:D,onCancel:()=>m(null)}),e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12 relative z-10",children:[e.jsxs("div",{className:"mb-16 text-center space-y-8",children:[e.jsxs("div",{children:[e.jsx(C,{id:"msg_feed_title",defaultText:"Public Wall",isAdmin:i,tag:"h1",className:"text-4xl font-black text-slate-900 tracking-tight mb-2"}),e.jsx(C,{id:"msg_feed_desc",defaultText:"Tulis sesuatu. Rahasia, harapan, atau sekadar 'Halo'.",isAdmin:i,tag:"p",className:"text-slate-500 font-medium"})]}),e.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-xl shadow-slate-200/60 border border-slate-100 max-w-2xl mx-auto transition-all focus-within:ring-2 focus-within:ring-slate-900/5 relative group",children:[e.jsx("textarea",{value:n,onChange:t=>j(t.target.value),maxLength:h,className:"w-full h-32 bg-transparent text-lg font-medium text-slate-800 placeholder:text-slate-300 resize-none outline-none leading-relaxed",placeholder:"Apa yang sedang kamu pikirkan?"}),e.jsxs("div",{className:`absolute bottom-20 right-6 text-[10px] font-bold transition-colors ${n.length>=h?"text-red-500":"text-slate-300"}`,children:[n.length,"/",h]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-50 flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group select-none relative",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:a,onChange:t=>P(t.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-slate-900 transition-colors"}),e.jsx("span",{className:`text-xs font-bold transition-colors ${a?"text-slate-900":"text-slate-500"}`,children:a?"Privat":"Publik"})]}),e.jsx("div",{className:"hidden sm:block w-px h-5 bg-slate-200"}),e.jsxs("div",{className:`hidden sm:flex items-center gap-1.5 text-[10px] font-medium transition-colors ${a?"text-emerald-600":"text-slate-400"}`,children:[a?e.jsx(F,{className:"w-3 h-3"}):e.jsx(A,{className:"w-3 h-3"}),e.jsx("span",{children:a?"Hanya terbaca oleh Admin.":"Tayang untuk umum."})]})]}),e.jsx("button",{onClick:E,disabled:!n.trim()||w,className:`
                                    flex items-center gap-2 px-6 py-2.5 rounded-xl font-bold text-sm transition-all shadow-lg active:scale-95 shrink-0 ml-auto
                                    ${N?"bg-green-500 text-white shadow-green-500/20":"bg-slate-900 text-white hover:bg-slate-800 shadow-slate-900/20 disabled:bg-slate-200 disabled:text-slate-400 disabled:shadow-none disabled:cursor-not-allowed"}
                                `,children:w?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):N?e.jsxs(e.Fragment,{children:["Terkirim ",e.jsx($,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["Kirim ",e.jsx(B,{className:"w-4 h-4"})]})})]})]})]}),e.jsxs("div",{id:"message-feed-top",className:"flex items-center justify-between mb-6 px-2",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/128/417/417720.png",alt:"Feed",className:"w-4 h-4 object-contain opacity-60"})," Pesan Terbaru"]}),e.jsx("button",{onClick:u,className:"p-2 text-slate-400 hover:text-slate-900 hover:bg-white rounded-full transition-all",title:"Refresh",children:e.jsx(V,{className:"w-4 h-4"})})]}),T?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[1,2,3,4].map(t=>e.jsx("div",{className:"h-32 bg-slate-200/50 rounded-2xl animate-pulse"},t))}):o.length===0?e.jsxs("div",{className:"text-center py-20 border-2 border-dashed border-slate-200 rounded-3xl",children:[e.jsx("p",{className:"text-slate-400 font-medium",children:"Belum ada pesan publik."}),e.jsx("p",{className:"text-slate-300 text-sm",children:"Jadilah yang pertama menulis!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"columns-1 md:columns-2 gap-6 space-y-6",children:_.map((t,l)=>e.jsxs("div",{className:"break-inside-avoid bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md hover:border-slate-200 hover:-translate-y-1 transition-all duration-300 group relative overflow-hidden",children:[e.jsxs("p",{className:"text-slate-800 text-[15px] font-medium leading-relaxed whitespace-pre-wrap break-words relative z-10",children:['"',t.content,'"']}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("span",{className:"text-[9px] font-bold text-slate-300 uppercase tracking-widest bg-slate-50 px-2 py-1 rounded",children:H(t.timestamp)})}),i&&e.jsx("button",{onClick:p=>M(t.id,p),disabled:k===t.id,className:"absolute top-2 right-2 p-2 bg-white/80 backdrop-blur-sm rounded-full text-slate-400 hover:text-red-500 hover:bg-red-50 transition-all opacity-0 group-hover:opacity-100 border border-transparent hover:border-red-100 shadow-sm z-20",title:"Hapus Pesan",children:k===t.id?e.jsx("div",{className:"w-3.5 h-3.5 border-2 border-red-200 border-t-red-500 rounded-full animate-spin"}):e.jsx(W,{className:"w-3.5 h-3.5"})})]},t.id||l))}),e.jsxs("div",{className:"flex flex-col items-center gap-3 mt-12",children:[R&&e.jsxs("button",{onClick:L,className:"px-6 py-2.5 rounded-full bg-white border border-slate-200 text-slate-600 font-bold text-xs hover:bg-slate-50 hover:text-slate-900 hover:border-slate-300 transition-all flex items-center gap-2 shadow-sm",children:["Lihat Pesan Lainnya",e.jsx(I,{className:"w-4 h-4"})]}),z&&e.jsxs("button",{onClick:G,className:"text-xs font-bold text-slate-400 hover:text-slate-600 transition-colors flex items-center gap-1.5 py-2",children:["Sembunyikan (Tutup)",e.jsx(I,{className:"w-3.5 h-3.5 rotate-180"})]})]})]})]})]})};export{Q as default};
