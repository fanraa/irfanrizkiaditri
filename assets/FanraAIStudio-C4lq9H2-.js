import{K as Er,N as Cr,r as w,j as p,U as Sr,s as ie,O as Ir,Q as wr,V as Gt,G as Ar,T as Fi,W as Nr,b as nn,X as br,L as Gi,i as Vi,C as Hi,c as qi,Y as Rr,Z as Pr,_ as Yn,$ as Mr,a0 as zn,a1 as kr,a2 as Xn,a3 as Dr,a4 as Ur,a5 as Lr,a6 as Bi,a7 as Fr,a8 as Gr,a9 as Vr,aa as Hr,ab as Qn,ac as qr,ad as Br,ae as Kr,af as Zn,ag as Vt}from"./index-Cw6E8Nps.js";import{r as $r}from"./imageUtils-Bq9wc1XJ.js";import{C as Jr}from"./ConfirmModal-BCdQmYRN.js";var te=(t=>(t.BACKGROUND_REMOVER="bg_remove",t.HD_UPSCALE="hd_upscale",t.CREATIVE_REMIX="creative_remix",t.COLORIZE="colorize",t.SKETCH_TO_REAL="sketch_real",t))(te||{});const Xe={id:{welcome:"Halo, Siapa Disana?",welcomeSubtitle:"Biar kita makin akrab, kenalan dulu yuk! Isi nama dan sekolahmu ya, biar enak ngobrolnya.",enterName:"Aku biasa dipanggil...",enterSchool:"Aku sekolah / kuliah di...",namePlaceholder:"Contoh: Rara",schoolPlaceholder:"Contoh: SMA 1 Jakarta / UI",accessButton:"Oke, Salam Kenal!",verifying:"Lagi mencatat...",deviceIdNote:"Santai aja, ini cuma biar aku inget temen baru.",credits:"Limit",adminMode:"Mode Admin",unlimited:"Tanpa Batas",logOut:"Ganti Akun",heroTitle:"Hai,",heroSubtitle:"Sudah siap bikin karya keren hari ini?",toolBgRemove:"Hapus Background",toolBgRemoveDesc:"Hapus latar belakang secara instan dan rapi.",toolUpscale:"HD Upscale (4K)",toolUpscaleDesc:"Pertajam detail & resolusi tinggi agar tidak pecah.",toolRemix:"Creative Remix",toolRemixDesc:"Ubah gaya gambar dengan bantuan AI.",toolColorize:"Warnai Foto",toolColorizeDesc:"Ubah foto hitam putih jadi berwarna.",toolSketch:"Sketsa ke Nyata",toolSketchDesc:"Ubah coretan tangan jadi gambar realistis.",moreTools:"Lihat Lainnya",lessTools:"Sembunyikan",back:"Kembali",preview:"Pratinjau",changePhoto:"Ganti Foto",aiPrompt:"Instruksi AI",aiPromptPlaceholder:"Jelaskan bagaimana Anda ingin mengubah gambar ini...",generate:"Mulai Proses",generateMagic:"Buat Keajaiban",processing:"Memproses",processingStandard:"Sedang meracik gambar...",processingCloud:"Mengirim ke awan...",processingAI:"AI sedang bekerja...",refining:"Sedikit polesan lagi...",optimizingLocal:"Memproses di perangkatmu (Mode Hemat)...",initializing:"Siap-siap...",resultComparison:"Hasil Karya Kamu",download:"Simpan Gambar",reset:"Ulangi",original:"ASLI",result:"HASIL",bgColor:"Ganti Warna Belakang",uploadPrompt:"Pilih foto terbaikmu untuk diedit",settingsTitle:"Pengaturan Sistem",systemPref:"Preferensi AI",knowledgeMode:"Mode Pengetahuan (Database)",knowledgeModeDesc:"Hemat Kuota. AI hanya menjawab dari database lokal tanpa Gemini API.",totalKnowledge:"Total Memori Tersimpan",wikiMode:"Izinkan Wikipedia",wikiModeDesc:"Jika info tidak ada di database, cari di Wikipedia (Tetap hemat kuota).",googleApiTitle:"Google Gemini API Keys",googleApiDesc:"Kelola API Key untuk fitur chat cerdas dan edit gambar.",selectKeyBtn:"Ambil Key via AI Studio",orManually:"Kelola Key Manual",customKeyActive:"Key Pribadi Aktif",defaultKeyActive:"Key Sistem (Terbatas)",removeBgTitle:"Remove.bg API",removeBgDesc:"Engine khusus hapus background presisi tinggi.",supabaseTitle:"Supabase Engine",supabaseDesc:"Engine cadangan untuk pemrosesan gambar.",googleSearchTitle:"Google Search API",googleSearchDesc:"Opsi pencarian terakhir (Fallback) jika DB & Wiki gagal.",searchApiKey:"Custom Search API Key",searchEngineId:"Search Engine ID (CX)",cancel:"Tutup",save:"Simpan",active:"Aktif",inactive:"Nonaktif",addKeyPlaceholder:"Tempel API Key Gemini disini...",addKeyBtn:"Tambah Key",keyDisclaimerTitle:"⚠️ Peringatan Penting",keyDisclaimerText:"Dengan menambahkan API Key pribadi, saya sadar bahwa segala bentuk penggunaan, kuota, dan keamanan key tersebut adalah tanggung jawab saya sepenuhnya. Fanra AI Studio tidak bertanggung jawab atas penyalahgunaan atau tagihan yang muncul akibat kelalaian pengguna.",consentCheckbox:"Saya mengerti dan setuju untuk melanjutkan.",keysStored:"Daftar Key",noKeysYet:"Belum ada key tersimpan. Masih pakai limit bawaan.",newChat:"Percakapan Baru",historyHeader:"Riwayat",loginToSave:"Login untuk simpan progres",loginBtn:"Masuk Akun",historyItem1:"editing foto sekolah...",historyItem2:"hapus background merah...",chatPlaceholder:"ketik pesan atau tanya Fanra...",chatDisclaimer:"Fanra bisa salah. cek lagi info penting.",chatFallbackError:"duh, koneksi gue lagi putus dan gue belum pernah dapet pertanyaan ini sebelumnya. cek internet lo atau API key nya deh.",chatOfflineMode:"(Mode Database) Info tidak ditemukan di database.",chatImageResponse:"wih, kirim gambar ya? sori nih gue baru bisa edit gambar kalo lo pake menu di atas itu. coba klik ikon-ikon di atas deh.",errorTitle:"Ups, Ada Masalah",insufficientCredits:"Yah, limit habis! Masukkan API Key di pengaturan agar Unlimited.",limitReachedHQ:"Kuota High Quality harian sudah penuh.",serviceBusy:"Server lagi ramai nih. Coba lagi sebentar ya.",networkError:"Koneksi internetmu sepertinya putus nyambung.",memoryError:"HP keberatan proses gambar ini. Coba gambar lain ya.",confirmTitle:"Yakin mau ganti?",confirmDesc:"Proses yang ini belum disimpan lho. Mau ganti aktivitas?",yesChange:"Ya, Ganti Aja",uploadTitle:"Unggah Foto",uploadDesc:"Klik atau tarik fotomu ke sini",dropHere:"Lepaskan fotonya!",invalidImage:"Format file ini tidak didukung. Pakai JPG/PNG ya.",toolLockedMsg:"Fitur ini sedang dalam pengembangan/perbaikan. Mohon pengertiannya ya, developer lagi ngoprek!",limitChatReached:"Energi Fanra habis untuk hari ini. Karena ini project mandiri dengan resource terbatas, chat dibatasi dulu ya. Besok reset kok! (Login untuk kuota lebih)",limitImageReached:"Limit upload gambar hari ini sudah habis. Server butuh istirahat karena resource terbatas. Coba lagi besok ya!"},en:{welcome:"Hello, Who's There?",welcomeSubtitle:"Let's be friends! Tell me your name and school so we can chat comfortably.",enterName:"You can call me...",enterSchool:"I study at...",namePlaceholder:"Ex: Sarah",schoolPlaceholder:"Ex: High School NY / MIT",accessButton:"Okay, Nice to Meet You!",verifying:"Writing that down...",deviceIdNote:"Relax, just remembering a new friend.",credits:"Credits",adminMode:"Admin Mode",unlimited:"Unlimited",logOut:"Switch Account",heroTitle:"Hi,",heroSubtitle:"Ready to make something cool today?",toolBgRemove:"Remove Background",toolBgRemoveDesc:"Instantly remove backgrounds cleanly.",toolUpscale:"HD Upscale (4K)",toolUpscaleDesc:"Sharpen details to 4K resolution.",toolRemix:"Creative Remix",toolRemixDesc:"Reimagine image with AI assistance.",toolColorize:"Colorize Photo",toolColorizeDesc:"Turn black & white photos into color.",toolSketch:"Sketch to Real",toolSketchDesc:"Turn hand drawings into realistic images.",moreTools:"See More",lessTools:"Show Less",back:"Back",preview:"Preview",changePhoto:"Change Photo",aiPrompt:"AI Prompt",aiPromptPlaceholder:"Describe how you want to remix this image...",generate:"Generate",generateMagic:"Generate Magic",processing:"Processing",processingStandard:"Working magic...",processingCloud:"Sending to cloud...",processingAI:"AI is thinking...",refining:"Polishing details...",optimizingLocal:"Processing on device (Offline Mode)...",initializing:"Warming up...",resultComparison:"Your Masterpiece",download:"Save Image",reset:"Reset",original:"ORIGINAL",result:"RESULT",bgColor:"Background Color",uploadPrompt:"Upload an image to start editing",settingsTitle:"System Settings",systemPref:"AI Preferences",knowledgeMode:"Knowledge Mode (Database)",knowledgeModeDesc:"Save Quota. AI only answers from local database without Gemini API.",totalKnowledge:"Total Stored Memory",wikiMode:"Enable Wikipedia",wikiModeDesc:"If info not in DB, search Wikipedia (Still saves API quota).",googleApiTitle:"Google Gemini API Keys",googleApiDesc:"Manage keys for smart chat and image editing.",selectKeyBtn:"Get Key via AI Studio",orManually:"Manage Keys Manually",customKeyActive:"Custom Key Active",defaultKeyActive:"System Key (Limited)",removeBgTitle:"Remove.bg API",removeBgDesc:"Precision background removal engine.",supabaseTitle:"Supabase Engine",supabaseDesc:"Backup engine for image processing.",googleSearchTitle:"Google Search API",googleSearchDesc:"Fallback search option if DB & Wiki fail.",searchApiKey:"Custom Search API Key",searchEngineId:"Search Engine ID (CX)",cancel:"Close",save:"Save",active:"Active",inactive:"Inactive",addKeyPlaceholder:"Paste Gemini API Key here...",addKeyBtn:"Add Key",keyDisclaimerTitle:"⚠️ Important Warning",keyDisclaimerText:"By adding personal API Keys, I acknowledge that all usage, quotas, and security of said keys are my sole responsibility. Fanra AI Studio is not liable for misuse or charges incurred due to user negligence.",consentCheckbox:"I understand and agree to proceed.",keysStored:"Key List",noKeysYet:"No keys saved yet. Using default limits.",newChat:"New Conversation",historyHeader:"History",loginToSave:"Login to save progress",loginBtn:"Login",historyItem1:"editing school photo...",historyItem2:"removing red background...",chatPlaceholder:"type a message or ask Fanra...",chatDisclaimer:"Fanra can make mistakes. Check important info.",chatFallbackError:"ugh, my connection is down and I haven't heard this question before. Check your internet or API key.",chatOfflineMode:"(DB Mode) Info not found in database.",chatImageResponse:"woah, sending an image? sorry, I can only edit images if you use the menu above. try clicking those icons.",errorTitle:"Whoops",insufficientCredits:"Out of credits! Enter your own Google Gemini API Key in settings for unlimited access.",limitReachedHQ:"High Quality daily limit reached.",serviceBusy:"Service is busy. Please try again.",networkError:"Connection issue. Check your internet.",memoryError:"Device memory low. Try a smaller image.",confirmTitle:"Change Activity?",confirmDesc:"Current progress will be lost. Are you sure?",yesChange:"Yes, Change",uploadTitle:"Upload Image",uploadDesc:"Click to browse or drag & drop",dropHere:"Drop it here!",invalidImage:"Please upload a valid image file (JPG/PNG).",toolLockedMsg:"This feature is under maintenance/development. Please understand, developer is working on it!",limitChatReached:"Fanra's energy is depleted for today. Due to limited resources on this personal project, chats are limited. Resets tomorrow!",limitImageReached:"Daily image upload limit reached. Server needs a break due to limited resources. Try again tomorrow!"}};var vt={exports:{}},Ki={};function le(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var Or=le;le.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};le.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};le.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var o=this;return this._timer=setTimeout(function(){o._attempts++,o._operationTimeoutCb&&(o._timeout=setTimeout(function(){o._operationTimeoutCb(o._attempts)},o._operationTimeout),o._options.unref&&o._timeout.unref()),o._fn(o._attempts)},n),this._options.unref&&this._timer.unref(),!0};le.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};le.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};le.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};le.prototype.start=le.prototype.try;le.prototype.errors=function(){return this._errors};le.prototype.attempts=function(){return this._attempts};le.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,n=0,o=0;o<this._errors.length;o++){var i=this._errors[o],r=i.message,l=(t[r]||0)+1;t[r]=l,l>=n&&(e=i,n=l)}return e};(function(t){var e=Or;t.operation=function(n){var o=t.timeouts(n);return new e(o,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},t.timeouts=function(n){if(n instanceof Array)return[].concat(n);var o={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in n)o[i]=n[i];if(o.minTimeout>o.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],l=0;l<o.retries;l++)r.push(this.createTimeout(l,o));return n&&n.forever&&!r.length&&r.push(this.createTimeout(l,o)),r.sort(function(u,d){return u-d}),r},t.createTimeout=function(n,o){var i=o.randomize?Math.random()+1:1,r=Math.round(i*Math.max(o.minTimeout,1)*Math.pow(o.factor,n));return r=Math.min(r,o.maxTimeout),r},t.wrap=function(n,o,i){if(o instanceof Array&&(i=o,o=null),!i){i=[];for(var r in n)typeof n[r]=="function"&&i.push(r)}for(var l=0;l<i.length;l++){var u=i[l],d=n[u];n[u]=(function(f){var m=t.operation(o),h=Array.prototype.slice.call(arguments,1),g=h.pop();h.push(function(y){m.retry(y)||(y&&(arguments[0]=m.mainError()),g.apply(this,arguments))}),m.attempt(function(){f.apply(n,h)})}).bind(n,d),n[u].options=o}}})(Ki);var Wr=Ki;const Yr=Wr,zr=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class $i extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const Xr=(t,e,n)=>{const o=n.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=o,t},Qr=t=>zr.includes(t),Ji=(t,e)=>new Promise((n,o)=>{e={onFailedAttempt:()=>{},retries:10,...e};const i=Yr.operation(e);i.attempt(async r=>{try{n(await t(r))}catch(l){if(!(l instanceof Error)){o(new TypeError(`Non-error was thrown: "${l}". You should only throw errors.`));return}if(l instanceof $i)i.stop(),o(l.originalError);else if(l instanceof TypeError&&!Qr(l.message))i.stop(),o(l);else{Xr(l,r,e);try{await e.onFailedAttempt(l)}catch(u){o(u);return}i.retry(l)||o(i.mainError())}}})});vt.exports=Ji;vt.exports.default=Ji;var Zr=vt.exports.AbortError=$i,jr=vt.exports;const ea=Er(jr);var ta={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let na,oa;function ia(){return{geminiUrl:na,vertexUrl:oa}}function sa(t,e,n,o){var i,r;if(!(t!=null&&t.baseUrl)){const l=ia();return e?(i=l.vertexUrl)!==null&&i!==void 0?i:n:(r=l.geminiUrl)!==null&&r!==void 0?r:o}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ee{}function b(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(o,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const r=e[i];return r!=null?String(r):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function a(t,e,n){for(let r=0;r<e.length-1;r++){const l=e[r];if(l.endsWith("[]")){const u=l.slice(0,-2);if(!(u in t))if(Array.isArray(n))t[u]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(t[u])){const d=t[u];if(Array.isArray(n))for(let c=0;c<d.length;c++){const f=d[c];a(f,e.slice(r+1),n[c])}else for(const c of d)a(c,e.slice(r+1),n)}return}else if(l.endsWith("[0]")){const u=l.slice(0,-3);u in t||(t[u]=[{}]);const d=t[u];a(d[0],e.slice(r+1),n);return}(!t[l]||typeof t[l]!="object")&&(t[l]={}),t=t[l]}const o=e[e.length-1],i=t[o];if(i!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===i)return;if(typeof i=="object"&&typeof n=="object"&&i!==null&&n!==null)Object.assign(i,n);else throw new Error(`Cannot set value for an existing key. Key: ${o}`)}else o==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[o]=n}function s(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let o=0;o<e.length;o++){if(typeof t!="object"||t===null)return n;const i=e[o];if(i.endsWith("[]")){const r=i.slice(0,-2);if(r in t){const l=t[r];return Array.isArray(l)?l.map(u=>s(u,e.slice(o+1),n)):n}else return n}else t=t[i]}return t}catch(o){if(o instanceof TypeError)return n;throw o}}function ra(t,e){for(const[n,o]of Object.entries(e)){const i=n.split("."),r=o.split("."),l=new Set;let u=-1;for(let d=0;d<i.length;d++)if(i[d]==="*"){u=d;break}if(u!==-1&&r.length>u)for(let d=u;d<r.length;d++){const c=r[d];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&l.add(c)}Ht(t,i,r,0,l)}}function Ht(t,e,n,o,i){if(o>=e.length||typeof t!="object"||t===null)return;const r=e[o];if(r.endsWith("[]")){const l=r.slice(0,-2),u=t;if(l in u&&Array.isArray(u[l]))for(const d of u[l])Ht(d,e,n,o+1,i)}else if(r==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const l=t,u=Object.keys(l).filter(c=>!c.startsWith("_")&&!i.has(c)),d={};for(const c of u)d[c]=l[c];for(const[c,f]of Object.entries(d)){const m=[];for(const h of n.slice(o))h==="*"?m.push(c):m.push(h);a(l,m,f)}for(const c of u)delete l[c]}}else{const l=t;r in l&&Ht(l[r],e,n,o+1,i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function on(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function aa(t){const e={},n=s(t,["operationName"]);n!=null&&a(e,["operationName"],n);const o=s(t,["resourceName"]);return o!=null&&a(e,["_url","resourceName"],o),e}function la(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const o=s(t,["metadata"]);o!=null&&a(e,["metadata"],o);const i=s(t,["done"]);i!=null&&a(e,["done"],i);const r=s(t,["error"]);r!=null&&a(e,["error"],r);const l=s(t,["response","generateVideoResponse"]);return l!=null&&a(e,["response"],ca(l)),e}function ua(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const o=s(t,["metadata"]);o!=null&&a(e,["metadata"],o);const i=s(t,["done"]);i!=null&&a(e,["done"],i);const r=s(t,["error"]);r!=null&&a(e,["error"],r);const l=s(t,["response"]);return l!=null&&a(e,["response"],da(l)),e}function ca(t){const e={},n=s(t,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>fa(l))),a(e,["generatedVideos"],r)}const o=s(t,["raiMediaFilteredCount"]);o!=null&&a(e,["raiMediaFilteredCount"],o);const i=s(t,["raiMediaFilteredReasons"]);return i!=null&&a(e,["raiMediaFilteredReasons"],i),e}function da(t){const e={},n=s(t,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>pa(l))),a(e,["generatedVideos"],r)}const o=s(t,["raiMediaFilteredCount"]);o!=null&&a(e,["raiMediaFilteredCount"],o);const i=s(t,["raiMediaFilteredReasons"]);return i!=null&&a(e,["raiMediaFilteredReasons"],i),e}function fa(t){const e={},n=s(t,["video"]);return n!=null&&a(e,["video"],Ta(n)),e}function pa(t){const e={},n=s(t,["_self"]);return n!=null&&a(e,["video"],xa(n)),e}function ma(t){const e={},n=s(t,["operationName"]);return n!=null&&a(e,["_url","operationName"],n),e}function ha(t){const e={},n=s(t,["operationName"]);return n!=null&&a(e,["_url","operationName"],n),e}function ga(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const o=s(t,["metadata"]);o!=null&&a(e,["metadata"],o);const i=s(t,["done"]);i!=null&&a(e,["done"],i);const r=s(t,["error"]);r!=null&&a(e,["error"],r);const l=s(t,["response"]);return l!=null&&a(e,["response"],ya(l)),e}function ya(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["parent"]);o!=null&&a(e,["parent"],o);const i=s(t,["documentName"]);return i!=null&&a(e,["documentName"],i),e}function Oi(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const o=s(t,["metadata"]);o!=null&&a(e,["metadata"],o);const i=s(t,["done"]);i!=null&&a(e,["done"],i);const r=s(t,["error"]);r!=null&&a(e,["error"],r);const l=s(t,["response"]);return l!=null&&a(e,["response"],va(l)),e}function va(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["parent"]);o!=null&&a(e,["parent"],o);const i=s(t,["documentName"]);return i!=null&&a(e,["documentName"],i),e}function Ta(t){const e={},n=s(t,["uri"]);n!=null&&a(e,["uri"],n);const o=s(t,["encodedVideo"]);o!=null&&a(e,["videoBytes"],on(o));const i=s(t,["encoding"]);return i!=null&&a(e,["mimeType"],i),e}function xa(t){const e={},n=s(t,["gcsUri"]);n!=null&&a(e,["uri"],n);const o=s(t,["bytesBase64Encoded"]);o!=null&&a(e,["videoBytes"],on(o));const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var jn;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(jn||(jn={}));var eo;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(eo||(eo={}));var to;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(to||(to={}));var oe;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(oe||(oe={}));var no;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(no||(no={}));var oo;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(oo||(oo={}));var io;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(io||(io={}));var so;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(so||(so={}));var ro;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(ro||(ro={}));var ao;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(ao||(ao={}));var lo;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(lo||(lo={}));var uo;(function(t){t.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH",t.MINIMAL="MINIMAL"})(uo||(uo={}));var co;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(co||(co={}));var fo;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(fo||(fo={}));var po;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(po||(po={}));var mo;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE",t.IMAGE_RECITATION="IMAGE_RECITATION",t.IMAGE_OTHER="IMAGE_OTHER"})(mo||(mo={}));var ho;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(ho||(ho={}));var go;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(go||(go={}));var yo;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(yo||(yo={}));var vo;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(vo||(vo={}));var To;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(To||(To={}));var dt;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(dt||(dt={}));var xo;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(xo||(xo={}));var _o;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(_o||(_o={}));var Eo;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Eo||(Eo={}));var qt;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(qt||(qt={}));var Co;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Co||(Co={}));var So;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",t.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(So||(So={}));var Bt;(function(t){t.COLLECTION="COLLECTION"})(Bt||(Bt={}));var Io;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Io||(Io={}));var wo;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(wo||(wo={}));var ft;(function(t){t.PREDICT="PREDICT",t.EMBED_CONTENT="EMBED_CONTENT"})(ft||(ft={}));var Ao;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Ao||(Ao={}));var No;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(No||(No={}));var bo;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(bo||(bo={}));var Ro;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Ro||(Ro={}));var Po;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Po||(Po={}));var Mo;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Mo||(Mo={}));var ko;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(ko||(ko={}));var Do;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(Do||(Do={}));var Uo;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(Uo||(Uo={}));var Lo;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(Lo||(Lo={}));var Fo;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(Fo||(Fo={}));var Go;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING",t.DISTILLATION="DISTILLATION"})(Go||(Go={}));var Vo;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(Vo||(Vo={}));var Ho;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(Ho||(Ho={}));var qo;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED",t.REGISTERED="REGISTERED"})(qo||(qo={}));var Bo;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Bo||(Bo={}));var Ko;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(Ko||(Ko={}));var $o;(function(t){t.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",t.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",t.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})($o||($o={}));var Jo;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.ACTIVITY_START="ACTIVITY_START",t.ACTIVITY_END="ACTIVITY_END"})(Jo||(Jo={}));var Oo;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Oo||(Oo={}));var Wo;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Wo||(Wo={}));var Yo;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Yo||(Yo={}));var zo;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(zo||(zo={}));var Xo;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Xo||(Xo={}));var Qo;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(Qo||(Qo={}));var Me;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(Me||(Me={}));class Kt{constructor(e){const n={};for(const o of e.headers.entries())n[o[0]]=o[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class Oe{get text(){var e,n,o,i,r,l,u,d;if(((i=(o=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",f=!1;const m=[];for(const h of(d=(u=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[g,y]of Object.entries(h))g!=="text"&&g!=="thought"&&g!=="thoughtSignature"&&(y!==null||y!==void 0)&&m.push(g);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;f=!0,c+=h.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?c:void 0}get data(){var e,n,o,i,r,l,u,d;if(((i=(o=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const f=[];for(const m of(d=(u=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[h,g]of Object.entries(m))h!=="inlineData"&&(g!==null||g!==void 0)&&f.push(h);m.inlineData&&typeof m.inlineData.data=="string"&&(c+=atob(m.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,n,o,i,r,l,u,d;if(((i=(o=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(d=(u=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,n,o,i,r,l,u,d,c;if(((i=(o=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(d=(u=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,n,o,i,r,l,u,d,c;if(((i=(o=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(d=(u=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.output}}class Zo{}class jo{}class _a{}class Ea{}class Ca{}class Sa{}class ei{}class ti{}class ni{}class Ia{}class pt{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const o=new pt;let i;const r=e;return n?i=ua(r):i=la(r),Object.assign(o,i),o}}class oi{}class ii{}class si{}class ri{}class wa{}class Aa{}class Na{}class sn{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const o=new sn,r=ga(e);return Object.assign(o,r),o}}class ba{}class Ra{}class Pa{}class Ma{}class ai{}class ka{get text(){var e,n,o;let i="",r=!1;const l=[];for(const u of(o=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&o!==void 0?o:[]){for(const[d,c]of Object.entries(u))d!=="text"&&d!=="thought"&&c!==null&&l.push(d);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;r=!0,i+=u.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?i:void 0}get data(){var e,n,o;let i="";const r=[];for(const l of(o=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&o!==void 0?o:[]){for(const[u,d]of Object.entries(l))u!=="inlineData"&&d!==null&&r.push(u);l.inlineData&&typeof l.inlineData.data=="string"&&(i+=atob(l.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class Da{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class rn{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const o=new rn,r=Oi(e);return Object.assign(o,r),o}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function V(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Wi(t,e){const n=V(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function Yi(t){return Array.isArray(t)?t.map(e=>mt(e)):[mt(t)]}function mt(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function zi(t){const e=mt(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Xi(t){const e=mt(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function li(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Qi(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>li(e)):[li(t)]}function $t(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function ui(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function ci(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function X(t){if(t==null)throw new Error("ContentUnion is required");return $t(t)?t:{role:"user",parts:Qi(t)}}function an(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const o=X(n);return o.parts&&o.parts.length>0&&o.parts[0].text!==void 0?[o.parts[0].text]:[]});if(t.isVertexAI()){const n=X(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>X(n)):[X(e)]}function se(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(ui(t)||ci(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[X(t)]}const e=[],n=[],o=$t(t[0]);for(const i of t){const r=$t(i);if(r!=o)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(i);else{if(ui(i)||ci(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(i)}}return o||e.push({role:"user",parts:Qi(n)}),e}function Ua(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(o=>o!=="null");if(n.length===1)e.type=Object.values(oe).includes(n[0].toUpperCase())?n[0].toUpperCase():oe.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const o of n)e.anyOf.push({type:Object.values(oe).includes(o.toUpperCase())?o.toUpperCase():oe.TYPE_UNSPECIFIED})}}function Ue(t){const e={},n=["items"],o=["anyOf"],i=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=t.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,t=r[1]):r[1].type==="null"&&(e.nullable=!0,t=r[0])),t.type instanceof Array&&Ua(t.type,e);for(const[l,u]of Object.entries(t))if(u!=null)if(l=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(oe).includes(u.toUpperCase())?u.toUpperCase():oe.TYPE_UNSPECIFIED}else if(n.includes(l))e[l]=Ue(u);else if(o.includes(l)){const d=[];for(const c of u){if(c.type=="null"){e.nullable=!0;continue}d.push(Ue(c))}e[l]=d}else if(i.includes(l)){const d={};for(const[c,f]of Object.entries(u))d[c]=Ue(f);e[l]=d}else{if(l==="additionalProperties")continue;e[l]=u}return e}function ln(t){return Ue(t)}function un(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function cn(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Fe(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Ue(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Ue(e.response));return t}function Ge(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function La(t,e,n,o=1){const i=!e.startsWith(`${n}/`)&&e.split("/").length===o;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:i?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:i?`${n}/${e}`:e}function Ce(t,e){if(typeof e!="string")throw new Error("name must be a string");return La(t,e,"cachedContents")}function Zi(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Ie(t){return on(t)}function Fa(t){return t!=null&&typeof t=="object"&&"name"in t}function Ga(t){return t!=null&&typeof t=="object"&&"video"in t}function Va(t){return t!=null&&typeof t=="object"&&"uri"in t}function ji(t){var e;let n;if(Fa(t)&&(n=t.name),!(Va(t)&&(n=t.uri,n===void 0))&&!(Ga(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const i=n.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${n}`);n=i[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function es(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function ts(t){for(const e of["models","tunedModels","publisherModels"])if(Ha(t,e))return t[e];return[]}function Ha(t,e){return t!==null&&typeof t=="object"&&e in t}function qa(t,e={}){const n=t,o={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(o.responseJsonSchema=n.outputSchema),e.behavior&&(o.behavior=e.behavior),{functionDeclarations:[o]}}function Ba(t,e={}){const n=[],o=new Set;for(const i of t){const r=i.name;if(o.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);o.add(r);const l=qa(i,e);l.functionDeclarations&&n.push(...l.functionDeclarations)}return{functionDeclarations:n}}function ns(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const o=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(i>0||o!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(o>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function Ka(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function os(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const i=n.inlinedResponses;if(!Array.isArray(i)||i.length===0)return t;let r=!1;for(const l of i){if(typeof l!="object"||l===null)continue;const d=l.response;if(typeof d!="object"||d===null)continue;if(d.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function Ve(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function is(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function $a(t){return t.includes("gemini")&&t!=="gemini-embedding-001"||t.includes("maas")}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ja(t){const e={},n=s(t,["responsesFile"]);n!=null&&a(e,["fileName"],n);const o=s(t,["inlinedResponses","inlinedResponses"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>Il(l))),a(e,["inlinedResponses"],r)}const i=s(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>l)),a(e,["inlinedEmbedContentResponses"],r)}return e}function Oa(t){const e={},n=s(t,["predictionsFormat"]);n!=null&&a(e,["format"],n);const o=s(t,["gcsDestination","outputUriPrefix"]);o!=null&&a(e,["gcsUri"],o);const i=s(t,["bigqueryDestination","outputUri"]);return i!=null&&a(e,["bigqueryUri"],i),e}function Wa(t){const e={},n=s(t,["format"]);n!=null&&a(e,["predictionsFormat"],n);const o=s(t,["gcsUri"]);o!=null&&a(e,["gcsDestination","outputUriPrefix"],o);const i=s(t,["bigqueryUri"]);if(i!=null&&a(e,["bigqueryDestination","outputUri"],i),s(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(s(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(s(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function ut(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const o=s(t,["metadata","displayName"]);o!=null&&a(e,["displayName"],o);const i=s(t,["metadata","state"]);i!=null&&a(e,["state"],is(i));const r=s(t,["metadata","createTime"]);r!=null&&a(e,["createTime"],r);const l=s(t,["metadata","endTime"]);l!=null&&a(e,["endTime"],l);const u=s(t,["metadata","updateTime"]);u!=null&&a(e,["updateTime"],u);const d=s(t,["metadata","model"]);d!=null&&a(e,["model"],d);const c=s(t,["metadata","output"]);return c!=null&&a(e,["dest"],Ja(os(c))),e}function Jt(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const o=s(t,["displayName"]);o!=null&&a(e,["displayName"],o);const i=s(t,["state"]);i!=null&&a(e,["state"],is(i));const r=s(t,["error"]);r!=null&&a(e,["error"],r);const l=s(t,["createTime"]);l!=null&&a(e,["createTime"],l);const u=s(t,["startTime"]);u!=null&&a(e,["startTime"],u);const d=s(t,["endTime"]);d!=null&&a(e,["endTime"],d);const c=s(t,["updateTime"]);c!=null&&a(e,["updateTime"],c);const f=s(t,["model"]);f!=null&&a(e,["model"],f);const m=s(t,["inputConfig"]);m!=null&&a(e,["src"],Ya(m));const h=s(t,["outputConfig"]);h!=null&&a(e,["dest"],Oa(os(h)));const g=s(t,["completionStats"]);return g!=null&&a(e,["completionStats"],g),e}function Ya(t){const e={},n=s(t,["instancesFormat"]);n!=null&&a(e,["format"],n);const o=s(t,["gcsSource","uris"]);o!=null&&a(e,["gcsUri"],o);const i=s(t,["bigquerySource","inputUri"]);return i!=null&&a(e,["bigqueryUri"],i),e}function za(t,e){const n={};if(s(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(s(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(s(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const o=s(e,["fileName"]);o!=null&&a(n,["fileName"],o);const i=s(e,["inlinedRequests"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>Sl(t,l))),a(n,["requests","requests"],r)}return n}function Xa(t){const e={},n=s(t,["format"]);n!=null&&a(e,["instancesFormat"],n);const o=s(t,["gcsUri"]);o!=null&&a(e,["gcsSource","uris"],o);const i=s(t,["bigqueryUri"]);if(i!=null&&a(e,["bigquerySource","inputUri"],i),s(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(s(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Qa(t){const e={},n=s(t,["data"]);if(n!=null&&a(e,["data"],n),s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Za(t,e){const n={},o=s(e,["name"]);return o!=null&&a(n,["_url","name"],Ve(t,o)),n}function ja(t,e){const n={},o=s(e,["name"]);return o!=null&&a(n,["_url","name"],Ve(t,o)),n}function el(t){const e={},n=s(t,["content"]);n!=null&&a(e,["content"],n);const o=s(t,["citationMetadata"]);o!=null&&a(e,["citationMetadata"],tl(o));const i=s(t,["tokenCount"]);i!=null&&a(e,["tokenCount"],i);const r=s(t,["finishReason"]);r!=null&&a(e,["finishReason"],r);const l=s(t,["avgLogprobs"]);l!=null&&a(e,["avgLogprobs"],l);const u=s(t,["groundingMetadata"]);u!=null&&a(e,["groundingMetadata"],u);const d=s(t,["index"]);d!=null&&a(e,["index"],d);const c=s(t,["logprobsResult"]);c!=null&&a(e,["logprobsResult"],c);const f=s(t,["safetyRatings"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(g=>g)),a(e,["safetyRatings"],h)}const m=s(t,["urlContextMetadata"]);return m!=null&&a(e,["urlContextMetadata"],m),e}function tl(t){const e={},n=s(t,["citationSources"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>i)),a(e,["citations"],o)}return e}function ss(t){const e={},n=s(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Ml(r))),a(e,["parts"],i)}const o=s(t,["role"]);return o!=null&&a(e,["role"],o),e}function nl(t,e){const n={},o=s(t,["displayName"]);if(e!==void 0&&o!=null&&a(e,["batch","displayName"],o),s(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function ol(t,e){const n={},o=s(t,["displayName"]);e!==void 0&&o!=null&&a(e,["displayName"],o);const i=s(t,["dest"]);return e!==void 0&&i!=null&&a(e,["outputConfig"],Wa(Ka(i))),n}function di(t,e){const n={},o=s(e,["model"]);o!=null&&a(n,["_url","model"],V(t,o));const i=s(e,["src"]);i!=null&&a(n,["batch","inputConfig"],za(t,ns(t,i)));const r=s(e,["config"]);return r!=null&&nl(r,n),n}function il(t,e){const n={},o=s(e,["model"]);o!=null&&a(n,["model"],V(t,o));const i=s(e,["src"]);i!=null&&a(n,["inputConfig"],Xa(ns(t,i)));const r=s(e,["config"]);return r!=null&&ol(r,n),n}function sl(t,e){const n={},o=s(t,["displayName"]);return e!==void 0&&o!=null&&a(e,["batch","displayName"],o),n}function rl(t,e){const n={},o=s(e,["model"]);o!=null&&a(n,["_url","model"],V(t,o));const i=s(e,["src"]);i!=null&&a(n,["batch","inputConfig"],pl(t,i));const r=s(e,["config"]);return r!=null&&sl(r,n),n}function al(t,e){const n={},o=s(e,["name"]);return o!=null&&a(n,["_url","name"],Ve(t,o)),n}function ll(t,e){const n={},o=s(e,["name"]);return o!=null&&a(n,["_url","name"],Ve(t,o)),n}function ul(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["name"]);o!=null&&a(e,["name"],o);const i=s(t,["done"]);i!=null&&a(e,["done"],i);const r=s(t,["error"]);return r!=null&&a(e,["error"],r),e}function cl(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["name"]);o!=null&&a(e,["name"],o);const i=s(t,["done"]);i!=null&&a(e,["done"],i);const r=s(t,["error"]);return r!=null&&a(e,["error"],r),e}function dl(t,e){const n={},o=s(e,["contents"]);if(o!=null){let r=an(t,o);Array.isArray(r)&&(r=r.map(l=>l)),a(n,["requests[]","request","content"],r)}const i=s(e,["config"]);return i!=null&&(a(n,["_self"],fl(i,n)),ra(n,{"requests[].*":"requests[].request.*"})),n}function fl(t,e){const n={},o=s(t,["taskType"]);e!==void 0&&o!=null&&a(e,["requests[]","taskType"],o);const i=s(t,["title"]);e!==void 0&&i!=null&&a(e,["requests[]","title"],i);const r=s(t,["outputDimensionality"]);if(e!==void 0&&r!=null&&a(e,["requests[]","outputDimensionality"],r),s(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(s(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function pl(t,e){const n={},o=s(e,["fileName"]);o!=null&&a(n,["file_name"],o);const i=s(e,["inlinedRequests"]);return i!=null&&a(n,["requests"],dl(t,i)),n}function ml(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function hl(t){const e={},n=s(t,["id"]);n!=null&&a(e,["id"],n);const o=s(t,["args"]);o!=null&&a(e,["args"],o);const i=s(t,["name"]);if(i!=null&&a(e,["name"],i),s(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(s(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function gl(t){const e={},n=s(t,["allowedFunctionNames"]);n!=null&&a(e,["allowedFunctionNames"],n);const o=s(t,["mode"]);if(o!=null&&a(e,["mode"],o),s(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function yl(t,e,n){const o={},i=s(e,["systemInstruction"]);n!==void 0&&i!=null&&a(n,["systemInstruction"],ss(X(i)));const r=s(e,["temperature"]);r!=null&&a(o,["temperature"],r);const l=s(e,["topP"]);l!=null&&a(o,["topP"],l);const u=s(e,["topK"]);u!=null&&a(o,["topK"],u);const d=s(e,["candidateCount"]);d!=null&&a(o,["candidateCount"],d);const c=s(e,["maxOutputTokens"]);c!=null&&a(o,["maxOutputTokens"],c);const f=s(e,["stopSequences"]);f!=null&&a(o,["stopSequences"],f);const m=s(e,["responseLogprobs"]);m!=null&&a(o,["responseLogprobs"],m);const h=s(e,["logprobs"]);h!=null&&a(o,["logprobs"],h);const g=s(e,["presencePenalty"]);g!=null&&a(o,["presencePenalty"],g);const y=s(e,["frequencyPenalty"]);y!=null&&a(o,["frequencyPenalty"],y);const x=s(e,["seed"]);x!=null&&a(o,["seed"],x);const T=s(e,["responseMimeType"]);T!=null&&a(o,["responseMimeType"],T);const C=s(e,["responseSchema"]);C!=null&&a(o,["responseSchema"],ln(C));const A=s(e,["responseJsonSchema"]);if(A!=null&&a(o,["responseJsonSchema"],A),s(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(s(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const S=s(e,["safetySettings"]);if(n!==void 0&&S!=null){let K=S;Array.isArray(K)&&(K=K.map($=>kl($))),a(n,["safetySettings"],K)}const E=s(e,["tools"]);if(n!==void 0&&E!=null){let K=Ge(E);Array.isArray(K)&&(K=K.map($=>Ul(Fe($)))),a(n,["tools"],K)}const N=s(e,["toolConfig"]);if(n!==void 0&&N!=null&&a(n,["toolConfig"],Dl(N)),s(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const _=s(e,["cachedContent"]);n!==void 0&&_!=null&&a(n,["cachedContent"],Ce(t,_));const I=s(e,["responseModalities"]);I!=null&&a(o,["responseModalities"],I);const M=s(e,["mediaResolution"]);M!=null&&a(o,["mediaResolution"],M);const P=s(e,["speechConfig"]);if(P!=null&&a(o,["speechConfig"],un(P)),s(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const D=s(e,["thinkingConfig"]);D!=null&&a(o,["thinkingConfig"],D);const F=s(e,["imageConfig"]);F!=null&&a(o,["imageConfig"],Cl(F));const H=s(e,["enableEnhancedCivicAnswers"]);if(H!=null&&a(o,["enableEnhancedCivicAnswers"],H),s(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return o}function vl(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["candidates"]);if(o!=null){let d=o;Array.isArray(d)&&(d=d.map(c=>el(c))),a(e,["candidates"],d)}const i=s(t,["modelVersion"]);i!=null&&a(e,["modelVersion"],i);const r=s(t,["promptFeedback"]);r!=null&&a(e,["promptFeedback"],r);const l=s(t,["responseId"]);l!=null&&a(e,["responseId"],l);const u=s(t,["usageMetadata"]);return u!=null&&a(e,["usageMetadata"],u),e}function Tl(t,e){const n={},o=s(e,["name"]);return o!=null&&a(n,["_url","name"],Ve(t,o)),n}function xl(t,e){const n={},o=s(e,["name"]);return o!=null&&a(n,["_url","name"],Ve(t,o)),n}function _l(t){const e={};if(s(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=s(t,["enableWidget"]);return n!=null&&a(e,["enableWidget"],n),e}function El(t){const e={};if(s(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(s(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=s(t,["timeRangeFilter"]);return n!=null&&a(e,["timeRangeFilter"],n),e}function Cl(t){const e={},n=s(t,["aspectRatio"]);n!=null&&a(e,["aspectRatio"],n);const o=s(t,["imageSize"]);if(o!=null&&a(e,["imageSize"],o),s(t,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(s(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(s(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Sl(t,e){const n={},o=s(e,["model"]);o!=null&&a(n,["request","model"],V(t,o));const i=s(e,["contents"]);if(i!=null){let u=se(i);Array.isArray(u)&&(u=u.map(d=>ss(d))),a(n,["request","contents"],u)}const r=s(e,["metadata"]);r!=null&&a(n,["metadata"],r);const l=s(e,["config"]);return l!=null&&a(n,["request","generationConfig"],yl(t,l,s(n,["request"],{}))),n}function Il(t){const e={},n=s(t,["response"]);n!=null&&a(e,["response"],vl(n));const o=s(t,["metadata"]);o!=null&&a(e,["metadata"],o);const i=s(t,["error"]);return i!=null&&a(e,["error"],i),e}function wl(t,e){const n={},o=s(t,["pageSize"]);e!==void 0&&o!=null&&a(e,["_query","pageSize"],o);const i=s(t,["pageToken"]);if(e!==void 0&&i!=null&&a(e,["_query","pageToken"],i),s(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function Al(t,e){const n={},o=s(t,["pageSize"]);e!==void 0&&o!=null&&a(e,["_query","pageSize"],o);const i=s(t,["pageToken"]);e!==void 0&&i!=null&&a(e,["_query","pageToken"],i);const r=s(t,["filter"]);return e!==void 0&&r!=null&&a(e,["_query","filter"],r),n}function Nl(t){const e={},n=s(t,["config"]);return n!=null&&wl(n,e),e}function bl(t){const e={},n=s(t,["config"]);return n!=null&&Al(n,e),e}function Rl(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["nextPageToken"]);o!=null&&a(e,["nextPageToken"],o);const i=s(t,["operations"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>ut(l))),a(e,["batchJobs"],r)}return e}function Pl(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["nextPageToken"]);o!=null&&a(e,["nextPageToken"],o);const i=s(t,["batchPredictionJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>Jt(l))),a(e,["batchJobs"],r)}return e}function Ml(t){const e={},n=s(t,["mediaResolution"]);n!=null&&a(e,["mediaResolution"],n);const o=s(t,["codeExecutionResult"]);o!=null&&a(e,["codeExecutionResult"],o);const i=s(t,["executableCode"]);i!=null&&a(e,["executableCode"],i);const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],ml(r));const l=s(t,["functionCall"]);l!=null&&a(e,["functionCall"],hl(l));const u=s(t,["functionResponse"]);u!=null&&a(e,["functionResponse"],u);const d=s(t,["inlineData"]);d!=null&&a(e,["inlineData"],Qa(d));const c=s(t,["text"]);c!=null&&a(e,["text"],c);const f=s(t,["thought"]);f!=null&&a(e,["thought"],f);const m=s(t,["thoughtSignature"]);m!=null&&a(e,["thoughtSignature"],m);const h=s(t,["videoMetadata"]);return h!=null&&a(e,["videoMetadata"],h),e}function kl(t){const e={},n=s(t,["category"]);if(n!=null&&a(e,["category"],n),s(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const o=s(t,["threshold"]);return o!=null&&a(e,["threshold"],o),e}function Dl(t){const e={},n=s(t,["retrievalConfig"]);n!=null&&a(e,["retrievalConfig"],n);const o=s(t,["functionCallingConfig"]);return o!=null&&a(e,["functionCallingConfig"],gl(o)),e}function Ul(t){const e={};if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=s(t,["computerUse"]);n!=null&&a(e,["computerUse"],n);const o=s(t,["fileSearch"]);o!=null&&a(e,["fileSearch"],o);const i=s(t,["codeExecution"]);if(i!=null&&a(e,["codeExecution"],i),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const r=s(t,["functionDeclarations"]);if(r!=null){let f=r;Array.isArray(f)&&(f=f.map(m=>m)),a(e,["functionDeclarations"],f)}const l=s(t,["googleMaps"]);l!=null&&a(e,["googleMaps"],_l(l));const u=s(t,["googleSearch"]);u!=null&&a(e,["googleSearch"],El(u));const d=s(t,["googleSearchRetrieval"]);d!=null&&a(e,["googleSearchRetrieval"],d);const c=s(t,["urlContext"]);return c!=null&&a(e,["urlContext"],c),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var _e;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(_e||(_e={}));class be{constructor(e,n,o,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,o,i)}init(e,n,o){var i,r;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let l={config:{}};!o||Object.keys(o).length===0?l={config:{}}:typeof o=="object"?l=Object.assign({},o):l=o,l.config&&(l.config.pageToken=n.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(r=(i=l.config)===null||i===void 0?void 0:i.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ll extends Ee{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new be(_e.PAGED_ITEM_BATCH_JOBS,o=>this.listInternal(o),await this.listInternal(n),n),this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)}}createInlinedGenerateContentRequest(e){const n=di(this.apiClient,e),o=n._url,i=b("{model}:batchGenerateContent",o),u=n.batch.inputConfig.requests,d=u.requests,c=[];for(const f of d){const m=Object.assign({},f);if(m.systemInstruction){const h=m.systemInstruction;delete m.systemInstruction;const g=m.request;g.systemInstruction=h,m.request=g}c.push(m)}return u.requests=c,delete n.config,delete n._url,delete n._query,{path:i,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const o=n?Object.assign({},n):{},i=Date.now().toString();if(o.displayName||(o.displayName=`genaiBatchJob_${i}`),o.dest===void 0){const r=this.getGcsUri(e),l=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?o.dest=`${r.slice(0,-6)}/dest`:o.dest=`${r}_dest_${i}`;else if(l)o.dest=`${l}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return o}async createInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=il(this.apiClient,e);return u=b("batchPredictionJobs",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Jt(f))}else{const c=di(this.apiClient,e);return u=b("{model}:batchGenerateContent",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>ut(f))}}async createEmbeddingsInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=rl(this.apiClient,e);return r=b("{model}:asyncBatchEmbedContent",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>ut(d))}}async get(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=xl(this.apiClient,e);return u=b("batchPredictionJobs/{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Jt(f))}else{const c=Tl(this.apiClient,e);return u=b("batches/{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>ut(f))}}async cancel(e){var n,o,i,r;let l="",u={};if(this.apiClient.isVertexAI()){const d=ja(this.apiClient,e);l=b("batchPredictionJobs/{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}else{const d=Za(this.apiClient,e);l=b("batches/{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=bl(e);return u=b("batchPredictionJobs",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=Pl(f),h=new ai;return Object.assign(h,m),h})}else{const c=Nl(e);return u=b("batches",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=Rl(f),h=new ai;return Object.assign(h,m),h})}}async delete(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=ll(this.apiClient,e);return u=b("batchPredictionJobs/{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>cl(f))}else{const c=al(this.apiClient,e);return u=b("batches/{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>ul(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Fl(t){const e={},n=s(t,["data"]);if(n!=null&&a(e,["data"],n),s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function fi(t){const e={},n=s(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>ru(r))),a(e,["parts"],i)}const o=s(t,["role"]);return o!=null&&a(e,["role"],o),e}function Gl(t,e){const n={},o=s(t,["ttl"]);e!==void 0&&o!=null&&a(e,["ttl"],o);const i=s(t,["expireTime"]);e!==void 0&&i!=null&&a(e,["expireTime"],i);const r=s(t,["displayName"]);e!==void 0&&r!=null&&a(e,["displayName"],r);const l=s(t,["contents"]);if(e!==void 0&&l!=null){let f=se(l);Array.isArray(f)&&(f=f.map(m=>fi(m))),a(e,["contents"],f)}const u=s(t,["systemInstruction"]);e!==void 0&&u!=null&&a(e,["systemInstruction"],fi(X(u)));const d=s(t,["tools"]);if(e!==void 0&&d!=null){let f=d;Array.isArray(f)&&(f=f.map(m=>lu(m))),a(e,["tools"],f)}const c=s(t,["toolConfig"]);if(e!==void 0&&c!=null&&a(e,["toolConfig"],au(c)),s(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function Vl(t,e){const n={},o=s(t,["ttl"]);e!==void 0&&o!=null&&a(e,["ttl"],o);const i=s(t,["expireTime"]);e!==void 0&&i!=null&&a(e,["expireTime"],i);const r=s(t,["displayName"]);e!==void 0&&r!=null&&a(e,["displayName"],r);const l=s(t,["contents"]);if(e!==void 0&&l!=null){let m=se(l);Array.isArray(m)&&(m=m.map(h=>h)),a(e,["contents"],m)}const u=s(t,["systemInstruction"]);e!==void 0&&u!=null&&a(e,["systemInstruction"],X(u));const d=s(t,["tools"]);if(e!==void 0&&d!=null){let m=d;Array.isArray(m)&&(m=m.map(h=>uu(h))),a(e,["tools"],m)}const c=s(t,["toolConfig"]);e!==void 0&&c!=null&&a(e,["toolConfig"],c);const f=s(t,["kmsKeyName"]);return e!==void 0&&f!=null&&a(e,["encryption_spec","kmsKeyName"],f),n}function Hl(t,e){const n={},o=s(e,["model"]);o!=null&&a(n,["model"],Wi(t,o));const i=s(e,["config"]);return i!=null&&Gl(i,n),n}function ql(t,e){const n={},o=s(e,["model"]);o!=null&&a(n,["model"],Wi(t,o));const i=s(e,["config"]);return i!=null&&Vl(i,n),n}function Bl(t,e){const n={},o=s(e,["name"]);return o!=null&&a(n,["_url","name"],Ce(t,o)),n}function Kl(t,e){const n={},o=s(e,["name"]);return o!=null&&a(n,["_url","name"],Ce(t,o)),n}function $l(t){const e={},n=s(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function Jl(t){const e={},n=s(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function Ol(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Wl(t){const e={},n=s(t,["id"]);n!=null&&a(e,["id"],n);const o=s(t,["args"]);o!=null&&a(e,["args"],o);const i=s(t,["name"]);if(i!=null&&a(e,["name"],i),s(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(s(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Yl(t){const e={},n=s(t,["allowedFunctionNames"]);n!=null&&a(e,["allowedFunctionNames"],n);const o=s(t,["mode"]);if(o!=null&&a(e,["mode"],o),s(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function zl(t){const e={},n=s(t,["description"]);n!=null&&a(e,["description"],n);const o=s(t,["name"]);o!=null&&a(e,["name"],o);const i=s(t,["parameters"]);i!=null&&a(e,["parameters"],i);const r=s(t,["parametersJsonSchema"]);r!=null&&a(e,["parametersJsonSchema"],r);const l=s(t,["response"]);l!=null&&a(e,["response"],l);const u=s(t,["responseJsonSchema"]);if(u!=null&&a(e,["responseJsonSchema"],u),s(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function Xl(t,e){const n={},o=s(e,["name"]);return o!=null&&a(n,["_url","name"],Ce(t,o)),n}function Ql(t,e){const n={},o=s(e,["name"]);return o!=null&&a(n,["_url","name"],Ce(t,o)),n}function Zl(t){const e={};if(s(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=s(t,["enableWidget"]);return n!=null&&a(e,["enableWidget"],n),e}function jl(t){const e={};if(s(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(s(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=s(t,["timeRangeFilter"]);return n!=null&&a(e,["timeRangeFilter"],n),e}function eu(t,e){const n={},o=s(t,["pageSize"]);e!==void 0&&o!=null&&a(e,["_query","pageSize"],o);const i=s(t,["pageToken"]);return e!==void 0&&i!=null&&a(e,["_query","pageToken"],i),n}function tu(t,e){const n={},o=s(t,["pageSize"]);e!==void 0&&o!=null&&a(e,["_query","pageSize"],o);const i=s(t,["pageToken"]);return e!==void 0&&i!=null&&a(e,["_query","pageToken"],i),n}function nu(t){const e={},n=s(t,["config"]);return n!=null&&eu(n,e),e}function ou(t){const e={},n=s(t,["config"]);return n!=null&&tu(n,e),e}function iu(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["nextPageToken"]);o!=null&&a(e,["nextPageToken"],o);const i=s(t,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>l)),a(e,["cachedContents"],r)}return e}function su(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["nextPageToken"]);o!=null&&a(e,["nextPageToken"],o);const i=s(t,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>l)),a(e,["cachedContents"],r)}return e}function ru(t){const e={},n=s(t,["mediaResolution"]);n!=null&&a(e,["mediaResolution"],n);const o=s(t,["codeExecutionResult"]);o!=null&&a(e,["codeExecutionResult"],o);const i=s(t,["executableCode"]);i!=null&&a(e,["executableCode"],i);const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],Ol(r));const l=s(t,["functionCall"]);l!=null&&a(e,["functionCall"],Wl(l));const u=s(t,["functionResponse"]);u!=null&&a(e,["functionResponse"],u);const d=s(t,["inlineData"]);d!=null&&a(e,["inlineData"],Fl(d));const c=s(t,["text"]);c!=null&&a(e,["text"],c);const f=s(t,["thought"]);f!=null&&a(e,["thought"],f);const m=s(t,["thoughtSignature"]);m!=null&&a(e,["thoughtSignature"],m);const h=s(t,["videoMetadata"]);return h!=null&&a(e,["videoMetadata"],h),e}function au(t){const e={},n=s(t,["retrievalConfig"]);n!=null&&a(e,["retrievalConfig"],n);const o=s(t,["functionCallingConfig"]);return o!=null&&a(e,["functionCallingConfig"],Yl(o)),e}function lu(t){const e={};if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=s(t,["computerUse"]);n!=null&&a(e,["computerUse"],n);const o=s(t,["fileSearch"]);o!=null&&a(e,["fileSearch"],o);const i=s(t,["codeExecution"]);if(i!=null&&a(e,["codeExecution"],i),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const r=s(t,["functionDeclarations"]);if(r!=null){let f=r;Array.isArray(f)&&(f=f.map(m=>m)),a(e,["functionDeclarations"],f)}const l=s(t,["googleMaps"]);l!=null&&a(e,["googleMaps"],Zl(l));const u=s(t,["googleSearch"]);u!=null&&a(e,["googleSearch"],jl(u));const d=s(t,["googleSearchRetrieval"]);d!=null&&a(e,["googleSearchRetrieval"],d);const c=s(t,["urlContext"]);return c!=null&&a(e,["urlContext"],c),e}function uu(t){const e={},n=s(t,["retrieval"]);n!=null&&a(e,["retrieval"],n);const o=s(t,["computerUse"]);if(o!=null&&a(e,["computerUse"],o),s(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const i=s(t,["codeExecution"]);i!=null&&a(e,["codeExecution"],i);const r=s(t,["enterpriseWebSearch"]);r!=null&&a(e,["enterpriseWebSearch"],r);const l=s(t,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(h=>zl(h))),a(e,["functionDeclarations"],m)}const u=s(t,["googleMaps"]);u!=null&&a(e,["googleMaps"],u);const d=s(t,["googleSearch"]);d!=null&&a(e,["googleSearch"],d);const c=s(t,["googleSearchRetrieval"]);c!=null&&a(e,["googleSearchRetrieval"],c);const f=s(t,["urlContext"]);return f!=null&&a(e,["urlContext"],f),e}function cu(t,e){const n={},o=s(t,["ttl"]);e!==void 0&&o!=null&&a(e,["ttl"],o);const i=s(t,["expireTime"]);return e!==void 0&&i!=null&&a(e,["expireTime"],i),n}function du(t,e){const n={},o=s(t,["ttl"]);e!==void 0&&o!=null&&a(e,["ttl"],o);const i=s(t,["expireTime"]);return e!==void 0&&i!=null&&a(e,["expireTime"],i),n}function fu(t,e){const n={},o=s(e,["name"]);o!=null&&a(n,["_url","name"],Ce(t,o));const i=s(e,["config"]);return i!=null&&cu(i,n),n}function pu(t,e){const n={},o=s(e,["name"]);o!=null&&a(n,["_url","name"],Ce(t,o));const i=s(e,["config"]);return i!=null&&du(i,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mu extends Ee{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new be(_e.PAGED_ITEM_CACHED_CONTENTS,o=>this.listInternal(o),await this.listInternal(n),n)}async create(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=ql(this.apiClient,e);return u=b("cachedContents",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>f)}else{const c=Hl(this.apiClient,e);return u=b("cachedContents",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>f)}}async get(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ql(this.apiClient,e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>f)}else{const c=Xl(this.apiClient,e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>f)}}async delete(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Kl(this.apiClient,e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=Jl(f),h=new si;return Object.assign(h,m),h})}else{const c=Bl(this.apiClient,e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=$l(f),h=new si;return Object.assign(h,m),h})}}async update(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=pu(this.apiClient,e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>f)}else{const c=fu(this.apiClient,e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>f)}}async listInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=ou(e);return u=b("cachedContents",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=su(f),h=new ri;return Object.assign(h,m),h})}else{const c=nu(e);return u=b("cachedContents",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=iu(f),h=new ri;return Object.assign(h,m),h})}}}function ht(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(t);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(t,o[i])&&(n[o[i]]=t[o[i]]);return n}function pi(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],o=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function U(t){return this instanceof U?(this.v=t,this):new U(t)}function fe(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=n.apply(t,e||[]),i,r=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",l),i[Symbol.asyncIterator]=function(){return this},i;function l(g){return function(y){return Promise.resolve(y).then(g,m)}}function u(g,y){o[g]&&(i[g]=function(x){return new Promise(function(T,C){r.push([g,x,T,C])>1||d(g,x)})},y&&(i[g]=y(i[g])))}function d(g,y){try{c(o[g](y))}catch(x){h(r[0][3],x)}}function c(g){g.value instanceof U?Promise.resolve(g.value.v).then(f,m):h(r[0][2],g)}function f(g){d("next",g)}function m(g){d("throw",g)}function h(g,y){g(y),r.shift(),r.length&&d(r[0][0],r[0][1])}}function pe(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof pi=="function"?pi(t):t[Symbol.iterator](),n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n);function o(r){n[r]=t[r]&&function(l){return new Promise(function(u,d){l=t[r](l),i(u,d,l.done,l.value)})}}function i(r,l,u,d){Promise.resolve(d).then(function(c){r({value:c,done:u})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hu(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:rs(n)}function rs(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function gu(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function mi(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let o=0;for(;o<n;)if(t[o].role==="user")e.push(t[o]),o++;else{const i=[];let r=!0;for(;o<n&&t[o].role==="model";)i.push(t[o]),r&&!rs(t[o])&&(r=!1),o++;r?e.push(...i):e.pop()}return e}class yu{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new vu(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class vu{constructor(e,n,o,i={},r=[]){this.apiClient=e,this.modelsModule=n,this.model=o,this.config=i,this.history=r,this.sendPromise=Promise.resolve(),gu(r)}async sendMessage(e){var n;await this.sendPromise;const o=X(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(o),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var r,l,u;const d=await i,c=(l=(r=d.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content,f=d.automaticFunctionCallingHistory,m=this.getHistory(!0).length;let h=[];f!=null&&(h=(u=f.slice(m))!==null&&u!==void 0?u:[]);const g=c?[c]:[];this.recordHistory(o,g,h)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var n;await this.sendPromise;const o=X(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(o),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const r=await i;return this.processStreamResponse(r,o)}getHistory(e=!1){const n=e?mi(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){return fe(this,arguments,function*(){var i,r,l,u,d,c;const f=[];try{for(var m=!0,h=pe(e),g;g=yield U(h.next()),i=g.done,!i;m=!0){u=g.value,m=!1;const y=u;if(hu(y)){const x=(c=(d=y.candidates)===null||d===void 0?void 0:d[0])===null||c===void 0?void 0:c.content;x!==void 0&&f.push(x)}yield yield U(y)}}catch(y){r={error:y}}finally{try{!m&&!i&&(l=h.return)&&(yield U(l.call(h)))}finally{if(r)throw r.error}}this.recordHistory(n,f)})}recordHistory(e,n,o){let i=[];n.length>0&&n.every(r=>r.role!==void 0)?i=n:i.push({role:"model",parts:[]}),o&&o.length>0?this.history.push(...mi(o)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ze extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,ze.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Tu(t){const e={},n=s(t,["file"]);return n!=null&&a(e,["file"],n),e}function xu(t){const e={},n=s(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function _u(t){const e={},n=s(t,["name"]);return n!=null&&a(e,["_url","file"],ji(n)),e}function Eu(t){const e={},n=s(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function Cu(t){const e={},n=s(t,["name"]);return n!=null&&a(e,["_url","file"],ji(n)),e}function Su(t){const e={},n=s(t,["uris"]);return n!=null&&a(e,["uris"],n),e}function Iu(t,e){const n={},o=s(t,["pageSize"]);e!==void 0&&o!=null&&a(e,["_query","pageSize"],o);const i=s(t,["pageToken"]);return e!==void 0&&i!=null&&a(e,["_query","pageToken"],i),n}function wu(t){const e={},n=s(t,["config"]);return n!=null&&Iu(n,e),e}function Au(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["nextPageToken"]);o!=null&&a(e,["nextPageToken"],o);const i=s(t,["files"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>l)),a(e,["files"],r)}return e}function Nu(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["files"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(r=>r)),a(e,["files"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class bu extends Ee{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new be(_e.PAGED_ITEM_FILES,o=>this.listInternal(o),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async registerFiles(e){throw new Error("registerFiles is only supported in Node.js environments.")}async _registerFiles(e){return this.registerFilesInternal(e)}async listInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=wu(e);return r=b("files",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=Au(d),f=new ba;return Object.assign(f,c),f})}}async createInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Tu(e);return r=b("upload/v1beta/files",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const c=xu(d),f=new Ra;return Object.assign(f,c),f})}}async get(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Cu(e);return r=b("files/{file}",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=_u(e);return r=b("files/{file}",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=Eu(d),f=new Pa;return Object.assign(f,c),f})}}async registerFilesInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Su(e);return r=b("files:register",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Nu(d),f=new Ma;return Object.assign(f,c),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ct(t){const e={},n=s(t,["data"]);if(n!=null&&a(e,["data"],n),s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Ru(t){const e={},n=s(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Ou(r))),a(e,["parts"],i)}const o=s(t,["role"]);return o!=null&&a(e,["role"],o),e}function Pu(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Mu(t){const e={},n=s(t,["id"]);n!=null&&a(e,["id"],n);const o=s(t,["args"]);o!=null&&a(e,["args"],o);const i=s(t,["name"]);if(i!=null&&a(e,["name"],i),s(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(s(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function ku(t){const e={},n=s(t,["description"]);n!=null&&a(e,["description"],n);const o=s(t,["name"]);o!=null&&a(e,["name"],o);const i=s(t,["parameters"]);i!=null&&a(e,["parameters"],i);const r=s(t,["parametersJsonSchema"]);r!=null&&a(e,["parametersJsonSchema"],r);const l=s(t,["response"]);l!=null&&a(e,["response"],l);const u=s(t,["responseJsonSchema"]);if(u!=null&&a(e,["responseJsonSchema"],u),s(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function Du(t){const e={},n=s(t,["modelSelectionConfig"]);n!=null&&a(e,["modelConfig"],n);const o=s(t,["responseJsonSchema"]);o!=null&&a(e,["responseJsonSchema"],o);const i=s(t,["audioTimestamp"]);i!=null&&a(e,["audioTimestamp"],i);const r=s(t,["candidateCount"]);r!=null&&a(e,["candidateCount"],r);const l=s(t,["enableAffectiveDialog"]);l!=null&&a(e,["enableAffectiveDialog"],l);const u=s(t,["frequencyPenalty"]);u!=null&&a(e,["frequencyPenalty"],u);const d=s(t,["logprobs"]);d!=null&&a(e,["logprobs"],d);const c=s(t,["maxOutputTokens"]);c!=null&&a(e,["maxOutputTokens"],c);const f=s(t,["mediaResolution"]);f!=null&&a(e,["mediaResolution"],f);const m=s(t,["presencePenalty"]);m!=null&&a(e,["presencePenalty"],m);const h=s(t,["responseLogprobs"]);h!=null&&a(e,["responseLogprobs"],h);const g=s(t,["responseMimeType"]);g!=null&&a(e,["responseMimeType"],g);const y=s(t,["responseModalities"]);y!=null&&a(e,["responseModalities"],y);const x=s(t,["responseSchema"]);x!=null&&a(e,["responseSchema"],x);const T=s(t,["routingConfig"]);T!=null&&a(e,["routingConfig"],T);const C=s(t,["seed"]);C!=null&&a(e,["seed"],C);const A=s(t,["speechConfig"]);A!=null&&a(e,["speechConfig"],A);const S=s(t,["stopSequences"]);S!=null&&a(e,["stopSequences"],S);const E=s(t,["temperature"]);E!=null&&a(e,["temperature"],E);const N=s(t,["thinkingConfig"]);N!=null&&a(e,["thinkingConfig"],N);const _=s(t,["topK"]);_!=null&&a(e,["topK"],_);const I=s(t,["topP"]);if(I!=null&&a(e,["topP"],I),s(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Uu(t){const e={};if(s(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=s(t,["enableWidget"]);return n!=null&&a(e,["enableWidget"],n),e}function Lu(t){const e={};if(s(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(s(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=s(t,["timeRangeFilter"]);return n!=null&&a(e,["timeRangeFilter"],n),e}function Fu(t,e){const n={},o=s(t,["generationConfig"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig"],o);const i=s(t,["responseModalities"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig","responseModalities"],i);const r=s(t,["temperature"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig","temperature"],r);const l=s(t,["topP"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","topP"],l);const u=s(t,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const d=s(t,["maxOutputTokens"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","maxOutputTokens"],d);const c=s(t,["mediaResolution"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","mediaResolution"],c);const f=s(t,["seed"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","seed"],f);const m=s(t,["speechConfig"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","speechConfig"],cn(m));const h=s(t,["thinkingConfig"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","thinkingConfig"],h);const g=s(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],g);const y=s(t,["systemInstruction"]);e!==void 0&&y!=null&&a(e,["setup","systemInstruction"],Ru(X(y)));const x=s(t,["tools"]);if(e!==void 0&&x!=null){let _=Ge(x);Array.isArray(_)&&(_=_.map(I=>Yu(Fe(I)))),a(e,["setup","tools"],_)}const T=s(t,["sessionResumption"]);e!==void 0&&T!=null&&a(e,["setup","sessionResumption"],Wu(T));const C=s(t,["inputAudioTranscription"]);e!==void 0&&C!=null&&a(e,["setup","inputAudioTranscription"],C);const A=s(t,["outputAudioTranscription"]);e!==void 0&&A!=null&&a(e,["setup","outputAudioTranscription"],A);const S=s(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&a(e,["setup","realtimeInputConfig"],S);const E=s(t,["contextWindowCompression"]);e!==void 0&&E!=null&&a(e,["setup","contextWindowCompression"],E);const N=s(t,["proactivity"]);if(e!==void 0&&N!=null&&a(e,["setup","proactivity"],N),s(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function Gu(t,e){const n={},o=s(t,["generationConfig"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig"],Du(o));const i=s(t,["responseModalities"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig","responseModalities"],i);const r=s(t,["temperature"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig","temperature"],r);const l=s(t,["topP"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","topP"],l);const u=s(t,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const d=s(t,["maxOutputTokens"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","maxOutputTokens"],d);const c=s(t,["mediaResolution"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","mediaResolution"],c);const f=s(t,["seed"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","seed"],f);const m=s(t,["speechConfig"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","speechConfig"],cn(m));const h=s(t,["thinkingConfig"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","thinkingConfig"],h);const g=s(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],g);const y=s(t,["systemInstruction"]);e!==void 0&&y!=null&&a(e,["setup","systemInstruction"],X(y));const x=s(t,["tools"]);if(e!==void 0&&x!=null){let I=Ge(x);Array.isArray(I)&&(I=I.map(M=>zu(Fe(M)))),a(e,["setup","tools"],I)}const T=s(t,["sessionResumption"]);e!==void 0&&T!=null&&a(e,["setup","sessionResumption"],T);const C=s(t,["inputAudioTranscription"]);e!==void 0&&C!=null&&a(e,["setup","inputAudioTranscription"],C);const A=s(t,["outputAudioTranscription"]);e!==void 0&&A!=null&&a(e,["setup","outputAudioTranscription"],A);const S=s(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&a(e,["setup","realtimeInputConfig"],S);const E=s(t,["contextWindowCompression"]);e!==void 0&&E!=null&&a(e,["setup","contextWindowCompression"],E);const N=s(t,["proactivity"]);e!==void 0&&N!=null&&a(e,["setup","proactivity"],N);const _=s(t,["explicitVadSignal"]);return e!==void 0&&_!=null&&a(e,["setup","explicitVadSignal"],_),n}function Vu(t,e){const n={},o=s(e,["model"]);o!=null&&a(n,["setup","model"],V(t,o));const i=s(e,["config"]);return i!=null&&a(n,["config"],Fu(i,n)),n}function Hu(t,e){const n={},o=s(e,["model"]);o!=null&&a(n,["setup","model"],V(t,o));const i=s(e,["config"]);return i!=null&&a(n,["config"],Gu(i,n)),n}function qu(t){const e={},n=s(t,["musicGenerationConfig"]);return n!=null&&a(e,["musicGenerationConfig"],n),e}function Bu(t){const e={},n=s(t,["weightedPrompts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>i)),a(e,["weightedPrompts"],o)}return e}function Ku(t){const e={},n=s(t,["media"]);if(n!=null){let c=Yi(n);Array.isArray(c)&&(c=c.map(f=>ct(f))),a(e,["mediaChunks"],c)}const o=s(t,["audio"]);o!=null&&a(e,["audio"],ct(Xi(o)));const i=s(t,["audioStreamEnd"]);i!=null&&a(e,["audioStreamEnd"],i);const r=s(t,["video"]);r!=null&&a(e,["video"],ct(zi(r)));const l=s(t,["text"]);l!=null&&a(e,["text"],l);const u=s(t,["activityStart"]);u!=null&&a(e,["activityStart"],u);const d=s(t,["activityEnd"]);return d!=null&&a(e,["activityEnd"],d),e}function $u(t){const e={},n=s(t,["media"]);if(n!=null){let c=Yi(n);Array.isArray(c)&&(c=c.map(f=>f)),a(e,["mediaChunks"],c)}const o=s(t,["audio"]);o!=null&&a(e,["audio"],Xi(o));const i=s(t,["audioStreamEnd"]);i!=null&&a(e,["audioStreamEnd"],i);const r=s(t,["video"]);r!=null&&a(e,["video"],zi(r));const l=s(t,["text"]);l!=null&&a(e,["text"],l);const u=s(t,["activityStart"]);u!=null&&a(e,["activityStart"],u);const d=s(t,["activityEnd"]);return d!=null&&a(e,["activityEnd"],d),e}function Ju(t){const e={},n=s(t,["setupComplete"]);n!=null&&a(e,["setupComplete"],n);const o=s(t,["serverContent"]);o!=null&&a(e,["serverContent"],o);const i=s(t,["toolCall"]);i!=null&&a(e,["toolCall"],i);const r=s(t,["toolCallCancellation"]);r!=null&&a(e,["toolCallCancellation"],r);const l=s(t,["usageMetadata"]);l!=null&&a(e,["usageMetadata"],Xu(l));const u=s(t,["goAway"]);u!=null&&a(e,["goAway"],u);const d=s(t,["sessionResumptionUpdate"]);d!=null&&a(e,["sessionResumptionUpdate"],d);const c=s(t,["voiceActivityDetectionSignal"]);c!=null&&a(e,["voiceActivityDetectionSignal"],c);const f=s(t,["voiceActivity"]);return f!=null&&a(e,["voiceActivity"],Qu(f)),e}function Ou(t){const e={},n=s(t,["mediaResolution"]);n!=null&&a(e,["mediaResolution"],n);const o=s(t,["codeExecutionResult"]);o!=null&&a(e,["codeExecutionResult"],o);const i=s(t,["executableCode"]);i!=null&&a(e,["executableCode"],i);const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],Pu(r));const l=s(t,["functionCall"]);l!=null&&a(e,["functionCall"],Mu(l));const u=s(t,["functionResponse"]);u!=null&&a(e,["functionResponse"],u);const d=s(t,["inlineData"]);d!=null&&a(e,["inlineData"],ct(d));const c=s(t,["text"]);c!=null&&a(e,["text"],c);const f=s(t,["thought"]);f!=null&&a(e,["thought"],f);const m=s(t,["thoughtSignature"]);m!=null&&a(e,["thoughtSignature"],m);const h=s(t,["videoMetadata"]);return h!=null&&a(e,["videoMetadata"],h),e}function Wu(t){const e={},n=s(t,["handle"]);if(n!=null&&a(e,["handle"],n),s(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Yu(t){const e={};if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=s(t,["computerUse"]);n!=null&&a(e,["computerUse"],n);const o=s(t,["fileSearch"]);o!=null&&a(e,["fileSearch"],o);const i=s(t,["codeExecution"]);if(i!=null&&a(e,["codeExecution"],i),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const r=s(t,["functionDeclarations"]);if(r!=null){let f=r;Array.isArray(f)&&(f=f.map(m=>m)),a(e,["functionDeclarations"],f)}const l=s(t,["googleMaps"]);l!=null&&a(e,["googleMaps"],Uu(l));const u=s(t,["googleSearch"]);u!=null&&a(e,["googleSearch"],Lu(u));const d=s(t,["googleSearchRetrieval"]);d!=null&&a(e,["googleSearchRetrieval"],d);const c=s(t,["urlContext"]);return c!=null&&a(e,["urlContext"],c),e}function zu(t){const e={},n=s(t,["retrieval"]);n!=null&&a(e,["retrieval"],n);const o=s(t,["computerUse"]);if(o!=null&&a(e,["computerUse"],o),s(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const i=s(t,["codeExecution"]);i!=null&&a(e,["codeExecution"],i);const r=s(t,["enterpriseWebSearch"]);r!=null&&a(e,["enterpriseWebSearch"],r);const l=s(t,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(h=>ku(h))),a(e,["functionDeclarations"],m)}const u=s(t,["googleMaps"]);u!=null&&a(e,["googleMaps"],u);const d=s(t,["googleSearch"]);d!=null&&a(e,["googleSearch"],d);const c=s(t,["googleSearchRetrieval"]);c!=null&&a(e,["googleSearchRetrieval"],c);const f=s(t,["urlContext"]);return f!=null&&a(e,["urlContext"],f),e}function Xu(t){const e={},n=s(t,["promptTokenCount"]);n!=null&&a(e,["promptTokenCount"],n);const o=s(t,["cachedContentTokenCount"]);o!=null&&a(e,["cachedContentTokenCount"],o);const i=s(t,["candidatesTokenCount"]);i!=null&&a(e,["responseTokenCount"],i);const r=s(t,["toolUsePromptTokenCount"]);r!=null&&a(e,["toolUsePromptTokenCount"],r);const l=s(t,["thoughtsTokenCount"]);l!=null&&a(e,["thoughtsTokenCount"],l);const u=s(t,["totalTokenCount"]);u!=null&&a(e,["totalTokenCount"],u);const d=s(t,["promptTokensDetails"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(y=>y)),a(e,["promptTokensDetails"],g)}const c=s(t,["cacheTokensDetails"]);if(c!=null){let g=c;Array.isArray(g)&&(g=g.map(y=>y)),a(e,["cacheTokensDetails"],g)}const f=s(t,["candidatesTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(y=>y)),a(e,["responseTokensDetails"],g)}const m=s(t,["toolUsePromptTokensDetails"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(y=>y)),a(e,["toolUsePromptTokensDetails"],g)}const h=s(t,["trafficType"]);return h!=null&&a(e,["trafficType"],h),e}function Qu(t){const e={},n=s(t,["type"]);return n!=null&&a(e,["voiceActivityType"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Zu(t,e){const n={},o=s(t,["data"]);if(o!=null&&a(n,["data"],o),s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=s(t,["mimeType"]);return i!=null&&a(n,["mimeType"],i),n}function ju(t,e){const n={},o=s(t,["content"]);o!=null&&a(n,["content"],o);const i=s(t,["citationMetadata"]);i!=null&&a(n,["citationMetadata"],ec(i));const r=s(t,["tokenCount"]);r!=null&&a(n,["tokenCount"],r);const l=s(t,["finishReason"]);l!=null&&a(n,["finishReason"],l);const u=s(t,["avgLogprobs"]);u!=null&&a(n,["avgLogprobs"],u);const d=s(t,["groundingMetadata"]);d!=null&&a(n,["groundingMetadata"],d);const c=s(t,["index"]);c!=null&&a(n,["index"],c);const f=s(t,["logprobsResult"]);f!=null&&a(n,["logprobsResult"],f);const m=s(t,["safetyRatings"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(y=>y)),a(n,["safetyRatings"],g)}const h=s(t,["urlContextMetadata"]);return h!=null&&a(n,["urlContextMetadata"],h),n}function ec(t,e){const n={},o=s(t,["citationSources"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(r=>r)),a(n,["citations"],i)}return n}function tc(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["contents"]);if(r!=null){let l=se(r);Array.isArray(l)&&(l=l.map(u=>u)),a(o,["contents"],l)}return o}function nc(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["tokensInfo"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>l)),a(n,["tokensInfo"],r)}return n}function oc(t,e){const n={},o=s(t,["values"]);o!=null&&a(n,["values"],o);const i=s(t,["statistics"]);return i!=null&&a(n,["statistics"],ic(i)),n}function ic(t,e){const n={},o=s(t,["truncated"]);o!=null&&a(n,["truncated"],o);const i=s(t,["token_count"]);return i!=null&&a(n,["tokenCount"],i),n}function Qe(t,e){const n={},o=s(t,["parts"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>pd(l))),a(n,["parts"],r)}const i=s(t,["role"]);return i!=null&&a(n,["role"],i),n}function sc(t,e){const n={},o=s(t,["controlType"]);o!=null&&a(n,["controlType"],o);const i=s(t,["enableControlImageComputation"]);return i!=null&&a(n,["computeControl"],i),n}function rc(t,e){const n={};if(s(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(s(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(s(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return n}function ac(t,e,n){const o={},i=s(t,["systemInstruction"]);e!==void 0&&i!=null&&a(e,["systemInstruction"],X(i));const r=s(t,["tools"]);if(e!==void 0&&r!=null){let u=r;Array.isArray(u)&&(u=u.map(d=>cs(d))),a(e,["tools"],u)}const l=s(t,["generationConfig"]);return e!==void 0&&l!=null&&a(e,["generationConfig"],Zc(l)),o}function lc(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["contents"]);if(r!=null){let u=se(r);Array.isArray(u)&&(u=u.map(d=>Qe(d))),a(o,["contents"],u)}const l=s(e,["config"]);return l!=null&&rc(l),o}function uc(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["contents"]);if(r!=null){let u=se(r);Array.isArray(u)&&(u=u.map(d=>d)),a(o,["contents"],u)}const l=s(e,["config"]);return l!=null&&ac(l,o),o}function cc(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["totalTokens"]);i!=null&&a(n,["totalTokens"],i);const r=s(t,["cachedContentTokenCount"]);return r!=null&&a(n,["cachedContentTokenCount"],r),n}function dc(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["totalTokens"]);return i!=null&&a(n,["totalTokens"],i),n}function fc(t,e,n){const o={},i=s(e,["model"]);return i!=null&&a(o,["_url","name"],V(t,i)),o}function pc(t,e,n){const o={},i=s(e,["model"]);return i!=null&&a(o,["_url","name"],V(t,i)),o}function mc(t,e){const n={},o=s(t,["sdkHttpResponse"]);return o!=null&&a(n,["sdkHttpResponse"],o),n}function hc(t,e){const n={},o=s(t,["sdkHttpResponse"]);return o!=null&&a(n,["sdkHttpResponse"],o),n}function gc(t,e,n){const o={},i=s(t,["outputGcsUri"]);e!==void 0&&i!=null&&a(e,["parameters","storageUri"],i);const r=s(t,["negativePrompt"]);e!==void 0&&r!=null&&a(e,["parameters","negativePrompt"],r);const l=s(t,["numberOfImages"]);e!==void 0&&l!=null&&a(e,["parameters","sampleCount"],l);const u=s(t,["aspectRatio"]);e!==void 0&&u!=null&&a(e,["parameters","aspectRatio"],u);const d=s(t,["guidanceScale"]);e!==void 0&&d!=null&&a(e,["parameters","guidanceScale"],d);const c=s(t,["seed"]);e!==void 0&&c!=null&&a(e,["parameters","seed"],c);const f=s(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&a(e,["parameters","safetySetting"],f);const m=s(t,["personGeneration"]);e!==void 0&&m!=null&&a(e,["parameters","personGeneration"],m);const h=s(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&a(e,["parameters","includeSafetyAttributes"],h);const g=s(t,["includeRaiReason"]);e!==void 0&&g!=null&&a(e,["parameters","includeRaiReason"],g);const y=s(t,["language"]);e!==void 0&&y!=null&&a(e,["parameters","language"],y);const x=s(t,["outputMimeType"]);e!==void 0&&x!=null&&a(e,["parameters","outputOptions","mimeType"],x);const T=s(t,["outputCompressionQuality"]);e!==void 0&&T!=null&&a(e,["parameters","outputOptions","compressionQuality"],T);const C=s(t,["addWatermark"]);e!==void 0&&C!=null&&a(e,["parameters","addWatermark"],C);const A=s(t,["labels"]);e!==void 0&&A!=null&&a(e,["labels"],A);const S=s(t,["editMode"]);e!==void 0&&S!=null&&a(e,["parameters","editMode"],S);const E=s(t,["baseSteps"]);return e!==void 0&&E!=null&&a(e,["parameters","editConfig","baseSteps"],E),o}function yc(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["prompt"]);r!=null&&a(o,["instances[0]","prompt"],r);const l=s(e,["referenceImages"]);if(l!=null){let d=l;Array.isArray(d)&&(d=d.map(c=>Td(c))),a(o,["instances[0]","referenceImages"],d)}const u=s(e,["config"]);return u!=null&&gc(u,o),o}function vc(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["predictions"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>Tt(l))),a(n,["generatedImages"],r)}return n}function Tc(t,e,n){const o={},i=s(t,["taskType"]);e!==void 0&&i!=null&&a(e,["requests[]","taskType"],i);const r=s(t,["title"]);e!==void 0&&r!=null&&a(e,["requests[]","title"],r);const l=s(t,["outputDimensionality"]);if(e!==void 0&&l!=null&&a(e,["requests[]","outputDimensionality"],l),s(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(s(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return o}function xc(t,e,n){const o={};let i=s(n,["embeddingApiType"]);if(i===void 0&&(i="PREDICT"),i==="PREDICT"){const c=s(t,["taskType"]);e!==void 0&&c!=null&&a(e,["instances[]","task_type"],c)}else if(i==="EMBED_CONTENT"){const c=s(t,["taskType"]);e!==void 0&&c!=null&&a(e,["taskType"],c)}let r=s(n,["embeddingApiType"]);if(r===void 0&&(r="PREDICT"),r==="PREDICT"){const c=s(t,["title"]);e!==void 0&&c!=null&&a(e,["instances[]","title"],c)}else if(r==="EMBED_CONTENT"){const c=s(t,["title"]);e!==void 0&&c!=null&&a(e,["title"],c)}let l=s(n,["embeddingApiType"]);if(l===void 0&&(l="PREDICT"),l==="PREDICT"){const c=s(t,["outputDimensionality"]);e!==void 0&&c!=null&&a(e,["parameters","outputDimensionality"],c)}else if(l==="EMBED_CONTENT"){const c=s(t,["outputDimensionality"]);e!==void 0&&c!=null&&a(e,["outputDimensionality"],c)}let u=s(n,["embeddingApiType"]);if(u===void 0&&(u="PREDICT"),u==="PREDICT"){const c=s(t,["mimeType"]);e!==void 0&&c!=null&&a(e,["instances[]","mimeType"],c)}let d=s(n,["embeddingApiType"]);if(d===void 0&&(d="PREDICT"),d==="PREDICT"){const c=s(t,["autoTruncate"]);e!==void 0&&c!=null&&a(e,["parameters","autoTruncate"],c)}else if(d==="EMBED_CONTENT"){const c=s(t,["autoTruncate"]);e!==void 0&&c!=null&&a(e,["autoTruncate"],c)}return o}function _c(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["contents"]);if(r!=null){let c=an(t,r);Array.isArray(c)&&(c=c.map(f=>f)),a(o,["requests[]","content"],c)}const l=s(e,["content"]);l!=null&&Qe(X(l));const u=s(e,["config"]);u!=null&&Tc(u,o);const d=s(e,["model"]);return d!==void 0&&a(o,["requests[]","model"],V(t,d)),o}function Ec(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));let r=s(n,["embeddingApiType"]);if(r===void 0&&(r="PREDICT"),r==="PREDICT"){const d=s(e,["contents"]);if(d!=null){let c=an(t,d);Array.isArray(c)&&(c=c.map(f=>f)),a(o,["instances[]","content"],c)}}let l=s(n,["embeddingApiType"]);if(l===void 0&&(l="PREDICT"),l==="EMBED_CONTENT"){const d=s(e,["content"]);d!=null&&a(o,["content"],X(d))}const u=s(e,["config"]);return u!=null&&xc(u,o,n),o}function Cc(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["embeddings"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(u=>u)),a(n,["embeddings"],l)}const r=s(t,["metadata"]);return r!=null&&a(n,["metadata"],r),n}function Sc(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["predictions[]","embeddings"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(u=>oc(u))),a(n,["embeddings"],l)}const r=s(t,["metadata"]);if(r!=null&&a(n,["metadata"],r),e&&s(e,["embeddingApiType"])==="EMBED_CONTENT"){const l=s(t,["embedding"]),u=s(t,["usageMetadata"]),d=s(t,["truncated"]);if(l){const c={};u&&u.promptTokenCount&&(c.tokenCount=u.promptTokenCount),d&&(c.truncated=d),l.statistics=c,a(n,["embeddings"],[l])}}return n}function Ic(t,e){const n={},o=s(t,["endpoint"]);o!=null&&a(n,["name"],o);const i=s(t,["deployedModelId"]);return i!=null&&a(n,["deployedModelId"],i),n}function wc(t,e){const n={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=s(t,["fileUri"]);o!=null&&a(n,["fileUri"],o);const i=s(t,["mimeType"]);return i!=null&&a(n,["mimeType"],i),n}function Ac(t,e){const n={},o=s(t,["id"]);o!=null&&a(n,["id"],o);const i=s(t,["args"]);i!=null&&a(n,["args"],i);const r=s(t,["name"]);if(r!=null&&a(n,["name"],r),s(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(s(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return n}function Nc(t,e){const n={},o=s(t,["allowedFunctionNames"]);o!=null&&a(n,["allowedFunctionNames"],o);const i=s(t,["mode"]);if(i!=null&&a(n,["mode"],i),s(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return n}function bc(t,e){const n={},o=s(t,["description"]);o!=null&&a(n,["description"],o);const i=s(t,["name"]);i!=null&&a(n,["name"],i);const r=s(t,["parameters"]);r!=null&&a(n,["parameters"],r);const l=s(t,["parametersJsonSchema"]);l!=null&&a(n,["parametersJsonSchema"],l);const u=s(t,["response"]);u!=null&&a(n,["response"],u);const d=s(t,["responseJsonSchema"]);if(d!=null&&a(n,["responseJsonSchema"],d),s(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return n}function Rc(t,e,n,o){const i={},r=s(e,["systemInstruction"]);n!==void 0&&r!=null&&a(n,["systemInstruction"],Qe(X(r)));const l=s(e,["temperature"]);l!=null&&a(i,["temperature"],l);const u=s(e,["topP"]);u!=null&&a(i,["topP"],u);const d=s(e,["topK"]);d!=null&&a(i,["topK"],d);const c=s(e,["candidateCount"]);c!=null&&a(i,["candidateCount"],c);const f=s(e,["maxOutputTokens"]);f!=null&&a(i,["maxOutputTokens"],f);const m=s(e,["stopSequences"]);m!=null&&a(i,["stopSequences"],m);const h=s(e,["responseLogprobs"]);h!=null&&a(i,["responseLogprobs"],h);const g=s(e,["logprobs"]);g!=null&&a(i,["logprobs"],g);const y=s(e,["presencePenalty"]);y!=null&&a(i,["presencePenalty"],y);const x=s(e,["frequencyPenalty"]);x!=null&&a(i,["frequencyPenalty"],x);const T=s(e,["seed"]);T!=null&&a(i,["seed"],T);const C=s(e,["responseMimeType"]);C!=null&&a(i,["responseMimeType"],C);const A=s(e,["responseSchema"]);A!=null&&a(i,["responseSchema"],ln(A));const S=s(e,["responseJsonSchema"]);if(S!=null&&a(i,["responseJsonSchema"],S),s(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(s(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const E=s(e,["safetySettings"]);if(n!==void 0&&E!=null){let $=E;Array.isArray($)&&($=$.map(Y=>xd(Y))),a(n,["safetySettings"],$)}const N=s(e,["tools"]);if(n!==void 0&&N!=null){let $=Ge(N);Array.isArray($)&&($=$.map(Y=>Ad(Fe(Y)))),a(n,["tools"],$)}const _=s(e,["toolConfig"]);if(n!==void 0&&_!=null&&a(n,["toolConfig"],wd(_)),s(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const I=s(e,["cachedContent"]);n!==void 0&&I!=null&&a(n,["cachedContent"],Ce(t,I));const M=s(e,["responseModalities"]);M!=null&&a(i,["responseModalities"],M);const P=s(e,["mediaResolution"]);P!=null&&a(i,["mediaResolution"],P);const D=s(e,["speechConfig"]);if(D!=null&&a(i,["speechConfig"],un(D)),s(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const F=s(e,["thinkingConfig"]);F!=null&&a(i,["thinkingConfig"],F);const H=s(e,["imageConfig"]);H!=null&&a(i,["imageConfig"],od(H));const K=s(e,["enableEnhancedCivicAnswers"]);if(K!=null&&a(i,["enableEnhancedCivicAnswers"],K),s(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return i}function Pc(t,e,n,o){const i={},r=s(e,["systemInstruction"]);n!==void 0&&r!=null&&a(n,["systemInstruction"],X(r));const l=s(e,["temperature"]);l!=null&&a(i,["temperature"],l);const u=s(e,["topP"]);u!=null&&a(i,["topP"],u);const d=s(e,["topK"]);d!=null&&a(i,["topK"],d);const c=s(e,["candidateCount"]);c!=null&&a(i,["candidateCount"],c);const f=s(e,["maxOutputTokens"]);f!=null&&a(i,["maxOutputTokens"],f);const m=s(e,["stopSequences"]);m!=null&&a(i,["stopSequences"],m);const h=s(e,["responseLogprobs"]);h!=null&&a(i,["responseLogprobs"],h);const g=s(e,["logprobs"]);g!=null&&a(i,["logprobs"],g);const y=s(e,["presencePenalty"]);y!=null&&a(i,["presencePenalty"],y);const x=s(e,["frequencyPenalty"]);x!=null&&a(i,["frequencyPenalty"],x);const T=s(e,["seed"]);T!=null&&a(i,["seed"],T);const C=s(e,["responseMimeType"]);C!=null&&a(i,["responseMimeType"],C);const A=s(e,["responseSchema"]);A!=null&&a(i,["responseSchema"],ln(A));const S=s(e,["responseJsonSchema"]);S!=null&&a(i,["responseJsonSchema"],S);const E=s(e,["routingConfig"]);E!=null&&a(i,["routingConfig"],E);const N=s(e,["modelSelectionConfig"]);N!=null&&a(i,["modelConfig"],N);const _=s(e,["safetySettings"]);if(n!==void 0&&_!=null){let W=_;Array.isArray(W)&&(W=W.map(de=>de)),a(n,["safetySettings"],W)}const I=s(e,["tools"]);if(n!==void 0&&I!=null){let W=Ge(I);Array.isArray(W)&&(W=W.map(de=>cs(Fe(de)))),a(n,["tools"],W)}const M=s(e,["toolConfig"]);n!==void 0&&M!=null&&a(n,["toolConfig"],M);const P=s(e,["labels"]);n!==void 0&&P!=null&&a(n,["labels"],P);const D=s(e,["cachedContent"]);n!==void 0&&D!=null&&a(n,["cachedContent"],Ce(t,D));const F=s(e,["responseModalities"]);F!=null&&a(i,["responseModalities"],F);const H=s(e,["mediaResolution"]);H!=null&&a(i,["mediaResolution"],H);const K=s(e,["speechConfig"]);K!=null&&a(i,["speechConfig"],un(K));const $=s(e,["audioTimestamp"]);$!=null&&a(i,["audioTimestamp"],$);const Y=s(e,["thinkingConfig"]);Y!=null&&a(i,["thinkingConfig"],Y);const ve=s(e,["imageConfig"]);if(ve!=null&&a(i,["imageConfig"],id(ve)),s(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");const ce=s(e,["modelArmorConfig"]);return n!==void 0&&ce!=null&&a(n,["modelArmorConfig"],ce),i}function hi(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["contents"]);if(r!=null){let u=se(r);Array.isArray(u)&&(u=u.map(d=>Qe(d))),a(o,["contents"],u)}const l=s(e,["config"]);return l!=null&&a(o,["generationConfig"],Rc(t,l,o)),o}function gi(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["contents"]);if(r!=null){let u=se(r);Array.isArray(u)&&(u=u.map(d=>d)),a(o,["contents"],u)}const l=s(e,["config"]);return l!=null&&a(o,["generationConfig"],Pc(t,l,o)),o}function yi(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["candidates"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(f=>ju(f))),a(n,["candidates"],c)}const r=s(t,["modelVersion"]);r!=null&&a(n,["modelVersion"],r);const l=s(t,["promptFeedback"]);l!=null&&a(n,["promptFeedback"],l);const u=s(t,["responseId"]);u!=null&&a(n,["responseId"],u);const d=s(t,["usageMetadata"]);return d!=null&&a(n,["usageMetadata"],d),n}function vi(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["candidates"]);if(i!=null){let f=i;Array.isArray(f)&&(f=f.map(m=>m)),a(n,["candidates"],f)}const r=s(t,["createTime"]);r!=null&&a(n,["createTime"],r);const l=s(t,["modelVersion"]);l!=null&&a(n,["modelVersion"],l);const u=s(t,["promptFeedback"]);u!=null&&a(n,["promptFeedback"],u);const d=s(t,["responseId"]);d!=null&&a(n,["responseId"],d);const c=s(t,["usageMetadata"]);return c!=null&&a(n,["usageMetadata"],c),n}function Mc(t,e,n){const o={};if(s(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(s(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=s(t,["numberOfImages"]);e!==void 0&&i!=null&&a(e,["parameters","sampleCount"],i);const r=s(t,["aspectRatio"]);e!==void 0&&r!=null&&a(e,["parameters","aspectRatio"],r);const l=s(t,["guidanceScale"]);if(e!==void 0&&l!=null&&a(e,["parameters","guidanceScale"],l),s(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=s(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&a(e,["parameters","safetySetting"],u);const d=s(t,["personGeneration"]);e!==void 0&&d!=null&&a(e,["parameters","personGeneration"],d);const c=s(t,["includeSafetyAttributes"]);e!==void 0&&c!=null&&a(e,["parameters","includeSafetyAttributes"],c);const f=s(t,["includeRaiReason"]);e!==void 0&&f!=null&&a(e,["parameters","includeRaiReason"],f);const m=s(t,["language"]);e!==void 0&&m!=null&&a(e,["parameters","language"],m);const h=s(t,["outputMimeType"]);e!==void 0&&h!=null&&a(e,["parameters","outputOptions","mimeType"],h);const g=s(t,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&a(e,["parameters","outputOptions","compressionQuality"],g),s(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(s(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const y=s(t,["imageSize"]);if(e!==void 0&&y!=null&&a(e,["parameters","sampleImageSize"],y),s(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return o}function kc(t,e,n){const o={},i=s(t,["outputGcsUri"]);e!==void 0&&i!=null&&a(e,["parameters","storageUri"],i);const r=s(t,["negativePrompt"]);e!==void 0&&r!=null&&a(e,["parameters","negativePrompt"],r);const l=s(t,["numberOfImages"]);e!==void 0&&l!=null&&a(e,["parameters","sampleCount"],l);const u=s(t,["aspectRatio"]);e!==void 0&&u!=null&&a(e,["parameters","aspectRatio"],u);const d=s(t,["guidanceScale"]);e!==void 0&&d!=null&&a(e,["parameters","guidanceScale"],d);const c=s(t,["seed"]);e!==void 0&&c!=null&&a(e,["parameters","seed"],c);const f=s(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&a(e,["parameters","safetySetting"],f);const m=s(t,["personGeneration"]);e!==void 0&&m!=null&&a(e,["parameters","personGeneration"],m);const h=s(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&a(e,["parameters","includeSafetyAttributes"],h);const g=s(t,["includeRaiReason"]);e!==void 0&&g!=null&&a(e,["parameters","includeRaiReason"],g);const y=s(t,["language"]);e!==void 0&&y!=null&&a(e,["parameters","language"],y);const x=s(t,["outputMimeType"]);e!==void 0&&x!=null&&a(e,["parameters","outputOptions","mimeType"],x);const T=s(t,["outputCompressionQuality"]);e!==void 0&&T!=null&&a(e,["parameters","outputOptions","compressionQuality"],T);const C=s(t,["addWatermark"]);e!==void 0&&C!=null&&a(e,["parameters","addWatermark"],C);const A=s(t,["labels"]);e!==void 0&&A!=null&&a(e,["labels"],A);const S=s(t,["imageSize"]);e!==void 0&&S!=null&&a(e,["parameters","sampleImageSize"],S);const E=s(t,["enhancePrompt"]);return e!==void 0&&E!=null&&a(e,["parameters","enhancePrompt"],E),o}function Dc(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["prompt"]);r!=null&&a(o,["instances[0]","prompt"],r);const l=s(e,["config"]);return l!=null&&Mc(l,o),o}function Uc(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["prompt"]);r!=null&&a(o,["instances[0]","prompt"],r);const l=s(e,["config"]);return l!=null&&kc(l,o),o}function Lc(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["predictions"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(u=>Yc(u))),a(n,["generatedImages"],l)}const r=s(t,["positivePromptSafetyAttributes"]);return r!=null&&a(n,["positivePromptSafetyAttributes"],ls(r)),n}function Fc(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["predictions"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(u=>Tt(u))),a(n,["generatedImages"],l)}const r=s(t,["positivePromptSafetyAttributes"]);return r!=null&&a(n,["positivePromptSafetyAttributes"],us(r)),n}function Gc(t,e,n){const o={},i=s(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&a(e,["parameters","sampleCount"],i),s(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(s(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const r=s(t,["durationSeconds"]);if(e!==void 0&&r!=null&&a(e,["parameters","durationSeconds"],r),s(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=s(t,["aspectRatio"]);e!==void 0&&l!=null&&a(e,["parameters","aspectRatio"],l);const u=s(t,["resolution"]);e!==void 0&&u!=null&&a(e,["parameters","resolution"],u);const d=s(t,["personGeneration"]);if(e!==void 0&&d!=null&&a(e,["parameters","personGeneration"],d),s(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=s(t,["negativePrompt"]);e!==void 0&&c!=null&&a(e,["parameters","negativePrompt"],c);const f=s(t,["enhancePrompt"]);if(e!==void 0&&f!=null&&a(e,["parameters","enhancePrompt"],f),s(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const m=s(t,["lastFrame"]);e!==void 0&&m!=null&&a(e,["instances[0]","lastFrame"],xt(m));const h=s(t,["referenceImages"]);if(e!==void 0&&h!=null){let g=h;Array.isArray(g)&&(g=g.map(y=>Hd(y))),a(e,["instances[0]","referenceImages"],g)}if(s(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(s(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return o}function Vc(t,e,n){const o={},i=s(t,["numberOfVideos"]);e!==void 0&&i!=null&&a(e,["parameters","sampleCount"],i);const r=s(t,["outputGcsUri"]);e!==void 0&&r!=null&&a(e,["parameters","storageUri"],r);const l=s(t,["fps"]);e!==void 0&&l!=null&&a(e,["parameters","fps"],l);const u=s(t,["durationSeconds"]);e!==void 0&&u!=null&&a(e,["parameters","durationSeconds"],u);const d=s(t,["seed"]);e!==void 0&&d!=null&&a(e,["parameters","seed"],d);const c=s(t,["aspectRatio"]);e!==void 0&&c!=null&&a(e,["parameters","aspectRatio"],c);const f=s(t,["resolution"]);e!==void 0&&f!=null&&a(e,["parameters","resolution"],f);const m=s(t,["personGeneration"]);e!==void 0&&m!=null&&a(e,["parameters","personGeneration"],m);const h=s(t,["pubsubTopic"]);e!==void 0&&h!=null&&a(e,["parameters","pubsubTopic"],h);const g=s(t,["negativePrompt"]);e!==void 0&&g!=null&&a(e,["parameters","negativePrompt"],g);const y=s(t,["enhancePrompt"]);e!==void 0&&y!=null&&a(e,["parameters","enhancePrompt"],y);const x=s(t,["generateAudio"]);e!==void 0&&x!=null&&a(e,["parameters","generateAudio"],x);const T=s(t,["lastFrame"]);e!==void 0&&T!=null&&a(e,["instances[0]","lastFrame"],me(T));const C=s(t,["referenceImages"]);if(e!==void 0&&C!=null){let E=C;Array.isArray(E)&&(E=E.map(N=>qd(N))),a(e,["instances[0]","referenceImages"],E)}const A=s(t,["mask"]);e!==void 0&&A!=null&&a(e,["instances[0]","mask"],Vd(A));const S=s(t,["compressionQuality"]);return e!==void 0&&S!=null&&a(e,["parameters","compressionQuality"],S),o}function Hc(t,e){const n={},o=s(t,["name"]);o!=null&&a(n,["name"],o);const i=s(t,["metadata"]);i!=null&&a(n,["metadata"],i);const r=s(t,["done"]);r!=null&&a(n,["done"],r);const l=s(t,["error"]);l!=null&&a(n,["error"],l);const u=s(t,["response","generateVideoResponse"]);return u!=null&&a(n,["response"],$c(u)),n}function qc(t,e){const n={},o=s(t,["name"]);o!=null&&a(n,["name"],o);const i=s(t,["metadata"]);i!=null&&a(n,["metadata"],i);const r=s(t,["done"]);r!=null&&a(n,["done"],r);const l=s(t,["error"]);l!=null&&a(n,["error"],l);const u=s(t,["response"]);return u!=null&&a(n,["response"],Jc(u)),n}function Bc(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["prompt"]);r!=null&&a(o,["instances[0]","prompt"],r);const l=s(e,["image"]);l!=null&&a(o,["instances[0]","image"],xt(l));const u=s(e,["video"]);u!=null&&a(o,["instances[0]","video"],ds(u));const d=s(e,["source"]);d!=null&&Oc(d,o);const c=s(e,["config"]);return c!=null&&Gc(c,o),o}function Kc(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["prompt"]);r!=null&&a(o,["instances[0]","prompt"],r);const l=s(e,["image"]);l!=null&&a(o,["instances[0]","image"],me(l));const u=s(e,["video"]);u!=null&&a(o,["instances[0]","video"],fs(u));const d=s(e,["source"]);d!=null&&Wc(d,o);const c=s(e,["config"]);return c!=null&&Vc(c,o),o}function $c(t,e){const n={},o=s(t,["generatedSamples"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(u=>Xc(u))),a(n,["generatedVideos"],l)}const i=s(t,["raiMediaFilteredCount"]);i!=null&&a(n,["raiMediaFilteredCount"],i);const r=s(t,["raiMediaFilteredReasons"]);return r!=null&&a(n,["raiMediaFilteredReasons"],r),n}function Jc(t,e){const n={},o=s(t,["videos"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(u=>Qc(u))),a(n,["generatedVideos"],l)}const i=s(t,["raiMediaFilteredCount"]);i!=null&&a(n,["raiMediaFilteredCount"],i);const r=s(t,["raiMediaFilteredReasons"]);return r!=null&&a(n,["raiMediaFilteredReasons"],r),n}function Oc(t,e,n){const o={},i=s(t,["prompt"]);e!==void 0&&i!=null&&a(e,["instances[0]","prompt"],i);const r=s(t,["image"]);e!==void 0&&r!=null&&a(e,["instances[0]","image"],xt(r));const l=s(t,["video"]);return e!==void 0&&l!=null&&a(e,["instances[0]","video"],ds(l)),o}function Wc(t,e,n){const o={},i=s(t,["prompt"]);e!==void 0&&i!=null&&a(e,["instances[0]","prompt"],i);const r=s(t,["image"]);e!==void 0&&r!=null&&a(e,["instances[0]","image"],me(r));const l=s(t,["video"]);return e!==void 0&&l!=null&&a(e,["instances[0]","video"],fs(l)),o}function Yc(t,e){const n={},o=s(t,["_self"]);o!=null&&a(n,["image"],sd(o));const i=s(t,["raiFilteredReason"]);i!=null&&a(n,["raiFilteredReason"],i);const r=s(t,["_self"]);return r!=null&&a(n,["safetyAttributes"],ls(r)),n}function Tt(t,e){const n={},o=s(t,["_self"]);o!=null&&a(n,["image"],as(o));const i=s(t,["raiFilteredReason"]);i!=null&&a(n,["raiFilteredReason"],i);const r=s(t,["_self"]);r!=null&&a(n,["safetyAttributes"],us(r));const l=s(t,["prompt"]);return l!=null&&a(n,["enhancedPrompt"],l),n}function zc(t,e){const n={},o=s(t,["_self"]);o!=null&&a(n,["mask"],as(o));const i=s(t,["labels"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>l)),a(n,["labels"],r)}return n}function Xc(t,e){const n={},o=s(t,["video"]);return o!=null&&a(n,["video"],Fd(o)),n}function Qc(t,e){const n={},o=s(t,["_self"]);return o!=null&&a(n,["video"],Gd(o)),n}function Zc(t,e){const n={},o=s(t,["modelSelectionConfig"]);o!=null&&a(n,["modelConfig"],o);const i=s(t,["responseJsonSchema"]);i!=null&&a(n,["responseJsonSchema"],i);const r=s(t,["audioTimestamp"]);r!=null&&a(n,["audioTimestamp"],r);const l=s(t,["candidateCount"]);l!=null&&a(n,["candidateCount"],l);const u=s(t,["enableAffectiveDialog"]);u!=null&&a(n,["enableAffectiveDialog"],u);const d=s(t,["frequencyPenalty"]);d!=null&&a(n,["frequencyPenalty"],d);const c=s(t,["logprobs"]);c!=null&&a(n,["logprobs"],c);const f=s(t,["maxOutputTokens"]);f!=null&&a(n,["maxOutputTokens"],f);const m=s(t,["mediaResolution"]);m!=null&&a(n,["mediaResolution"],m);const h=s(t,["presencePenalty"]);h!=null&&a(n,["presencePenalty"],h);const g=s(t,["responseLogprobs"]);g!=null&&a(n,["responseLogprobs"],g);const y=s(t,["responseMimeType"]);y!=null&&a(n,["responseMimeType"],y);const x=s(t,["responseModalities"]);x!=null&&a(n,["responseModalities"],x);const T=s(t,["responseSchema"]);T!=null&&a(n,["responseSchema"],T);const C=s(t,["routingConfig"]);C!=null&&a(n,["routingConfig"],C);const A=s(t,["seed"]);A!=null&&a(n,["seed"],A);const S=s(t,["speechConfig"]);S!=null&&a(n,["speechConfig"],S);const E=s(t,["stopSequences"]);E!=null&&a(n,["stopSequences"],E);const N=s(t,["temperature"]);N!=null&&a(n,["temperature"],N);const _=s(t,["thinkingConfig"]);_!=null&&a(n,["thinkingConfig"],_);const I=s(t,["topK"]);I!=null&&a(n,["topK"],I);const M=s(t,["topP"]);if(M!=null&&a(n,["topP"],M),s(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function jc(t,e,n){const o={},i=s(e,["model"]);return i!=null&&a(o,["_url","name"],V(t,i)),o}function ed(t,e,n){const o={},i=s(e,["model"]);return i!=null&&a(o,["_url","name"],V(t,i)),o}function td(t,e){const n={};if(s(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=s(t,["enableWidget"]);return o!=null&&a(n,["enableWidget"],o),n}function nd(t,e){const n={};if(s(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(s(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=s(t,["timeRangeFilter"]);return o!=null&&a(n,["timeRangeFilter"],o),n}function od(t,e){const n={},o=s(t,["aspectRatio"]);o!=null&&a(n,["aspectRatio"],o);const i=s(t,["imageSize"]);if(i!=null&&a(n,["imageSize"],i),s(t,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(s(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(s(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return n}function id(t,e){const n={},o=s(t,["aspectRatio"]);o!=null&&a(n,["aspectRatio"],o);const i=s(t,["imageSize"]);i!=null&&a(n,["imageSize"],i);const r=s(t,["personGeneration"]);r!=null&&a(n,["personGeneration"],r);const l=s(t,["outputMimeType"]);l!=null&&a(n,["imageOutputOptions","mimeType"],l);const u=s(t,["outputCompressionQuality"]);return u!=null&&a(n,["imageOutputOptions","compressionQuality"],u),n}function sd(t,e){const n={},o=s(t,["bytesBase64Encoded"]);o!=null&&a(n,["imageBytes"],Ie(o));const i=s(t,["mimeType"]);return i!=null&&a(n,["mimeType"],i),n}function as(t,e){const n={},o=s(t,["gcsUri"]);o!=null&&a(n,["gcsUri"],o);const i=s(t,["bytesBase64Encoded"]);i!=null&&a(n,["imageBytes"],Ie(i));const r=s(t,["mimeType"]);return r!=null&&a(n,["mimeType"],r),n}function xt(t,e){const n={};if(s(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const o=s(t,["imageBytes"]);o!=null&&a(n,["bytesBase64Encoded"],Ie(o));const i=s(t,["mimeType"]);return i!=null&&a(n,["mimeType"],i),n}function me(t,e){const n={},o=s(t,["gcsUri"]);o!=null&&a(n,["gcsUri"],o);const i=s(t,["imageBytes"]);i!=null&&a(n,["bytesBase64Encoded"],Ie(i));const r=s(t,["mimeType"]);return r!=null&&a(n,["mimeType"],r),n}function rd(t,e,n,o){const i={},r=s(e,["pageSize"]);n!==void 0&&r!=null&&a(n,["_query","pageSize"],r);const l=s(e,["pageToken"]);n!==void 0&&l!=null&&a(n,["_query","pageToken"],l);const u=s(e,["filter"]);n!==void 0&&u!=null&&a(n,["_query","filter"],u);const d=s(e,["queryBase"]);return n!==void 0&&d!=null&&a(n,["_url","models_url"],es(t,d)),i}function ad(t,e,n,o){const i={},r=s(e,["pageSize"]);n!==void 0&&r!=null&&a(n,["_query","pageSize"],r);const l=s(e,["pageToken"]);n!==void 0&&l!=null&&a(n,["_query","pageToken"],l);const u=s(e,["filter"]);n!==void 0&&u!=null&&a(n,["_query","filter"],u);const d=s(e,["queryBase"]);return n!==void 0&&d!=null&&a(n,["_url","models_url"],es(t,d)),i}function ld(t,e,n){const o={},i=s(e,["config"]);return i!=null&&rd(t,i,o),o}function ud(t,e,n){const o={},i=s(e,["config"]);return i!=null&&ad(t,i,o),o}function cd(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["nextPageToken"]);i!=null&&a(n,["nextPageToken"],i);const r=s(t,["_self"]);if(r!=null){let l=ts(r);Array.isArray(l)&&(l=l.map(u=>Ot(u))),a(n,["models"],l)}return n}function dd(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["nextPageToken"]);i!=null&&a(n,["nextPageToken"],i);const r=s(t,["_self"]);if(r!=null){let l=ts(r);Array.isArray(l)&&(l=l.map(u=>Wt(u))),a(n,["models"],l)}return n}function fd(t,e){const n={},o=s(t,["maskMode"]);o!=null&&a(n,["maskMode"],o);const i=s(t,["segmentationClasses"]);i!=null&&a(n,["maskClasses"],i);const r=s(t,["maskDilation"]);return r!=null&&a(n,["dilation"],r),n}function Ot(t,e){const n={},o=s(t,["name"]);o!=null&&a(n,["name"],o);const i=s(t,["displayName"]);i!=null&&a(n,["displayName"],i);const r=s(t,["description"]);r!=null&&a(n,["description"],r);const l=s(t,["version"]);l!=null&&a(n,["version"],l);const u=s(t,["_self"]);u!=null&&a(n,["tunedModelInfo"],Nd(u));const d=s(t,["inputTokenLimit"]);d!=null&&a(n,["inputTokenLimit"],d);const c=s(t,["outputTokenLimit"]);c!=null&&a(n,["outputTokenLimit"],c);const f=s(t,["supportedGenerationMethods"]);f!=null&&a(n,["supportedActions"],f);const m=s(t,["temperature"]);m!=null&&a(n,["temperature"],m);const h=s(t,["maxTemperature"]);h!=null&&a(n,["maxTemperature"],h);const g=s(t,["topP"]);g!=null&&a(n,["topP"],g);const y=s(t,["topK"]);y!=null&&a(n,["topK"],y);const x=s(t,["thinking"]);return x!=null&&a(n,["thinking"],x),n}function Wt(t,e){const n={},o=s(t,["name"]);o!=null&&a(n,["name"],o);const i=s(t,["displayName"]);i!=null&&a(n,["displayName"],i);const r=s(t,["description"]);r!=null&&a(n,["description"],r);const l=s(t,["versionId"]);l!=null&&a(n,["version"],l);const u=s(t,["deployedModels"]);if(u!=null){let h=u;Array.isArray(h)&&(h=h.map(g=>Ic(g))),a(n,["endpoints"],h)}const d=s(t,["labels"]);d!=null&&a(n,["labels"],d);const c=s(t,["_self"]);c!=null&&a(n,["tunedModelInfo"],bd(c));const f=s(t,["defaultCheckpointId"]);f!=null&&a(n,["defaultCheckpointId"],f);const m=s(t,["checkpoints"]);if(m!=null){let h=m;Array.isArray(h)&&(h=h.map(g=>g)),a(n,["checkpoints"],h)}return n}function pd(t,e){const n={},o=s(t,["mediaResolution"]);o!=null&&a(n,["mediaResolution"],o);const i=s(t,["codeExecutionResult"]);i!=null&&a(n,["codeExecutionResult"],i);const r=s(t,["executableCode"]);r!=null&&a(n,["executableCode"],r);const l=s(t,["fileData"]);l!=null&&a(n,["fileData"],wc(l));const u=s(t,["functionCall"]);u!=null&&a(n,["functionCall"],Ac(u));const d=s(t,["functionResponse"]);d!=null&&a(n,["functionResponse"],d);const c=s(t,["inlineData"]);c!=null&&a(n,["inlineData"],Zu(c));const f=s(t,["text"]);f!=null&&a(n,["text"],f);const m=s(t,["thought"]);m!=null&&a(n,["thought"],m);const h=s(t,["thoughtSignature"]);h!=null&&a(n,["thoughtSignature"],h);const g=s(t,["videoMetadata"]);return g!=null&&a(n,["videoMetadata"],g),n}function md(t,e){const n={},o=s(t,["productImage"]);return o!=null&&a(n,["image"],me(o)),n}function hd(t,e,n){const o={},i=s(t,["numberOfImages"]);e!==void 0&&i!=null&&a(e,["parameters","sampleCount"],i);const r=s(t,["baseSteps"]);e!==void 0&&r!=null&&a(e,["parameters","baseSteps"],r);const l=s(t,["outputGcsUri"]);e!==void 0&&l!=null&&a(e,["parameters","storageUri"],l);const u=s(t,["seed"]);e!==void 0&&u!=null&&a(e,["parameters","seed"],u);const d=s(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&a(e,["parameters","safetySetting"],d);const c=s(t,["personGeneration"]);e!==void 0&&c!=null&&a(e,["parameters","personGeneration"],c);const f=s(t,["addWatermark"]);e!==void 0&&f!=null&&a(e,["parameters","addWatermark"],f);const m=s(t,["outputMimeType"]);e!==void 0&&m!=null&&a(e,["parameters","outputOptions","mimeType"],m);const h=s(t,["outputCompressionQuality"]);e!==void 0&&h!=null&&a(e,["parameters","outputOptions","compressionQuality"],h);const g=s(t,["enhancePrompt"]);e!==void 0&&g!=null&&a(e,["parameters","enhancePrompt"],g);const y=s(t,["labels"]);return e!==void 0&&y!=null&&a(e,["labels"],y),o}function gd(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["source"]);r!=null&&vd(r,o);const l=s(e,["config"]);return l!=null&&hd(l,o),o}function yd(t,e){const n={},o=s(t,["predictions"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(r=>Tt(r))),a(n,["generatedImages"],i)}return n}function vd(t,e,n){const o={},i=s(t,["prompt"]);e!==void 0&&i!=null&&a(e,["instances[0]","prompt"],i);const r=s(t,["personImage"]);e!==void 0&&r!=null&&a(e,["instances[0]","personImage","image"],me(r));const l=s(t,["productImages"]);if(e!==void 0&&l!=null){let u=l;Array.isArray(u)&&(u=u.map(d=>md(d))),a(e,["instances[0]","productImages"],u)}return o}function Td(t,e){const n={},o=s(t,["referenceImage"]);o!=null&&a(n,["referenceImage"],me(o));const i=s(t,["referenceId"]);i!=null&&a(n,["referenceId"],i);const r=s(t,["referenceType"]);r!=null&&a(n,["referenceType"],r);const l=s(t,["maskImageConfig"]);l!=null&&a(n,["maskImageConfig"],fd(l));const u=s(t,["controlImageConfig"]);u!=null&&a(n,["controlImageConfig"],sc(u));const d=s(t,["styleImageConfig"]);d!=null&&a(n,["styleImageConfig"],d);const c=s(t,["subjectImageConfig"]);return c!=null&&a(n,["subjectImageConfig"],c),n}function ls(t,e){const n={},o=s(t,["safetyAttributes","categories"]);o!=null&&a(n,["categories"],o);const i=s(t,["safetyAttributes","scores"]);i!=null&&a(n,["scores"],i);const r=s(t,["contentType"]);return r!=null&&a(n,["contentType"],r),n}function us(t,e){const n={},o=s(t,["safetyAttributes","categories"]);o!=null&&a(n,["categories"],o);const i=s(t,["safetyAttributes","scores"]);i!=null&&a(n,["scores"],i);const r=s(t,["contentType"]);return r!=null&&a(n,["contentType"],r),n}function xd(t,e){const n={},o=s(t,["category"]);if(o!=null&&a(n,["category"],o),s(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=s(t,["threshold"]);return i!=null&&a(n,["threshold"],i),n}function _d(t,e){const n={},o=s(t,["image"]);return o!=null&&a(n,["image"],me(o)),n}function Ed(t,e,n){const o={},i=s(t,["mode"]);e!==void 0&&i!=null&&a(e,["parameters","mode"],i);const r=s(t,["maxPredictions"]);e!==void 0&&r!=null&&a(e,["parameters","maxPredictions"],r);const l=s(t,["confidenceThreshold"]);e!==void 0&&l!=null&&a(e,["parameters","confidenceThreshold"],l);const u=s(t,["maskDilation"]);e!==void 0&&u!=null&&a(e,["parameters","maskDilation"],u);const d=s(t,["binaryColorThreshold"]);e!==void 0&&d!=null&&a(e,["parameters","binaryColorThreshold"],d);const c=s(t,["labels"]);return e!==void 0&&c!=null&&a(e,["labels"],c),o}function Cd(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["source"]);r!=null&&Id(r,o);const l=s(e,["config"]);return l!=null&&Ed(l,o),o}function Sd(t,e){const n={},o=s(t,["predictions"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(r=>zc(r))),a(n,["generatedMasks"],i)}return n}function Id(t,e,n){const o={},i=s(t,["prompt"]);e!==void 0&&i!=null&&a(e,["instances[0]","prompt"],i);const r=s(t,["image"]);e!==void 0&&r!=null&&a(e,["instances[0]","image"],me(r));const l=s(t,["scribbleImage"]);return e!==void 0&&l!=null&&a(e,["instances[0]","scribble"],_d(l)),o}function wd(t,e){const n={},o=s(t,["retrievalConfig"]);o!=null&&a(n,["retrievalConfig"],o);const i=s(t,["functionCallingConfig"]);return i!=null&&a(n,["functionCallingConfig"],Nc(i)),n}function Ad(t,e){const n={};if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=s(t,["computerUse"]);o!=null&&a(n,["computerUse"],o);const i=s(t,["fileSearch"]);i!=null&&a(n,["fileSearch"],i);const r=s(t,["codeExecution"]);if(r!=null&&a(n,["codeExecution"],r),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=s(t,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(h=>h)),a(n,["functionDeclarations"],m)}const u=s(t,["googleMaps"]);u!=null&&a(n,["googleMaps"],td(u));const d=s(t,["googleSearch"]);d!=null&&a(n,["googleSearch"],nd(d));const c=s(t,["googleSearchRetrieval"]);c!=null&&a(n,["googleSearchRetrieval"],c);const f=s(t,["urlContext"]);return f!=null&&a(n,["urlContext"],f),n}function cs(t,e){const n={},o=s(t,["retrieval"]);o!=null&&a(n,["retrieval"],o);const i=s(t,["computerUse"]);if(i!=null&&a(n,["computerUse"],i),s(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const r=s(t,["codeExecution"]);r!=null&&a(n,["codeExecution"],r);const l=s(t,["enterpriseWebSearch"]);l!=null&&a(n,["enterpriseWebSearch"],l);const u=s(t,["functionDeclarations"]);if(u!=null){let h=u;Array.isArray(h)&&(h=h.map(g=>bc(g))),a(n,["functionDeclarations"],h)}const d=s(t,["googleMaps"]);d!=null&&a(n,["googleMaps"],d);const c=s(t,["googleSearch"]);c!=null&&a(n,["googleSearch"],c);const f=s(t,["googleSearchRetrieval"]);f!=null&&a(n,["googleSearchRetrieval"],f);const m=s(t,["urlContext"]);return m!=null&&a(n,["urlContext"],m),n}function Nd(t,e){const n={},o=s(t,["baseModel"]);o!=null&&a(n,["baseModel"],o);const i=s(t,["createTime"]);i!=null&&a(n,["createTime"],i);const r=s(t,["updateTime"]);return r!=null&&a(n,["updateTime"],r),n}function bd(t,e){const n={},o=s(t,["labels","google-vertex-llm-tuning-base-model-id"]);o!=null&&a(n,["baseModel"],o);const i=s(t,["createTime"]);i!=null&&a(n,["createTime"],i);const r=s(t,["updateTime"]);return r!=null&&a(n,["updateTime"],r),n}function Rd(t,e,n){const o={},i=s(t,["displayName"]);e!==void 0&&i!=null&&a(e,["displayName"],i);const r=s(t,["description"]);e!==void 0&&r!=null&&a(e,["description"],r);const l=s(t,["defaultCheckpointId"]);return e!==void 0&&l!=null&&a(e,["defaultCheckpointId"],l),o}function Pd(t,e,n){const o={},i=s(t,["displayName"]);e!==void 0&&i!=null&&a(e,["displayName"],i);const r=s(t,["description"]);e!==void 0&&r!=null&&a(e,["description"],r);const l=s(t,["defaultCheckpointId"]);return e!==void 0&&l!=null&&a(e,["defaultCheckpointId"],l),o}function Md(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","name"],V(t,i));const r=s(e,["config"]);return r!=null&&Rd(r,o),o}function kd(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["config"]);return r!=null&&Pd(r,o),o}function Dd(t,e,n){const o={},i=s(t,["outputGcsUri"]);e!==void 0&&i!=null&&a(e,["parameters","storageUri"],i);const r=s(t,["safetyFilterLevel"]);e!==void 0&&r!=null&&a(e,["parameters","safetySetting"],r);const l=s(t,["personGeneration"]);e!==void 0&&l!=null&&a(e,["parameters","personGeneration"],l);const u=s(t,["includeRaiReason"]);e!==void 0&&u!=null&&a(e,["parameters","includeRaiReason"],u);const d=s(t,["outputMimeType"]);e!==void 0&&d!=null&&a(e,["parameters","outputOptions","mimeType"],d);const c=s(t,["outputCompressionQuality"]);e!==void 0&&c!=null&&a(e,["parameters","outputOptions","compressionQuality"],c);const f=s(t,["enhanceInputImage"]);e!==void 0&&f!=null&&a(e,["parameters","upscaleConfig","enhanceInputImage"],f);const m=s(t,["imagePreservationFactor"]);e!==void 0&&m!=null&&a(e,["parameters","upscaleConfig","imagePreservationFactor"],m);const h=s(t,["labels"]);e!==void 0&&h!=null&&a(e,["labels"],h);const g=s(t,["numberOfImages"]);e!==void 0&&g!=null&&a(e,["parameters","sampleCount"],g);const y=s(t,["mode"]);return e!==void 0&&y!=null&&a(e,["parameters","mode"],y),o}function Ud(t,e,n){const o={},i=s(e,["model"]);i!=null&&a(o,["_url","model"],V(t,i));const r=s(e,["image"]);r!=null&&a(o,["instances[0]","image"],me(r));const l=s(e,["upscaleFactor"]);l!=null&&a(o,["parameters","upscaleConfig","upscaleFactor"],l);const u=s(e,["config"]);return u!=null&&Dd(u,o),o}function Ld(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["predictions"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>Tt(l))),a(n,["generatedImages"],r)}return n}function Fd(t,e){const n={},o=s(t,["uri"]);o!=null&&a(n,["uri"],o);const i=s(t,["encodedVideo"]);i!=null&&a(n,["videoBytes"],Ie(i));const r=s(t,["encoding"]);return r!=null&&a(n,["mimeType"],r),n}function Gd(t,e){const n={},o=s(t,["gcsUri"]);o!=null&&a(n,["uri"],o);const i=s(t,["bytesBase64Encoded"]);i!=null&&a(n,["videoBytes"],Ie(i));const r=s(t,["mimeType"]);return r!=null&&a(n,["mimeType"],r),n}function Vd(t,e){const n={},o=s(t,["image"]);o!=null&&a(n,["_self"],me(o));const i=s(t,["maskMode"]);return i!=null&&a(n,["maskMode"],i),n}function Hd(t,e){const n={},o=s(t,["image"]);o!=null&&a(n,["image"],xt(o));const i=s(t,["referenceType"]);return i!=null&&a(n,["referenceType"],i),n}function qd(t,e){const n={},o=s(t,["image"]);o!=null&&a(n,["image"],me(o));const i=s(t,["referenceType"]);return i!=null&&a(n,["referenceType"],i),n}function ds(t,e){const n={},o=s(t,["uri"]);o!=null&&a(n,["uri"],o);const i=s(t,["videoBytes"]);i!=null&&a(n,["encodedVideo"],Ie(i));const r=s(t,["mimeType"]);return r!=null&&a(n,["encoding"],r),n}function fs(t,e){const n={},o=s(t,["uri"]);o!=null&&a(n,["gcsUri"],o);const i=s(t,["videoBytes"]);i!=null&&a(n,["bytesBase64Encoded"],Ie(i));const r=s(t,["mimeType"]);return r!=null&&a(n,["mimeType"],r),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bd(t,e){const n={},o=s(t,["displayName"]);return e!==void 0&&o!=null&&a(e,["displayName"],o),n}function Kd(t){const e={},n=s(t,["config"]);return n!=null&&Bd(n,e),e}function $d(t,e){const n={},o=s(t,["force"]);return e!==void 0&&o!=null&&a(e,["_query","force"],o),n}function Jd(t){const e={},n=s(t,["name"]);n!=null&&a(e,["_url","name"],n);const o=s(t,["config"]);return o!=null&&$d(o,e),e}function Od(t){const e={},n=s(t,["name"]);return n!=null&&a(e,["_url","name"],n),e}function Wd(t,e){const n={},o=s(t,["customMetadata"]);if(e!==void 0&&o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>l)),a(e,["customMetadata"],r)}const i=s(t,["chunkingConfig"]);return e!==void 0&&i!=null&&a(e,["chunkingConfig"],i),n}function Yd(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const o=s(t,["metadata"]);o!=null&&a(e,["metadata"],o);const i=s(t,["done"]);i!=null&&a(e,["done"],i);const r=s(t,["error"]);r!=null&&a(e,["error"],r);const l=s(t,["response"]);return l!=null&&a(e,["response"],Xd(l)),e}function zd(t){const e={},n=s(t,["fileSearchStoreName"]);n!=null&&a(e,["_url","file_search_store_name"],n);const o=s(t,["fileName"]);o!=null&&a(e,["fileName"],o);const i=s(t,["config"]);return i!=null&&Wd(i,e),e}function Xd(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["parent"]);o!=null&&a(e,["parent"],o);const i=s(t,["documentName"]);return i!=null&&a(e,["documentName"],i),e}function Qd(t,e){const n={},o=s(t,["pageSize"]);e!==void 0&&o!=null&&a(e,["_query","pageSize"],o);const i=s(t,["pageToken"]);return e!==void 0&&i!=null&&a(e,["_query","pageToken"],i),n}function Zd(t){const e={},n=s(t,["config"]);return n!=null&&Qd(n,e),e}function jd(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["nextPageToken"]);o!=null&&a(e,["nextPageToken"],o);const i=s(t,["fileSearchStores"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>l)),a(e,["fileSearchStores"],r)}return e}function ps(t,e){const n={},o=s(t,["mimeType"]);e!==void 0&&o!=null&&a(e,["mimeType"],o);const i=s(t,["displayName"]);e!==void 0&&i!=null&&a(e,["displayName"],i);const r=s(t,["customMetadata"]);if(e!==void 0&&r!=null){let u=r;Array.isArray(u)&&(u=u.map(d=>d)),a(e,["customMetadata"],u)}const l=s(t,["chunkingConfig"]);return e!==void 0&&l!=null&&a(e,["chunkingConfig"],l),n}function ef(t){const e={},n=s(t,["fileSearchStoreName"]);n!=null&&a(e,["_url","file_search_store_name"],n);const o=s(t,["config"]);return o!=null&&ps(o,e),e}function tf(t){const e={},n=s(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const nf="Content-Type",of="X-Server-Timeout",sf="User-Agent",Yt="x-goog-api-client",rf="1.42.0",af=`google-genai-sdk/${rf}`,lf="v1beta1",uf="v1beta",cf=5,df=[408,429,500,502,503,504];class ff{constructor(e){var n,o,i;this.clientOptions=Object.assign({},e),this.customBaseUrl=(n=e.httpOptions)===null||n===void 0?void 0:n.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));const r={};if(this.clientOptions.vertexai){if(!this.clientOptions.location&&!this.clientOptions.apiKey&&!this.customBaseUrl&&(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw new Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");const u=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!u?(r.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||this.clientOptions.location==="global"?r.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(r.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),r.apiVersion=(o=this.clientOptions.apiVersion)!==null&&o!==void 0?o:lf}else{if(!this.clientOptions.apiKey)throw new ze({message:"API key must be set when using the Gemini API.",status:403});r.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:uf,r.baseUrl="https://generativelanguage.googleapis.com/"}r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const o=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&o.push(e.apiVersion),o.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,o){const i=[this.getRequestUrlInternal(n)];return o&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e,n){return!(n.baseUrl&&n.baseUrlResourceScope===Bt.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const o=this.shouldPrependVertexProjectPath(e,n),i=this.constructUrl(e.path,n,o);if(e.queryParams)for(const[l,u]of Object.entries(e.queryParams))i.searchParams.append(l,String(u));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,n,i.toString(),e.abortSignal),this.unaryApiCall(i,r,e.httpMethod)}patchHttpOptions(e,n){const o=JSON.parse(JSON.stringify(e));for(const[i,r]of Object.entries(n))typeof r=="object"?o[i]=Object.assign(Object.assign({},o[i]),r):r!==void 0&&(o[i]=r);return o}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const o=this.shouldPrependVertexProjectPath(e,n),i=this.constructUrl(e.path,n,o);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,n,i.toString(),e.abortSignal),this.streamApiCall(i,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,o,i){if(n&&n.timeout||i){const r=new AbortController,l=r.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const u=setTimeout(()=>r.abort(),n.timeout);u&&typeof u.unref=="function"&&u.unref()}i&&i.addEventListener("abort",()=>{r.abort()}),e.signal=l}return n&&n.extraBody!==null&&pf(e,n.extraBody),e.headers=await this.getHeadersInternal(n,o),e}async unaryApiCall(e,n,o){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:o})).then(async i=>(await Ti(i),new Kt(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,n,o){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:o})).then(async i=>(await Ti(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){return fe(this,arguments,function*(){var o;const i=(o=e==null?void 0:e.body)===null||o===void 0?void 0:o.getReader(),r=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let l="";const u="data:",d=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:c,value:f}=yield U(i.read());if(c){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const m=r.decode(f,{stream:!0});try{const y=JSON.parse(m);if("error"in y){const x=JSON.parse(JSON.stringify(y.error)),T=x.status,C=x.code,A=`got status: ${T}. ${JSON.stringify(y)}`;if(C>=400&&C<600)throw new ze({message:A,status:C})}}catch(y){if(y.name==="ApiError")throw y}l+=m;let h=-1,g=0;for(;;){h=-1,g=0;for(const T of d){const C=l.indexOf(T);C!==-1&&(h===-1||C<h)&&(h=C,g=T.length)}if(h===-1)break;const y=l.substring(0,h);l=l.substring(h+g);const x=y.trim();if(x.startsWith(u)){const T=x.substring(u.length).trim();try{const C=new Response(T,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield U(new Kt(C))}catch(C){throw new Error(`exception parsing stream chunk ${T}. ${C}`)}}}}}finally{i.releaseLock()}})}async apiCall(e,n){var o;if(!this.clientOptions.httpOptions||!this.clientOptions.httpOptions.retryOptions)return fetch(e,n);const i=this.clientOptions.httpOptions.retryOptions;return ea(async()=>{const l=await fetch(e,n);if(l.ok)return l;throw df.includes(l.status)?new Error(`Retryable HTTP Error: ${l.statusText}`):new Zr(`Non-retryable exception ${l.statusText} sending request`)},{retries:((o=i.attempts)!==null&&o!==void 0?o:cf)-1})}getDefaultHeaders(){const e={},n=af+" "+this.clientOptions.userAgentExtra;return e[sf]=n,e[Yt]=n,e[nf]="application/json",e}async getHeadersInternal(e,n){const o=new Headers;if(e&&e.headers){for(const[i,r]of Object.entries(e.headers))o.append(i,r);e.timeout&&e.timeout>0&&o.append(of,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(o,n),o}getFileName(e){var n;let o="";return typeof e=="string"&&(o=e.replace(/[/\\]+$/,""),o=(n=o.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),o}async uploadFile(e,n){var o;const i={};n!=null&&(i.mimeType=n.mimeType,i.name=n.name,i.displayName=n.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const r=this.clientOptions.uploader,l=await r.stat(e);i.sizeBytes=String(l.size);const u=(o=n==null?void 0:n.mimeType)!==null&&o!==void 0?o:l.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=u;const d={file:i},c=this.getFileName(e),f=b("upload/v1beta/files",d._url),m=await this.fetchUploadUrl(f,i.sizeBytes,i.mimeType,c,d,n==null?void 0:n.httpOptions);return r.upload(e,m,this)}async uploadFileToFileSearchStore(e,n,o){var i;const r=this.clientOptions.uploader,l=await r.stat(n),u=String(l.size),d=(i=o==null?void 0:o.mimeType)!==null&&i!==void 0?i:l.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const c=`upload/v1beta/${e}:uploadToFileSearchStore`,f=this.getFileName(n),m={};o!=null&&ps(o,m);const h=await this.fetchUploadUrl(c,u,d,f,m,o==null?void 0:o.httpOptions);return r.uploadToFileSearchStore(n,h,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,o,i,r,l){var u;let d={};l?d=l:d={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${o}`},i?{"X-Goog-Upload-File-Name":i}:{})};const c=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:d});if(!c||!(c!=null&&c.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const f=(u=c==null?void 0:c.headers)===null||u===void 0?void 0:u["x-goog-upload-url"];if(f===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return f}}async function Ti(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let o;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?o=await t.json():o={error:{message:await t.text(),code:t.status,status:t.statusText}};const i=JSON.stringify(o);throw n>=400&&n<600?new ze({message:i,status:n}):new Error(i)}}function pf(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const r=JSON.parse(t.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))n=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function o(r,l){const u=Object.assign({},r);for(const d in l)if(Object.prototype.hasOwnProperty.call(l,d)){const c=l[d],f=u[d];c&&typeof c=="object"&&!Array.isArray(c)&&f&&typeof f=="object"&&!Array.isArray(f)?u[d]=o(f,c):(f&&c&&typeof f!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${d}". Original type: ${typeof f}, New type: ${typeof c}. Overwriting.`),u[d]=c)}return u}const i=o(n,e);t.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mf="mcp_used/unknown";let hf=!1;function ms(t){for(const e of t)if(gf(e)||typeof e=="object"&&"inputSchema"in e)return!0;return hf}function hs(t){var e;const n=(e=t[Yt])!==null&&e!==void 0?e:"";t[Yt]=(n+` ${mf}`).trimStart()}function gf(t){return t!==null&&typeof t=="object"&&t instanceof dn}function yf(t){return fe(this,arguments,function*(n,o=100){let i,r=0;for(;r<o;){const l=yield U(n.listTools({cursor:i}));for(const u of l.tools)yield yield U(u),r++;if(!l.nextCursor)break;i=l.nextCursor}})}class dn{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new dn(e,n)}async initialize(){var e,n,o,i;if(this.mcpTools.length>0)return;const r={},l=[];for(const f of this.mcpClients)try{for(var u=!0,d=(n=void 0,pe(yf(f))),c;c=await d.next(),e=c.done,!e;u=!0){i=c.value,u=!1;const m=i;l.push(m);const h=m.name;if(r[h])throw new Error(`Duplicate function name ${h} found in MCP tools. Please ensure function names are unique.`);r[h]=f}}catch(m){n={error:m}}finally{try{!u&&!e&&(o=d.return)&&await o.call(d)}finally{if(n)throw n.error}}this.mcpTools=l,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),Ba(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const o of e)if(o.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[o.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const l=await i.callTool({name:o.name,arguments:o.args},void 0,r);n.push({functionResponse:{name:o.name,response:l.isError?{error:l}:l}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function vf(t,e,n){const o=new Da;let i;n.data instanceof Blob?i=JSON.parse(await n.data.text()):i=JSON.parse(n.data),Object.assign(o,i),e(o)}class Tf{constructor(e,n,o){this.apiClient=e,this.auth=n,this.webSocketFactory=o}async connect(e){var n,o;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),l=Ef(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),d=`${i}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${u}`;let c=()=>{};const f=new Promise(S=>{c=S}),m=e.callbacks,h=function(){c({})},g=this.apiClient,y={onopen:h,onmessage:S=>{vf(g,m.onmessage,S)},onerror:(n=m==null?void 0:m.onerror)!==null&&n!==void 0?n:function(S){},onclose:(o=m==null?void 0:m.onclose)!==null&&o!==void 0?o:function(S){}},x=this.webSocketFactory.create(d,_f(l),y);x.connect(),await f;const A={setup:{model:V(this.apiClient,e.model)}};return x.send(JSON.stringify(A)),new xf(x,this.apiClient)}}class xf{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=Bu(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=qu(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(Me.PLAY)}pause(){this.sendPlaybackControl(Me.PAUSE)}stop(){this.sendPlaybackControl(Me.STOP)}resetContext(){this.sendPlaybackControl(Me.RESET_CONTEXT)}close(){this.conn.close()}}function _f(t){const e={};return t.forEach((n,o)=>{e[o]=n}),e}function Ef(t){const e=new Headers;for(const[n,o]of Object.entries(t))e.append(n,o);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Cf="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Sf(t,e,n){const o=new ka;let i;n.data instanceof Blob?i=await n.data.text():n.data instanceof ArrayBuffer?i=new TextDecoder().decode(n.data):i=n.data;const r=JSON.parse(i);if(t.isVertexAI()){const l=Ju(r);Object.assign(o,l)}else Object.assign(o,r);e(o)}class If{constructor(e,n,o){this.apiClient=e,this.auth=n,this.webSocketFactory=o,this.music=new Tf(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,o,i,r,l,u;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const d=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let f;const m=this.apiClient.getHeaders();e.config&&e.config.tools&&ms(e.config.tools)&&hs(m);const h=bf(m);if(this.apiClient.isVertexAI()){const P=this.apiClient.getProject(),D=this.apiClient.getLocation(),F=this.apiClient.getApiKey(),H=!!P&&!!D||!!F;this.apiClient.getCustomBaseUrl()&&!H?f=d:(f=`${d}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(h,f))}else{const P=this.apiClient.getApiKey();let D="BidiGenerateContent",F="key";P!=null&&P.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),D="BidiGenerateContentConstrained",F="access_token"),f=`${d}/ws/google.ai.generativelanguage.${c}.GenerativeService.${D}?${F}=${P}`}let g=()=>{};const y=new Promise(P=>{g=P}),x=e.callbacks,T=function(){var P;(P=x==null?void 0:x.onopen)===null||P===void 0||P.call(x),g({})},C=this.apiClient,A={onopen:T,onmessage:P=>{Sf(C,x.onmessage,P)},onerror:(n=x==null?void 0:x.onerror)!==null&&n!==void 0?n:function(P){},onclose:(o=x==null?void 0:x.onclose)!==null&&o!==void 0?o:function(P){}},S=this.webSocketFactory.create(f,Nf(h),A);S.connect(),await y;let E=V(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&E.startsWith("publishers/")){const P=this.apiClient.getProject(),D=this.apiClient.getLocation();P&&D&&(E=`projects/${P}/locations/${D}/`+E)}let N={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[dt.AUDIO]}:e.config.responseModalities=[dt.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const _=(u=(l=e.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[],I=[];for(const P of _)if(this.isCallableTool(P)){const D=P;I.push(await D.tool())}else I.push(P);I.length>0&&(e.config.tools=I);const M={model:E,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?N=Hu(this.apiClient,M):N=Vu(this.apiClient,M),delete N.config,S.send(JSON.stringify(N)),new Af(S,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const wf={turnComplete:!0};class Af{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let o=[];try{o=se(n.turns),e.isVertexAI()||(o=o.map(i=>Qe(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:o,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let o=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?o=n.functionResponses:o=[n.functionResponses],o.length===0)throw new Error("functionResponses is required.");for(const r of o){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(Cf)}return{toolResponse:{functionResponses:o}}}sendClientContent(e){e=Object.assign(Object.assign({},wf),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:$u(e)}:n={realtimeInput:Ku(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function Nf(t){const e={};return t.forEach((n,o)=>{e[o]=n}),e}function bf(t){const e=new Headers;for(const[n,o]of Object.entries(t))e.append(n,o);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const xi=10;function _i(t){var e,n,o;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const l of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(Le(l)){i=!0;break}if(!i)return!0;const r=(o=t==null?void 0:t.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function Le(t){return"callTool"in t&&typeof t.callTool=="function"}function Rf(t){var e,n,o;return(o=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>Le(i)))!==null&&o!==void 0?o:!1}function Ei(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((o,i)=>{if(Le(o))return;const r=o;r.functionDeclarations&&r.functionDeclarations.length>0&&n.push(i)}),n}function Ci(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Pf extends Ee{constructor(e){super(),this.apiClient=e,this.embedContent=async n=>{if(!this.apiClient.isVertexAI())return await this.embedContentInternal(n);if(n.model.includes("gemini")&&n.model!=="gemini-embedding-001"||n.model.includes("maas")){const i=se(n.contents);if(i.length>1)throw new Error("The embedContent API for this model only supports one content at a time.");const r=Object.assign(Object.assign({},n),{content:i[0],embeddingApiType:ft.EMBED_CONTENT});return await this.embedContentInternal(r)}else{const i=Object.assign(Object.assign({},n),{embeddingApiType:ft.PREDICT});return await this.embedContentInternal(i)}},this.generateContent=async n=>{var o,i,r,l,u;const d=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!Rf(n)||_i(n.config))return await this.generateContentInternal(d);const c=Ei(n);if(c.length>0){const x=c.map(T=>`tools[${T}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${x}.`)}let f,m;const h=se(d.contents),g=(r=(i=(o=d.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:xi;let y=0;for(;y<g&&(f=await this.generateContentInternal(d),!(!f.functionCalls||f.functionCalls.length===0));){const x=f.candidates[0].content,T=[];for(const C of(u=(l=n.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[])if(Le(C)){const S=await C.callTool(f.functionCalls);T.push(...S)}y++,m={role:"user",parts:T},d.contents=se(d.contents),d.contents.push(x),d.contents.push(m),Ci(d.config)&&(h.push(x),h.push(m))}return Ci(d.config)&&(f.automaticFunctionCallingHistory=h),f},this.generateContentStream=async n=>{var o,i,r,l,u;if(this.maybeMoveToResponseJsonSchem(n),_i(n.config)){const m=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(m)}const d=Ei(n);if(d.length>0){const m=d.map(h=>`tools[${h}]`).join(", ");throw new Error(`Incompatible tools found at ${m}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const c=(r=(i=(o=n==null?void 0:n.config)===null||o===void 0?void 0:o.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,f=(u=(l=n==null?void 0:n.config)===null||l===void 0?void 0:l.automaticFunctionCalling)===null||u===void 0?void 0:u.disable;if(c&&!f)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(o=>{var i;let r;const l=[];if(o!=null&&o.generatedImages)for(const d of o.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((i=d==null?void 0:d.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?r=d==null?void 0:d.safetyAttributes:l.push(d);let u;return r?u={generatedImages:l,positivePromptSafetyAttributes:r,sdkHttpResponse:o.sdkHttpResponse}:u={generatedImages:l,sdkHttpResponse:o.sdkHttpResponse},u}),this.list=async n=>{var o;const l={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((o=l.config)===null||o===void 0)&&o.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new be(_e.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(l),l)},this.editImage=async n=>{const o={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(o.referenceImages=n.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(o)},this.upscaleImage=async n=>{let o={numberOfImages:1,mode:"upscale"};n.config&&(o=Object.assign(Object.assign({},o),n.config));const i={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:o};return await this.upscaleImageInternal(i)},this.generateVideos=async n=>{var o,i,r,l,u,d;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((o=n.video)===null||o===void 0)&&o.uri&&(!((i=n.video)===null||i===void 0)&&i.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((l=(r=n.source)===null||r===void 0?void 0:r.video)===null||l===void 0)&&l.uri&&(!((d=(u=n.source)===null||u===void 0?void 0:u.video)===null||d===void 0)&&d.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,o,i;const r=(n=e.config)===null||n===void 0?void 0:n.tools;if(!r)return e;const l=await Promise.all(r.map(async d=>Le(d)?await d.tool():d)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:l})};if(u.config.tools=l,e.config&&e.config.tools&&ms(e.config.tools)){const d=(i=(o=e.config.httpOptions)===null||o===void 0?void 0:o.headers)!==null&&i!==void 0?i:{};let c=Object.assign({},d);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),hs(c),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return u}async initAfcToolsMap(e){var n,o,i;const r=new Map;for(const l of(o=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&o!==void 0?o:[])if(Le(l)){const u=l,d=await u.tool();for(const c of(i=d.functionDeclarations)!==null&&i!==void 0?i:[]){if(!c.name)throw new Error("Function declaration name is required.");if(r.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);r.set(c.name,u)}}return r}async processAfcStream(e){var n,o,i;const r=(i=(o=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&i!==void 0?i:xi;let l=!1,u=0;const d=await this.initAfcToolsMap(e);return function(c,f,m){return fe(this,arguments,function*(){for(var h,g,y,x,T,C;u<r;){l&&(u++,l=!1);const N=yield U(c.processParamsMaybeAddMcpUsage(m)),_=yield U(c.generateContentStreamInternal(N)),I=[],M=[];try{for(var A=!0,S=(g=void 0,pe(_)),E;E=yield U(S.next()),h=E.done,!h;A=!0){x=E.value,A=!1;const P=x;if(yield yield U(P),P.candidates&&(!((T=P.candidates[0])===null||T===void 0)&&T.content)){M.push(P.candidates[0].content);for(const D of(C=P.candidates[0].content.parts)!==null&&C!==void 0?C:[])if(u<r&&D.functionCall){if(!D.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(D.functionCall.name)){const F=yield U(f.get(D.functionCall.name).callTool([D.functionCall]));I.push(...F)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${D.functionCall.name}`)}}}}catch(P){g={error:P}}finally{try{!A&&!h&&(y=S.return)&&(yield U(y.call(S)))}finally{if(g)throw g.error}}if(I.length>0){l=!0;const P=new Oe;P.candidates=[{content:{role:"user",parts:I}}],yield yield U(P);const D=[];D.push(...M),D.push({role:"user",parts:I});const F=se(m.contents).concat(D);m.contents=F}else break}})}(this,d,e)}async generateContentInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=gi(this.apiClient,e);return u=b("{model}:generateContent",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=vi(f),h=new Oe;return Object.assign(h,m),h})}else{const c=hi(this.apiClient,e);return u=b("{model}:generateContent",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=yi(f),h=new Oe;return Object.assign(h,m),h})}}async generateContentStreamInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=gi(this.apiClient,e);return u=b("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),l.then(function(m){return fe(this,arguments,function*(){var h,g,y,x;try{for(var T=!0,C=pe(m),A;A=yield U(C.next()),h=A.done,!h;T=!0){x=A.value,T=!1;const S=x,E=vi(yield U(S.json()),e);E.sdkHttpResponse={headers:S.headers};const N=new Oe;Object.assign(N,E),yield yield U(N)}}catch(S){g={error:S}}finally{try{!T&&!h&&(y=C.return)&&(yield U(y.call(C)))}finally{if(g)throw g.error}}})})}else{const c=hi(this.apiClient,e);return u=b("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),l.then(function(m){return fe(this,arguments,function*(){var h,g,y,x;try{for(var T=!0,C=pe(m),A;A=yield U(C.next()),h=A.done,!h;T=!0){x=A.value,T=!1;const S=x,E=yi(yield U(S.json()),e);E.sdkHttpResponse={headers:S.headers};const N=new Oe;Object.assign(N,E),yield yield U(N)}}catch(S){g={error:S}}finally{try{!T&&!h&&(y=C.return)&&(yield U(y.call(C)))}finally{if(g)throw g.error}}})})}}async embedContentInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ec(this.apiClient,e,e),f=$a(e.model)?"{model}:embedContent":"{model}:predict";return u=b(f,c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(h=>{const g=h;return g.sdkHttpResponse={headers:m.headers},g})),l.then(m=>{const h=Sc(m,e),g=new Zo;return Object.assign(g,h),g})}else{const c=_c(this.apiClient,e);return u=b("{model}:batchEmbedContents",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=Cc(f),h=new Zo;return Object.assign(h,m),h})}}async generateImagesInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Uc(this.apiClient,e);return u=b("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=Fc(f),h=new jo;return Object.assign(h,m),h})}else{const c=Dc(this.apiClient,e);return u=b("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=Lc(f),h=new jo;return Object.assign(h,m),h})}}async editImageInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI()){const u=yc(this.apiClient,e);return r=b("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=vc(d),f=new _a;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI()){const u=Ud(this.apiClient,e);return r=b("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=Ld(d),f=new Ea;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI()){const u=gd(this.apiClient,e);return r=b("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const c=yd(d),f=new Ca;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI()){const u=Cd(this.apiClient,e);return r=b("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Sd(d),f=new Sa;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=ed(this.apiClient,e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Wt(f))}else{const c=jc(this.apiClient,e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Ot(f))}}async listInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=ud(this.apiClient,e);return u=b("{models_url}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=dd(f),h=new ei;return Object.assign(h,m),h})}else{const c=ld(this.apiClient,e);return u=b("{models_url}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=cd(f),h=new ei;return Object.assign(h,m),h})}}async update(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=kd(this.apiClient,e);return u=b("{model}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Wt(f))}else{const c=Md(this.apiClient,e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Ot(f))}}async delete(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=pc(this.apiClient,e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=hc(f),h=new ti;return Object.assign(h,m),h})}else{const c=fc(this.apiClient,e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=mc(f),h=new ti;return Object.assign(h,m),h})}}async countTokens(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=uc(this.apiClient,e);return u=b("{model}:countTokens",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=dc(f),h=new ni;return Object.assign(h,m),h})}else{const c=lc(this.apiClient,e);return u=b("{model}:countTokens",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=cc(f),h=new ni;return Object.assign(h,m),h})}}async computeTokens(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI()){const u=tc(this.apiClient,e);return r=b("{model}:computeTokens",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=nc(d),f=new Ia;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Kc(this.apiClient,e);return u=b("{model}:predictLongRunning",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const m=qc(f),h=new pt;return Object.assign(h,m),h})}else{const c=Bc(this.apiClient,e);return u=b("{model}:predictLongRunning",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const m=Hc(f),h=new pt;return Object.assign(h,m),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Mf extends Ee{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,o=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let r;o&&"httpOptions"in o&&(r=o.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:r}});return n._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:o});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){const n=e.operation,o=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let r;o&&"httpOptions"in o&&(r=o.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:r}});return n._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:o});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=ha(e);return u=b("{operationName}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l}else{const c=ma(e);return u=b("{operationName}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l}}async fetchPredictVideosOperationInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI()){const u=aa(e);return r=b("{resourceName}:fetchPredictOperation",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function kf(t){const e={},n=s(t,["data"]);if(n!=null&&a(e,["data"],n),s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Df(t){const e={},n=s(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Kf(r))),a(e,["parts"],i)}const o=s(t,["role"]);return o!=null&&a(e,["role"],o),e}function Uf(t,e,n){const o={},i=s(e,["expireTime"]);n!==void 0&&i!=null&&a(n,["expireTime"],i);const r=s(e,["newSessionExpireTime"]);n!==void 0&&r!=null&&a(n,["newSessionExpireTime"],r);const l=s(e,["uses"]);n!==void 0&&l!=null&&a(n,["uses"],l);const u=s(e,["liveConnectConstraints"]);n!==void 0&&u!=null&&a(n,["bidiGenerateContentSetup"],Bf(t,u));const d=s(e,["lockAdditionalFields"]);return n!==void 0&&d!=null&&a(n,["fieldMask"],d),o}function Lf(t,e){const n={},o=s(e,["config"]);return o!=null&&a(n,["config"],Uf(t,o,n)),n}function Ff(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Gf(t){const e={},n=s(t,["id"]);n!=null&&a(e,["id"],n);const o=s(t,["args"]);o!=null&&a(e,["args"],o);const i=s(t,["name"]);if(i!=null&&a(e,["name"],i),s(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(s(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Vf(t){const e={};if(s(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=s(t,["enableWidget"]);return n!=null&&a(e,["enableWidget"],n),e}function Hf(t){const e={};if(s(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(s(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=s(t,["timeRangeFilter"]);return n!=null&&a(e,["timeRangeFilter"],n),e}function qf(t,e){const n={},o=s(t,["generationConfig"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig"],o);const i=s(t,["responseModalities"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig","responseModalities"],i);const r=s(t,["temperature"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig","temperature"],r);const l=s(t,["topP"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","topP"],l);const u=s(t,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const d=s(t,["maxOutputTokens"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","maxOutputTokens"],d);const c=s(t,["mediaResolution"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","mediaResolution"],c);const f=s(t,["seed"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","seed"],f);const m=s(t,["speechConfig"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","speechConfig"],cn(m));const h=s(t,["thinkingConfig"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","thinkingConfig"],h);const g=s(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],g);const y=s(t,["systemInstruction"]);e!==void 0&&y!=null&&a(e,["setup","systemInstruction"],Df(X(y)));const x=s(t,["tools"]);if(e!==void 0&&x!=null){let _=Ge(x);Array.isArray(_)&&(_=_.map(I=>Jf(Fe(I)))),a(e,["setup","tools"],_)}const T=s(t,["sessionResumption"]);e!==void 0&&T!=null&&a(e,["setup","sessionResumption"],$f(T));const C=s(t,["inputAudioTranscription"]);e!==void 0&&C!=null&&a(e,["setup","inputAudioTranscription"],C);const A=s(t,["outputAudioTranscription"]);e!==void 0&&A!=null&&a(e,["setup","outputAudioTranscription"],A);const S=s(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&a(e,["setup","realtimeInputConfig"],S);const E=s(t,["contextWindowCompression"]);e!==void 0&&E!=null&&a(e,["setup","contextWindowCompression"],E);const N=s(t,["proactivity"]);if(e!==void 0&&N!=null&&a(e,["setup","proactivity"],N),s(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function Bf(t,e){const n={},o=s(e,["model"]);o!=null&&a(n,["setup","model"],V(t,o));const i=s(e,["config"]);return i!=null&&a(n,["config"],qf(i,n)),n}function Kf(t){const e={},n=s(t,["mediaResolution"]);n!=null&&a(e,["mediaResolution"],n);const o=s(t,["codeExecutionResult"]);o!=null&&a(e,["codeExecutionResult"],o);const i=s(t,["executableCode"]);i!=null&&a(e,["executableCode"],i);const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],Ff(r));const l=s(t,["functionCall"]);l!=null&&a(e,["functionCall"],Gf(l));const u=s(t,["functionResponse"]);u!=null&&a(e,["functionResponse"],u);const d=s(t,["inlineData"]);d!=null&&a(e,["inlineData"],kf(d));const c=s(t,["text"]);c!=null&&a(e,["text"],c);const f=s(t,["thought"]);f!=null&&a(e,["thought"],f);const m=s(t,["thoughtSignature"]);m!=null&&a(e,["thoughtSignature"],m);const h=s(t,["videoMetadata"]);return h!=null&&a(e,["videoMetadata"],h),e}function $f(t){const e={},n=s(t,["handle"]);if(n!=null&&a(e,["handle"],n),s(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Jf(t){const e={};if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=s(t,["computerUse"]);n!=null&&a(e,["computerUse"],n);const o=s(t,["fileSearch"]);o!=null&&a(e,["fileSearch"],o);const i=s(t,["codeExecution"]);if(i!=null&&a(e,["codeExecution"],i),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const r=s(t,["functionDeclarations"]);if(r!=null){let f=r;Array.isArray(f)&&(f=f.map(m=>m)),a(e,["functionDeclarations"],f)}const l=s(t,["googleMaps"]);l!=null&&a(e,["googleMaps"],Vf(l));const u=s(t,["googleSearch"]);u!=null&&a(e,["googleSearch"],Hf(u));const d=s(t,["googleSearchRetrieval"]);d!=null&&a(e,["googleSearchRetrieval"],d);const c=s(t,["urlContext"]);return c!=null&&a(e,["urlContext"],c),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Of(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const o=t[n];if(typeof o=="object"&&o!=null&&Object.keys(o).length>0){const i=Object.keys(o).map(r=>`${n}.${r}`);e.push(...i)}else e.push(n)}return e.join(",")}function Wf(t,e){let n=null;const o=t.bidiGenerateContentSetup;if(typeof o=="object"&&o!==null&&"setup"in o){const r=o.setup;typeof r=="object"&&r!==null?(t.bidiGenerateContentSetup=r,n=r):delete t.bidiGenerateContentSetup}else o!==void 0&&delete t.bidiGenerateContentSetup;const i=t.fieldMask;if(n){const r=Of(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?t.fieldMask=r:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const l=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let u=[];i.length>0&&(u=i.map(c=>l.includes(c)?`generationConfig.${c}`:c));const d=[];r&&d.push(r),u.length>0&&d.push(...u),d.length>0?t.fieldMask=d.join(","):delete t.fieldMask}else delete t.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?t.fieldMask=i.join(","):delete t.fieldMask;return t}class Yf extends Ee{constructor(e){super(),this.apiClient=e}async create(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const u=Lf(this.apiClient,e);r=b("auth_tokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query;const d=Wf(u,e.config);return i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json()),i.then(c=>c)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zf(t,e){const n={},o=s(t,["force"]);return e!==void 0&&o!=null&&a(e,["_query","force"],o),n}function Xf(t){const e={},n=s(t,["name"]);n!=null&&a(e,["_url","name"],n);const o=s(t,["config"]);return o!=null&&zf(o,e),e}function Qf(t){const e={},n=s(t,["name"]);return n!=null&&a(e,["_url","name"],n),e}function Zf(t,e){const n={},o=s(t,["pageSize"]);e!==void 0&&o!=null&&a(e,["_query","pageSize"],o);const i=s(t,["pageToken"]);return e!==void 0&&i!=null&&a(e,["_query","pageToken"],i),n}function jf(t){const e={},n=s(t,["parent"]);n!=null&&a(e,["_url","parent"],n);const o=s(t,["config"]);return o!=null&&Zf(o,e),e}function ep(t){const e={},n=s(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const o=s(t,["nextPageToken"]);o!=null&&a(e,["nextPageToken"],o);const i=s(t,["documents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>l)),a(e,["documents"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tp extends Ee{constructor(e){super(),this.apiClient=e,this.list=async n=>new be(_e.PAGED_ITEM_DOCUMENTS,o=>this.listInternal({parent:n.parent,config:o.config}),await this.listInternal(n),n)}async get(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Qf(e);return r=b("{name}",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,o;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Xf(e);i=b("{name}",l._url),r=l._query,delete l._url,delete l._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=jf(e);return r=b("{parent}/documents",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const c=ep(d),f=new wa;return Object.assign(f,c),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class np extends Ee{constructor(e,n=new tp(e)){super(),this.apiClient=e,this.documents=n,this.list=async(o={})=>new be(_e.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(o),o)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Kd(e);return r=b("fileSearchStores",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async get(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Od(e);return r=b("{name}",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,o;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Jd(e);i=b("{name}",l._url),r=l._query,delete l._url,delete l._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Zd(e);return r=b("fileSearchStores",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const c=jd(d),f=new Aa;return Object.assign(f,c),f})}}async uploadToFileSearchStoreInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=ef(e);return r=b("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const c=tf(d),f=new Na;return Object.assign(f,c),f})}}async importFile(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=zd(e);return r=b("{file_search_store_name}:importFile",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Yd(d),f=new sn;return Object.assign(f,c),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let gs=function(){const{crypto:t}=globalThis;if(t!=null&&t.randomUUID)return gs=t.randomUUID.bind(t),t.randomUUID();const e=new Uint8Array(1),n=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,o=>(+o^n()&15>>+o/4).toString(16))};const op=()=>gs();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zt(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}const Xt=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){const e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ue extends Error{}class ne extends ue{constructor(e,n,o,i){super(`${ne.makeMessage(e,n,o)}`),this.status=e,this.headers=i,this.error=n}static makeMessage(e,n,o){const i=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):o;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,n,o,i){if(!e||!i)return new _t({message:o,cause:Xt(n)});const r=n;return e===400?new vs(e,r,o,i):e===401?new Ts(e,r,o,i):e===403?new xs(e,r,o,i):e===404?new _s(e,r,o,i):e===409?new Es(e,r,o,i):e===422?new Cs(e,r,o,i):e===429?new Ss(e,r,o,i):e>=500?new Is(e,r,o,i):new ne(e,r,o,i)}}class Qt extends ne{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class _t extends ne{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class ys extends _t{constructor({message:e}={}){super({message:e??"Request timed out."})}}class vs extends ne{}class Ts extends ne{}class xs extends ne{}class _s extends ne{}class Es extends ne{}class Cs extends ne{}class Ss extends ne{}class Is extends ne{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ip=/^[a-z][a-z0-9+.-]*:/i,sp=t=>ip.test(t);let Zt=t=>(Zt=Array.isArray,Zt(t));const rp=Zt;let ap=rp;const Si=ap;function lp(t){if(!t)return!0;for(const e in t)return!1;return!0}function up(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const cp=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ue(`${t} must be an integer`);if(e<0)throw new ue(`${t} must be a positive integer`);return e},dp=t=>{try{return JSON.parse(t)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fp=t=>new Promise(e=>setTimeout(e,t));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Pe="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pp(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const mp=()=>{var t,e,n,o,i;const r=pp();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Pe,"X-Stainless-OS":wi(Deno.build.os),"X-Stainless-Arch":Ii(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(t=Deno.version)===null||t===void 0?void 0:t.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Pe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Pe,"X-Stainless-OS":wi((n=globalThis.process.platform)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Arch":Ii((o=globalThis.process.arch)!==null&&o!==void 0?o:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};const l=hp();return l?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Pe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${l.browser}`,"X-Stainless-Runtime-Version":l.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Pe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function hp(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const o=n.exec(navigator.userAgent);if(o){const i=o[1]||0,r=o[2]||0,l=o[3]||0;return{browser:e,version:`${i}.${r}.${l}`}}}return null}const Ii=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",wi=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let ot;const gp=()=>ot??(ot=mp());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function yp(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function ws(...t){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function vp(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return ws({start(){},async pull(n){const{done:o,value:i}=await e.next();o?n.close():n.enqueue(i)},async cancel(){var n;await((n=e.return)===null||n===void 0?void 0:n.call(e))}})}function As(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Tp(t){var e,n;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((n=(e=t[Symbol.asyncIterator]()).return)===null||n===void 0?void 0:n.call(e));return}const o=t.getReader(),i=o.cancel();o.releaseLock(),await i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const xp=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ns=()=>{var t;if(typeof File>"u"){const{process:e}=globalThis,n=typeof((t=e==null?void 0:e.versions)===null||t===void 0?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Dt(t,e,n){return Ns(),new File(t,e??"unknown_file",n)}function _p(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}const Ep=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bs=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",Cp=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&bs(t),Sp=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function Ip(t,e,n){if(Ns(),t=await t,Cp(t))return t instanceof File?t:Dt([await t.arrayBuffer()],t.name);if(Sp(t)){const i=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),Dt(await jt(i),e,n)}const o=await jt(t);if(e||(e=_p(t)),!(n!=null&&n.type)){const i=o.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof i=="string"&&(n=Object.assign(Object.assign({},n),{type:i}))}return Dt(o,e,n)}async function jt(t){var e,n,o,i,r;let l=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)l.push(t);else if(bs(t))l.push(t instanceof Blob?t:await t.arrayBuffer());else if(Ep(t))try{for(var u=!0,d=pe(t),c;c=await d.next(),e=c.done,!e;u=!0){i=c.value,u=!1;const f=i;l.push(...await jt(f))}}catch(f){n={error:f}}finally{try{!u&&!e&&(o=d.return)&&await o.call(d)}finally{if(n)throw n.error}}else{const f=(r=t==null?void 0:t.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof t}${f?`; constructor: ${f}`:""}${wp(t)}`)}return l}function wp(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Rs{constructor(e){this._client=e}}Rs._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ps(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Ai=Object.freeze(Object.create(null)),Ap=(t=Ps)=>function(n,...o){if(n.length===1)return n[0];let i=!1;const r=[],l=n.reduce((f,m,h)=>{var g,y,x;/[?#]/.test(m)&&(i=!0);const T=o[h];let C=(i?encodeURIComponent:t)(""+T);return h!==o.length&&(T==null||typeof T=="object"&&T.toString===((x=Object.getPrototypeOf((y=Object.getPrototypeOf((g=T.hasOwnProperty)!==null&&g!==void 0?g:Ai))!==null&&y!==void 0?y:Ai))===null||x===void 0?void 0:x.toString))&&(C=T+"",r.push({start:f.length+m.length,length:C.length,error:`Value of type ${Object.prototype.toString.call(T).slice(8,-1)} is not a valid path parameter`})),f+m+(h===o.length?"":C)},""),u=l.split(/[?#]/,1)[0],d=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=d.exec(u))!==null;)r.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(r.sort((f,m)=>f.start-m.start),r.length>0){let f=0;const m=r.reduce((h,g)=>{const y=" ".repeat(g.start-f),x="^".repeat(g.length);return f=g.start+g.length,h+y+x},"");throw new ue(`Path parameters result in path with invalid segments:
${r.map(h=>h.error).join(`
`)}
${l}
${m}`)}return l},it=Ap(Ps);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ms extends Rs{create(e,n){var o;const{api_version:i=this._client.apiVersion}=e,r=ht(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new ue("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new ue("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(it`/${i}/interactions`,Object.assign(Object.assign({body:r},n),{stream:(o=e.stream)!==null&&o!==void 0?o:!1}))}delete(e,n={},o){const{api_version:i=this._client.apiVersion}=n??{};return this._client.delete(it`/${i}/interactions/${e}`,o)}cancel(e,n={},o){const{api_version:i=this._client.apiVersion}=n??{};return this._client.post(it`/${i}/interactions/${e}/cancel`,o)}get(e,n={},o){var i;const r=n??{},{api_version:l=this._client.apiVersion}=r,u=ht(r,["api_version"]);return this._client.get(it`/${l}/interactions/${e}`,Object.assign(Object.assign({query:u},o),{stream:(i=n==null?void 0:n.stream)!==null&&i!==void 0?i:!1}))}}Ms._key=Object.freeze(["interactions"]);class ks extends Ms{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Np(t){let e=0;for(const i of t)e+=i.length;const n=new Uint8Array(e);let o=0;for(const i of t)n.set(i,o),o+=i.length;return n}let st;function fn(t){let e;return(st??(e=new globalThis.TextEncoder,st=e.encode.bind(e)))(t)}let rt;function Ni(t){let e;return(rt??(e=new globalThis.TextDecoder,rt=e.decode.bind(e)))(t)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Et{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?fn(e):e;this.buffer=Np([this.buffer,n]);const o=[];let i;for(;(i=bp(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){o.push(Ni(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const r=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,l=Ni(this.buffer.subarray(0,r));o.push(l),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return o}flush(){return this.buffer.length?this.decode(`
`):[]}}Et.NEWLINE_CHARS=new Set([`
`,"\r"]);Et.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function bp(t,e){for(let i=e??0;i<t.length;i++){if(t[i]===10)return{preceding:i,index:i+1,carriage:!1};if(t[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function Rp(t){for(let o=0;o<t.length-1;o++){if(t[o]===10&&t[o+1]===10||t[o]===13&&t[o+1]===13)return o+2;if(t[o]===13&&t[o+1]===10&&o+3<t.length&&t[o+2]===13&&t[o+3]===10)return o+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const gt={off:0,error:200,warn:300,info:400,debug:500},bi=(t,e,n)=>{if(t){if(up(gt,t))return t;ee(n).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(gt))}`)}};function Ye(){}function at(t,e,n){return!e||gt[t]>gt[n]?Ye:e[t].bind(e)}const Pp={error:Ye,warn:Ye,info:Ye,debug:Ye};let Ri=new WeakMap;function ee(t){var e;const n=t.logger,o=(e=t.logLevel)!==null&&e!==void 0?e:"off";if(!n)return Pp;const i=Ri.get(n);if(i&&i[0]===o)return i[1];const r={error:at("error",n,o),warn:at("warn",n,o),info:at("info",n,o),debug:at("debug",n,o)};return Ri.set(n,[o,r]),r}const Ne=t=>(t.options&&(t.options=Object.assign({},t.options),delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,n])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ke{constructor(e,n,o){this.iterator=e,this.controller=n,this.client=o}static fromSSEResponse(e,n,o){let i=!1;const r=o?ee(o):console;function l(){return fe(this,arguments,function*(){var d,c,f,m;if(i)throw new ue("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let h=!1;try{try{for(var g=!0,y=pe(Mp(e,n)),x;x=yield U(y.next()),d=x.done,!d;g=!0){m=x.value,g=!1;const T=m;if(!h)if(T.data.startsWith("[DONE]")){h=!0;continue}else try{yield yield U(JSON.parse(T.data))}catch(C){throw r.error("Could not parse message into JSON:",T.data),r.error("From chunk:",T.raw),C}}}catch(T){c={error:T}}finally{try{!g&&!d&&(f=y.return)&&(yield U(f.call(y)))}finally{if(c)throw c.error}}h=!0}catch(T){if(zt(T))return yield U(void 0);throw T}finally{h||n.abort()}})}return new ke(l,n,o)}static fromReadableStream(e,n,o){let i=!1;function r(){return fe(this,arguments,function*(){var d,c,f,m;const h=new Et,g=As(e);try{for(var y=!0,x=pe(g),T;T=yield U(x.next()),d=T.done,!d;y=!0){m=T.value,y=!1;const C=m;for(const A of h.decode(C))yield yield U(A)}}catch(C){c={error:C}}finally{try{!y&&!d&&(f=x.return)&&(yield U(f.call(x)))}finally{if(c)throw c.error}}for(const C of h.flush())yield yield U(C)})}function l(){return fe(this,arguments,function*(){var d,c,f,m;if(i)throw new ue("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let h=!1;try{try{for(var g=!0,y=pe(r()),x;x=yield U(y.next()),d=x.done,!d;g=!0){m=x.value,g=!1;const T=m;h||T&&(yield yield U(JSON.parse(T)))}}catch(T){c={error:T}}finally{try{!g&&!d&&(f=y.return)&&(yield U(f.call(y)))}finally{if(c)throw c.error}}h=!0}catch(T){if(zt(T))return yield U(void 0);throw T}finally{h||n.abort()}})}return new ke(l,n,o)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],o=this.iterator(),i=r=>({next:()=>{if(r.length===0){const l=o.next();e.push(l),n.push(l)}return r.shift()}});return[new ke(()=>i(e),this.controller,this.client),new ke(()=>i(n),this.controller,this.client)]}toReadableStream(){const e=this;let n;return ws({async start(){n=e[Symbol.asyncIterator]()},async pull(o){try{const{value:i,done:r}=await n.next();if(r)return o.close();const l=fn(JSON.stringify(i)+`
`);o.enqueue(l)}catch(i){o.error(i)}},async cancel(){var o;await((o=n.return)===null||o===void 0?void 0:o.call(n))}})}}function Mp(t,e){return fe(this,arguments,function*(){var o,i,r,l;if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new ue("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new ue("Attempted to iterate over a response with no body");const u=new Dp,d=new Et,c=As(t.body);try{for(var f=!0,m=pe(kp(c)),h;h=yield U(m.next()),o=h.done,!o;f=!0){l=h.value,f=!1;const g=l;for(const y of d.decode(g)){const x=u.decode(y);x&&(yield yield U(x))}}}catch(g){i={error:g}}finally{try{!f&&!o&&(r=m.return)&&(yield U(r.call(m)))}finally{if(i)throw i.error}}for(const g of d.flush()){const y=u.decode(g);y&&(yield yield U(y))}})}function kp(t){return fe(this,arguments,function*(){var n,o,i,r;let l=new Uint8Array;try{for(var u=!0,d=pe(t),c;c=yield U(d.next()),n=c.done,!n;u=!0){r=c.value,u=!1;const f=r;if(f==null)continue;const m=f instanceof ArrayBuffer?new Uint8Array(f):typeof f=="string"?fn(f):f;let h=new Uint8Array(l.length+m.length);h.set(l),h.set(m,l.length),l=h;let g;for(;(g=Rp(l))!==-1;)yield yield U(l.slice(0,g)),l=l.slice(g)}}catch(f){o={error:f}}finally{try{!u&&!n&&(i=d.return)&&(yield U(i.call(d)))}finally{if(o)throw o.error}}l.length>0&&(yield yield U(l))})}class Dp{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,o,i]=Up(e,":");return i.startsWith(" ")&&(i=i.substring(1)),n==="event"?this.event=i:n==="data"&&this.data.push(i),null}}function Up(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function Lp(t,e){const{response:n,requestLogID:o,retryOfRequestLogID:i,startTime:r}=e,l=await(async()=>{var u;if(e.options.stream)return ee(t).debug("response",n.status,n.url,n.headers,n.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(n,e.controller,t):ke.fromSSEResponse(n,e.controller,t);if(n.status===204)return null;if(e.options.__binaryResponse)return n;const d=n.headers.get("content-type"),c=(u=d==null?void 0:d.split(";")[0])===null||u===void 0?void 0:u.trim();return(c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))?n.headers.get("content-length")==="0"?void 0:await n.json():await n.text()})();return ee(t).debug(`[${o}] response parsed`,Ne({retryOfRequestLogID:i,url:n.url,status:n.status,body:l,durationMs:Date.now()-r})),l}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class pn extends Promise{constructor(e,n,o=Lp){super(i=>{i(null)}),this.responsePromise=n,this.parseResponse=o,this.client=e}_thenUnwrap(e){return new pn(this.client,this.responsePromise,async(n,o)=>e(await this.parseResponse(n,o),o))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ds=Symbol("brand.privateNullableHeaders");function*Fp(t){if(!t)return;if(Ds in t){const{values:o,nulls:i}=t;yield*o.entries();for(const r of i)yield[r,null];return}let e=!1,n;t instanceof Headers?n=t.entries():Si(t)?n=t:(e=!0,n=Object.entries(t??{}));for(let o of n){const i=o[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const r=Si(o[1])?o[1]:[o[1]];let l=!1;for(const u of r)u!==void 0&&(e&&!l&&(l=!0,yield[i,null]),yield[i,u])}}const We=t=>{const e=new Headers,n=new Set;for(const o of t){const i=new Set;for(const[r,l]of Fp(o)){const u=r.toLowerCase();i.has(u)||(e.delete(r),i.add(u)),l===null?(e.delete(r),n.add(u)):(e.append(r,l),n.delete(u))}}return{[Ds]:!0,values:e,nulls:n}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ut=t=>{var e,n,o,i,r,l;if(typeof globalThis.process<"u")return(o=(n=(e=ta)===null||e===void 0?void 0:e[t])===null||n===void 0?void 0:n.trim())!==null&&o!==void 0?o:void 0;if(typeof globalThis.Deno<"u")return(l=(r=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||r===void 0?void 0:r.call(i,t))===null||l===void 0?void 0:l.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Us;class Ct{constructor(e){var n,o,i,r,l,u,d,{baseURL:c=Ut("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:f=(n=Ut("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:m="v1beta"}=e,h=ht(e,["baseURL","apiKey","apiVersion"]);const g=Object.assign(Object.assign({apiKey:f,apiVersion:m},h),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=g.baseURL,this.timeout=(o=g.timeout)!==null&&o!==void 0?o:Ct.DEFAULT_TIMEOUT,this.logger=(i=g.logger)!==null&&i!==void 0?i:console;const y="warn";this.logLevel=y,this.logLevel=(l=(r=bi(g.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:bi(Ut("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&l!==void 0?l:y,this.fetchOptions=g.fetchOptions,this.maxRetries=(u=g.maxRetries)!==null&&u!==void 0?u:2,this.fetch=(d=g.fetch)!==null&&d!==void 0?d:yp(),this.encoder=xp,this._options=g,this.apiKey=f,this.apiVersion=m,this.clientAdapter=g.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:n}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const n=We([e.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return We([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return We([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([n,o])=>typeof o<"u").map(([n,o])=>{if(typeof o=="string"||typeof o=="number"||typeof o=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(o)}`;if(o===null)return`${encodeURIComponent(n)}=`;throw new ue(`Cannot stringify type ${typeof o}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Pe}`}defaultIdempotencyKey(){return`stainless-node-retry-${op()}`}makeStatusError(e,n,o,i){return ne.generate(e,n,o,i)}buildURL(e,n,o){const i=!this.baseURLOverridden()&&o||this.baseURL,r=sp(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),l=this.defaultQuery();return lp(l)||(n=Object.assign(Object.assign({},l),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const n=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(e,{url:n,options:o}){}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,o){return this.request(Promise.resolve(o).then(i=>Object.assign({method:e,path:n},i)))}request(e,n=null){return new pn(this,this.makeRequest(e,n,void 0))}async makeRequest(e,n,o){var i,r,l;const u=await e,d=(i=u.maxRetries)!==null&&i!==void 0?i:this.maxRetries;n==null&&(n=d),await this.prepareOptions(u);const{req:c,url:f,timeout:m}=await this.buildRequest(u,{retryCount:d-n});await this.prepareRequest(c,{url:f,options:u});const h="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),g=o===void 0?"":`, retryOf: ${o}`,y=Date.now();if(ee(this).debug(`[${h}] sending request`,Ne({retryOfRequestLogID:o,method:u.method,url:f,options:u,headers:c.headers})),!((r=u.signal)===null||r===void 0)&&r.aborted)throw new Qt;const x=new AbortController,T=await this.fetchWithTimeout(f,c,m,x).catch(Xt),C=Date.now();if(T instanceof globalThis.Error){const S=`retrying, ${n} attempts remaining`;if(!((l=u.signal)===null||l===void 0)&&l.aborted)throw new Qt;const E=zt(T)||/timed? ?out/i.test(String(T)+("cause"in T?String(T.cause):""));if(n)return ee(this).info(`[${h}] connection ${E?"timed out":"failed"} - ${S}`),ee(this).debug(`[${h}] connection ${E?"timed out":"failed"} (${S})`,Ne({retryOfRequestLogID:o,url:f,durationMs:C-y,message:T.message})),this.retryRequest(u,n,o??h);throw ee(this).info(`[${h}] connection ${E?"timed out":"failed"} - error; no more retries left`),ee(this).debug(`[${h}] connection ${E?"timed out":"failed"} (error; no more retries left)`,Ne({retryOfRequestLogID:o,url:f,durationMs:C-y,message:T.message})),E?new ys:new _t({cause:T})}const A=`[${h}${g}] ${c.method} ${f} ${T.ok?"succeeded":"failed"} with status ${T.status} in ${C-y}ms`;if(!T.ok){const S=await this.shouldRetry(T);if(n&&S){const P=`retrying, ${n} attempts remaining`;return await Tp(T.body),ee(this).info(`${A} - ${P}`),ee(this).debug(`[${h}] response error (${P})`,Ne({retryOfRequestLogID:o,url:T.url,status:T.status,headers:T.headers,durationMs:C-y})),this.retryRequest(u,n,o??h,T.headers)}const E=S?"error; no more retries left":"error; not retryable";ee(this).info(`${A} - ${E}`);const N=await T.text().catch(P=>Xt(P).message),_=dp(N),I=_?void 0:N;throw ee(this).debug(`[${h}] response error (${E})`,Ne({retryOfRequestLogID:o,url:T.url,status:T.status,headers:T.headers,message:I,durationMs:Date.now()-y})),this.makeStatusError(T.status,_,I,T.headers)}return ee(this).info(A),ee(this).debug(`[${h}] response start`,Ne({retryOfRequestLogID:o,url:T.url,status:T.status,headers:T.headers,durationMs:C-y})),{response:T,options:u,controller:x,requestLogID:h,retryOfRequestLogID:o,startTime:y}}async fetchWithTimeout(e,n,o,i){const r=n||{},{signal:l,method:u}=r,d=ht(r,["signal","method"]),c=this._makeAbort(i);l&&l.addEventListener("abort",c,{once:!0});const f=setTimeout(c,o),m=globalThis.ReadableStream&&d.body instanceof globalThis.ReadableStream||typeof d.body=="object"&&d.body!==null&&Symbol.asyncIterator in d.body,h=Object.assign(Object.assign(Object.assign({signal:i.signal},m?{duplex:"half"}:{}),{method:"GET"}),d);u&&(h.method=u.toUpperCase());try{return await this.fetch.call(void 0,e,h)}finally{clearTimeout(f)}}async shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,o,i){var r;let l;const u=i==null?void 0:i.get("retry-after-ms");if(u){const c=parseFloat(u);Number.isNaN(c)||(l=c)}const d=i==null?void 0:i.get("retry-after");if(d&&!l){const c=parseFloat(d);Number.isNaN(c)?l=Date.parse(d)-Date.now():l=c*1e3}if(!(l&&0<=l&&l<60*1e3)){const c=(r=e.maxRetries)!==null&&r!==void 0?r:this.maxRetries;l=this.calculateDefaultRetryTimeoutMillis(n,c)}return await fp(l),this.makeRequest(e,n-1,o)}calculateDefaultRetryTimeoutMillis(e,n){const r=n-e,l=Math.min(.5*Math.pow(2,r),8),u=1-Math.random()*.25;return l*u*1e3}async buildRequest(e,{retryCount:n=0}={}){var o,i,r;const l=Object.assign({},e),{method:u,path:d,query:c,defaultBaseURL:f}=l,m=this.buildURL(d,c,f);"timeout"in l&&cp("timeout",l.timeout),l.timeout=(o=l.timeout)!==null&&o!==void 0?o:this.timeout;const{bodyHeaders:h,body:g}=this.buildBody({options:l}),y=await this.buildHeaders({options:e,method:u,bodyHeaders:h,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:u,headers:y},l.signal&&{signal:l.signal}),globalThis.ReadableStream&&g instanceof globalThis.ReadableStream&&{duplex:"half"}),g&&{body:g}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(r=l.fetchOptions)!==null&&r!==void 0?r:{}),url:m,timeout:l.timeout}}async buildHeaders({options:e,method:n,bodyHeaders:o,retryCount:i}){let r={};this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const l=await this.authHeaders(e);let u=We([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),gp()),this._options.defaultHeaders,o,e.headers,l]);return this.validateHeaders(u),u.values}_makeAbort(e){return()=>e.abort()}buildBody({options:{body:e,headers:n}}){if(!e)return{bodyHeaders:void 0,body:void 0};const o=We([n]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&o.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:vp(e)}:typeof e=="object"&&o.values.get("content-type")==="application/x-www-form-urlencoded"?{bodyHeaders:{"content-type":"application/x-www-form-urlencoded"},body:this.stringifyQuery(e)}:this.encoder({body:e,headers:o})}}Ct.DEFAULT_TIMEOUT=6e4;class Q extends Ct{constructor(){super(...arguments),this.interactions=new ks(this)}}Us=Q;Q.GeminiNextGenAPIClient=Us;Q.GeminiNextGenAPIClientError=ue;Q.APIError=ne;Q.APIConnectionError=_t;Q.APIConnectionTimeoutError=ys;Q.APIUserAbortError=Qt;Q.NotFoundError=_s;Q.ConflictError=Es;Q.RateLimitError=Ss;Q.BadRequestError=vs;Q.AuthenticationError=Ts;Q.InternalServerError=Is;Q.PermissionDeniedError=xs;Q.UnprocessableEntityError=Cs;Q.toFile=Ip;Q.Interactions=ks;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Gp(t,e){const n={},o=s(t,["name"]);return o!=null&&a(n,["_url","name"],o),n}function Vp(t,e){const n={},o=s(t,["name"]);return o!=null&&a(n,["_url","name"],o),n}function Hp(t,e){const n={},o=s(t,["sdkHttpResponse"]);return o!=null&&a(n,["sdkHttpResponse"],o),n}function qp(t,e){const n={},o=s(t,["sdkHttpResponse"]);return o!=null&&a(n,["sdkHttpResponse"],o),n}function Bp(t,e,n){const o={};if(s(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=s(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&a(e,["displayName"],i),s(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=s(t,["epochCount"]);e!==void 0&&r!=null&&a(e,["tuningTask","hyperparameters","epochCount"],r);const l=s(t,["learningRateMultiplier"]);if(l!=null&&a(o,["tuningTask","hyperparameters","learningRateMultiplier"],l),s(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(s(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(s(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");if(s(t,["tuningMode"])!==void 0)throw new Error("tuningMode parameter is not supported in Gemini API.");if(s(t,["customBaseModel"])!==void 0)throw new Error("customBaseModel parameter is not supported in Gemini API.");const u=s(t,["batchSize"]);e!==void 0&&u!=null&&a(e,["tuningTask","hyperparameters","batchSize"],u);const d=s(t,["learningRate"]);if(e!==void 0&&d!=null&&a(e,["tuningTask","hyperparameters","learningRate"],d),s(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(s(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");if(s(t,["baseTeacherModel"])!==void 0)throw new Error("baseTeacherModel parameter is not supported in Gemini API.");if(s(t,["tunedTeacherModelSource"])!==void 0)throw new Error("tunedTeacherModelSource parameter is not supported in Gemini API.");if(s(t,["sftLossWeightMultiplier"])!==void 0)throw new Error("sftLossWeightMultiplier parameter is not supported in Gemini API.");if(s(t,["outputUri"])!==void 0)throw new Error("outputUri parameter is not supported in Gemini API.");if(s(t,["encryptionSpec"])!==void 0)throw new Error("encryptionSpec parameter is not supported in Gemini API.");return o}function Kp(t,e,n){const o={};let i=s(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const _=s(t,["validationDataset"]);e!==void 0&&_!=null&&a(e,["supervisedTuningSpec"],Lt(_))}else if(i==="PREFERENCE_TUNING"){const _=s(t,["validationDataset"]);e!==void 0&&_!=null&&a(e,["preferenceOptimizationSpec"],Lt(_))}else if(i==="DISTILLATION"){const _=s(t,["validationDataset"]);e!==void 0&&_!=null&&a(e,["distillationSpec"],Lt(_))}const r=s(t,["tunedModelDisplayName"]);e!==void 0&&r!=null&&a(e,["tunedModelDisplayName"],r);const l=s(t,["description"]);e!==void 0&&l!=null&&a(e,["description"],l);let u=s(n,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const _=s(t,["epochCount"]);e!==void 0&&_!=null&&a(e,["supervisedTuningSpec","hyperParameters","epochCount"],_)}else if(u==="PREFERENCE_TUNING"){const _=s(t,["epochCount"]);e!==void 0&&_!=null&&a(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],_)}else if(u==="DISTILLATION"){const _=s(t,["epochCount"]);e!==void 0&&_!=null&&a(e,["distillationSpec","hyperParameters","epochCount"],_)}let d=s(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const _=s(t,["learningRateMultiplier"]);e!==void 0&&_!=null&&a(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],_)}else if(d==="PREFERENCE_TUNING"){const _=s(t,["learningRateMultiplier"]);e!==void 0&&_!=null&&a(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],_)}else if(d==="DISTILLATION"){const _=s(t,["learningRateMultiplier"]);e!==void 0&&_!=null&&a(e,["distillationSpec","hyperParameters","learningRateMultiplier"],_)}let c=s(n,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const _=s(t,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&a(e,["supervisedTuningSpec","exportLastCheckpointOnly"],_)}else if(c==="PREFERENCE_TUNING"){const _=s(t,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&a(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],_)}else if(c==="DISTILLATION"){const _=s(t,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&a(e,["distillationSpec","exportLastCheckpointOnly"],_)}let f=s(n,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const _=s(t,["adapterSize"]);e!==void 0&&_!=null&&a(e,["supervisedTuningSpec","hyperParameters","adapterSize"],_)}else if(f==="PREFERENCE_TUNING"){const _=s(t,["adapterSize"]);e!==void 0&&_!=null&&a(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],_)}else if(f==="DISTILLATION"){const _=s(t,["adapterSize"]);e!==void 0&&_!=null&&a(e,["distillationSpec","hyperParameters","adapterSize"],_)}let m=s(n,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){const _=s(t,["tuningMode"]);e!==void 0&&_!=null&&a(e,["supervisedTuningSpec","tuningMode"],_)}const h=s(t,["customBaseModel"]);e!==void 0&&h!=null&&a(e,["customBaseModel"],h);let g=s(n,["config","method"]);if(g===void 0&&(g="SUPERVISED_FINE_TUNING"),g==="SUPERVISED_FINE_TUNING"){const _=s(t,["batchSize"]);e!==void 0&&_!=null&&a(e,["supervisedTuningSpec","hyperParameters","batchSize"],_)}let y=s(n,["config","method"]);if(y===void 0&&(y="SUPERVISED_FINE_TUNING"),y==="SUPERVISED_FINE_TUNING"){const _=s(t,["learningRate"]);e!==void 0&&_!=null&&a(e,["supervisedTuningSpec","hyperParameters","learningRate"],_)}const x=s(t,["labels"]);e!==void 0&&x!=null&&a(e,["labels"],x);const T=s(t,["beta"]);e!==void 0&&T!=null&&a(e,["preferenceOptimizationSpec","hyperParameters","beta"],T);const C=s(t,["baseTeacherModel"]);e!==void 0&&C!=null&&a(e,["distillationSpec","baseTeacherModel"],C);const A=s(t,["tunedTeacherModelSource"]);e!==void 0&&A!=null&&a(e,["distillationSpec","tunedTeacherModelSource"],A);const S=s(t,["sftLossWeightMultiplier"]);e!==void 0&&S!=null&&a(e,["distillationSpec","hyperParameters","sftLossWeightMultiplier"],S);const E=s(t,["outputUri"]);e!==void 0&&E!=null&&a(e,["outputUri"],E);const N=s(t,["encryptionSpec"]);return e!==void 0&&N!=null&&a(e,["encryptionSpec"],N),o}function $p(t,e){const n={},o=s(t,["baseModel"]);o!=null&&a(n,["baseModel"],o);const i=s(t,["preTunedModel"]);i!=null&&a(n,["preTunedModel"],i);const r=s(t,["trainingDataset"]);r!=null&&tm(r);const l=s(t,["config"]);return l!=null&&Bp(l,n),n}function Jp(t,e){const n={},o=s(t,["baseModel"]);o!=null&&a(n,["baseModel"],o);const i=s(t,["preTunedModel"]);i!=null&&a(n,["preTunedModel"],i);const r=s(t,["trainingDataset"]);r!=null&&nm(r,n,e);const l=s(t,["config"]);return l!=null&&Kp(l,n,e),n}function Op(t,e){const n={},o=s(t,["name"]);return o!=null&&a(n,["_url","name"],o),n}function Wp(t,e){const n={},o=s(t,["name"]);return o!=null&&a(n,["_url","name"],o),n}function Yp(t,e,n){const o={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const r=s(t,["pageToken"]);e!==void 0&&r!=null&&a(e,["_query","pageToken"],r);const l=s(t,["filter"]);return e!==void 0&&l!=null&&a(e,["_query","filter"],l),o}function zp(t,e,n){const o={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const r=s(t,["pageToken"]);e!==void 0&&r!=null&&a(e,["_query","pageToken"],r);const l=s(t,["filter"]);return e!==void 0&&l!=null&&a(e,["_query","filter"],l),o}function Xp(t,e){const n={},o=s(t,["config"]);return o!=null&&Yp(o,n),n}function Qp(t,e){const n={},o=s(t,["config"]);return o!=null&&zp(o,n),n}function Zp(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["nextPageToken"]);i!=null&&a(n,["nextPageToken"],i);const r=s(t,["tunedModels"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(u=>Ls(u))),a(n,["tuningJobs"],l)}return n}function jp(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["nextPageToken"]);i!=null&&a(n,["nextPageToken"],i);const r=s(t,["tuningJobs"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(u=>en(u))),a(n,["tuningJobs"],l)}return n}function em(t,e){const n={},o=s(t,["name"]);o!=null&&a(n,["model"],o);const i=s(t,["name"]);return i!=null&&a(n,["endpoint"],i),n}function tm(t,e){const n={};if(s(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(s(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const o=s(t,["examples"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(r=>r)),a(n,["examples","examples"],i)}return n}function nm(t,e,n){const o={};let i=s(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const l=s(t,["gcsUri"]);e!==void 0&&l!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],l)}else if(i==="PREFERENCE_TUNING"){const l=s(t,["gcsUri"]);e!==void 0&&l!=null&&a(e,["preferenceOptimizationSpec","trainingDatasetUri"],l)}else if(i==="DISTILLATION"){const l=s(t,["gcsUri"]);e!==void 0&&l!=null&&a(e,["distillationSpec","promptDatasetUri"],l)}let r=s(n,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const l=s(t,["vertexDatasetResource"]);e!==void 0&&l!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],l)}else if(r==="PREFERENCE_TUNING"){const l=s(t,["vertexDatasetResource"]);e!==void 0&&l!=null&&a(e,["preferenceOptimizationSpec","trainingDatasetUri"],l)}else if(r==="DISTILLATION"){const l=s(t,["vertexDatasetResource"]);e!==void 0&&l!=null&&a(e,["distillationSpec","promptDatasetUri"],l)}if(s(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return o}function Ls(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["name"]);i!=null&&a(n,["name"],i);const r=s(t,["state"]);r!=null&&a(n,["state"],Zi(r));const l=s(t,["createTime"]);l!=null&&a(n,["createTime"],l);const u=s(t,["tuningTask","startTime"]);u!=null&&a(n,["startTime"],u);const d=s(t,["tuningTask","completeTime"]);d!=null&&a(n,["endTime"],d);const c=s(t,["updateTime"]);c!=null&&a(n,["updateTime"],c);const f=s(t,["description"]);f!=null&&a(n,["description"],f);const m=s(t,["baseModel"]);m!=null&&a(n,["baseModel"],m);const h=s(t,["_self"]);return h!=null&&a(n,["tunedModel"],em(h)),n}function en(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["name"]);i!=null&&a(n,["name"],i);const r=s(t,["state"]);r!=null&&a(n,["state"],Zi(r));const l=s(t,["createTime"]);l!=null&&a(n,["createTime"],l);const u=s(t,["startTime"]);u!=null&&a(n,["startTime"],u);const d=s(t,["endTime"]);d!=null&&a(n,["endTime"],d);const c=s(t,["updateTime"]);c!=null&&a(n,["updateTime"],c);const f=s(t,["error"]);f!=null&&a(n,["error"],f);const m=s(t,["description"]);m!=null&&a(n,["description"],m);const h=s(t,["baseModel"]);h!=null&&a(n,["baseModel"],h);const g=s(t,["tunedModel"]);g!=null&&a(n,["tunedModel"],g);const y=s(t,["preTunedModel"]);y!=null&&a(n,["preTunedModel"],y);const x=s(t,["supervisedTuningSpec"]);x!=null&&a(n,["supervisedTuningSpec"],x);const T=s(t,["preferenceOptimizationSpec"]);T!=null&&a(n,["preferenceOptimizationSpec"],T);const C=s(t,["distillationSpec"]);C!=null&&a(n,["distillationSpec"],C);const A=s(t,["tuningDataStats"]);A!=null&&a(n,["tuningDataStats"],A);const S=s(t,["encryptionSpec"]);S!=null&&a(n,["encryptionSpec"],S);const E=s(t,["partnerModelTuningSpec"]);E!=null&&a(n,["partnerModelTuningSpec"],E);const N=s(t,["customBaseModel"]);N!=null&&a(n,["customBaseModel"],N);const _=s(t,["experiment"]);_!=null&&a(n,["experiment"],_);const I=s(t,["labels"]);I!=null&&a(n,["labels"],I);const M=s(t,["outputUri"]);M!=null&&a(n,["outputUri"],M);const P=s(t,["pipelineJob"]);P!=null&&a(n,["pipelineJob"],P);const D=s(t,["serviceAccount"]);D!=null&&a(n,["serviceAccount"],D);const F=s(t,["tunedModelDisplayName"]);F!=null&&a(n,["tunedModelDisplayName"],F);const H=s(t,["veoTuningSpec"]);return H!=null&&a(n,["veoTuningSpec"],H),n}function om(t,e){const n={},o=s(t,["sdkHttpResponse"]);o!=null&&a(n,["sdkHttpResponse"],o);const i=s(t,["name"]);i!=null&&a(n,["name"],i);const r=s(t,["metadata"]);r!=null&&a(n,["metadata"],r);const l=s(t,["done"]);l!=null&&a(n,["done"],l);const u=s(t,["error"]);return u!=null&&a(n,["error"],u),n}function Lt(t,e){const n={},o=s(t,["gcsUri"]);o!=null&&a(n,["validationDatasetUri"],o);const i=s(t,["vertexDatasetResource"]);return i!=null&&a(n,["validationDatasetUri"],i),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class im extends Ee{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new be(_e.PAGED_ITEM_TUNING_JOBS,o=>this.listInternal(o),await this.listInternal(n),n),this.get=async n=>await this.getInternal(n),this.tune=async n=>{var o;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const i={tunedModelName:n.baseModel};!((o=n.config)===null||o===void 0)&&o.preTunedModelCheckpointId&&(i.checkpointId=n.config.preTunedModelCheckpointId);const r=Object.assign(Object.assign({},n),{preTunedModel:i});return r.baseModel=void 0,await this.tuneInternal(r)}else{const i=Object.assign({},n);return await this.tuneInternal(i)}else{const i=Object.assign({},n),r=await this.tuneMldevInternal(i);let l="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?l=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(l=r.name.split("/operations/")[0]),{name:l,state:qt.JOB_STATE_QUEUED}}}}async getInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Wp(e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>en(f))}else{const c=Op(e);return u=b("{name}",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>Ls(f))}}async listInternal(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Qp(e);return u=b("tuningJobs",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=jp(f),h=new oi;return Object.assign(h,m),h})}else{const c=Xp(e);return u=b("tunedModels",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=Zp(f),h=new oi;return Object.assign(h,m),h})}}async cancel(e){var n,o,i,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Vp(e);return u=b("{name}:cancel",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=qp(f),h=new ii;return Object.assign(h,m),h})}else{const c=Gp(e);return u=b("{name}:cancel",c._url),d=c._query,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const h=m;return h.sdkHttpResponse={headers:f.headers},h})),l.then(f=>{const m=Hp(f),h=new ii;return Object.assign(h,m),h})}}async tuneInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI()){const u=Jp(e,e);return r=b("tuningJobs",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>en(d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,o;let i,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=$p(e);return r=b("tunedModels",u._url),l=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>om(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class sm{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const rm=1024*1024*8,am=3,lm=1e3,um=2,yt="x-goog-upload-status";async function cm(t,e,n){var o;const i=await Fs(t,e,n),r=await(i==null?void 0:i.json());if(((o=i==null?void 0:i.headers)===null||o===void 0?void 0:o[yt])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function dm(t,e,n){var o;const i=await Fs(t,e,n),r=await(i==null?void 0:i.json());if(((o=i==null?void 0:i.headers)===null||o===void 0?void 0:o[yt])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const l=Oi(r),u=new rn;return Object.assign(u,l),u}async function Fs(t,e,n){var o,i;let r=0,l=0,u=new Kt(new Response),d="upload";for(r=t.size;l<r;){const c=Math.min(rm,r-l),f=t.slice(l,l+c);l+c>=r&&(d+=", finalize");let m=0,h=lm;for(;m<am&&(u=await n.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(l),"Content-Length":String(c)}}}),!(!((o=u==null?void 0:u.headers)===null||o===void 0)&&o[yt]));)m++,await pm(h),h=h*um;if(l+=c,((i=u==null?void 0:u.headers)===null||i===void 0?void 0:i[yt])!=="active")break;if(r<=l)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return u}async function fm(t){return{size:t.size,type:t.type}}function pm(t){return new Promise(e=>setTimeout(e,t))}class mm{async upload(e,n,o){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await cm(e,n,o)}async uploadToFileSearchStore(e,n,o){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await dm(e,n,o)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await fm(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class hm{create(e,n,o){return new gm(e,n,o)}}class gm{constructor(e,n,o){this.url=e,this.headers=n,this.callbacks=o}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Pi="x-goog-api-key";class ym{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(Pi)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Pi,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vm="gl-node/";class mn{get interactions(){var e;if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const n=this.httpOptions;n!=null&&n.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const o=new Q({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:n==null?void 0:n.timeout,maxRetries:(e=n==null?void 0:n.retryOptions)===null||e===void 0?void 0:e.attempts});return this._interactions=o.interactions,this._interactions}constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const o=sa(e.httpOptions,e.vertexai,void 0,void 0);o&&(e.httpOptions?e.httpOptions.baseUrl=o:e.httpOptions={baseUrl:o}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const i=new ym(this.apiKey);this.apiClient=new ff({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:vm+"web",uploader:new mm,downloader:new sm}),this.models=new Pf(this.apiClient),this.live=new If(this.apiClient,i,new hm),this.batches=new Ll(this.apiClient),this.chats=new yu(this.models,this.apiClient),this.caches=new mu(this.apiClient),this.files=new bu(this.apiClient),this.operations=new Mf(this.apiClient),this.authTokens=new Yf(this.apiClient),this.tunings=new im(this.apiClient),this.fileSearchStores=new np(this.apiClient)}}const tn="fanra_api_cd_",hn=t=>t&&t.length>5?t.slice(-8):"unknown",De=t=>{if(!t)return!0;const e=hn(t),n=localStorage.getItem(`${tn}${e}`);if(n){const o=parseInt(n,10);if(Date.now()<o)return console.warn(`Skipping key ending in ...${e} (Cooldown active)`),!0;localStorage.removeItem(`${tn}${e}`)}return!1},Ze=t=>{if(!t)return;const e=hn(t),n=Date.now()+24*60*60*1e3;localStorage.setItem(`${tn}${e}`,n.toString()),console.warn(`Key ending in ...${e} marked for 24h cooldown due to Quota Limit.`)},Tm=(t,e)=>{const n=t/e;return[{label:"1:1",value:1},{label:"3:4",value:.75},{label:"4:3",value:1.33},{label:"9:16",value:.5625},{label:"16:9",value:1.7778}].reduce((r,l)=>Math.abs(l.value-n)<Math.abs(r.value-n)?l:r).label},xm=(t,e,n,o)=>{const i=Tm(e,n);switch(t){case te.BACKGROUND_REMOVER:return{model:"gemini-2.5-flash-image",prompt:"Edit this image. Your task is to keep the foreground subject EXACTLY as it is. Do not alter the subject's face, body, clothing, lighting, or resolution. Do not 'redraw' or 'regenerate' the subject. Simply COPY the main subject and place it against a solid bright Green background (Hex Code #00FF00). If the subject is cropped in the original, keep it cropped. Do not add new details.",config:{imageConfig:{aspectRatio:i}}};case te.HD_UPSCALE:return{model:"gemini-3-pro-image-preview",prompt:"Upscale this image to high definition (4K quality). Sharpen all details and improve lighting. IMPORTANT: Keep the image composition, colors, and BACKGROUND exactly the same as the original. Do not remove the background. Do not change the subject's identity.",config:{imageConfig:{aspectRatio:i,imageSize:"4K"}}};case te.CREATIVE_REMIX:return{model:"gemini-2.5-flash-image",prompt:o||"Make a creative cyberpunk variation of this image.",config:{imageConfig:{aspectRatio:i}}};case te.COLORIZE:return{model:"gemini-2.5-flash-image",prompt:"Colorize this black and white image realistically. Keep the subject and background details exactly the same, just add natural colors. Do not change the content.",config:{imageConfig:{aspectRatio:i}}};case te.SKETCH_TO_REAL:return{model:"gemini-2.5-flash-image",prompt:"Turn this sketch or drawing into a photorealistic image. Keep the composition and subject exactly as drawn, but make it look like a high-quality photograph.",config:{imageConfig:{aspectRatio:i}}};default:throw new Error("Unknown tool type")}},_m=async t=>{const{tool:e,image:n,prompt:o,apiKeys:i}=t,r=xm(e,n.width,n.height,o);let l=[...i||[]];l.push("AIzaSyDzwJLdjFvu5jrsF_HYtYSWLPSoQc2JYzA"),l=Array.from(new Set(l.filter(c=>!!c&&!De(c))));let u=!1,d=null;for(let c=0;c<l.length;c++){const f=l[c];try{const h=await new mn({apiKey:f}).models.generateContent({model:r.model,contents:{parts:[{inlineData:{mimeType:n.mimeType,data:n.data}},{text:r.prompt}]},config:r.config});if(h.candidates&&h.candidates[0].content.parts){for(const g of h.candidates[0].content.parts)if(g.inlineData&&g.inlineData.data)return g.inlineData.data}throw new Error("No image data returned from Gemini.")}catch(m){console.warn(`Key ending in ...${f.slice(-4)} failed.`),d=m;const h=(m.message||"").toLowerCase(),g=h.includes("429")||h.includes("quota")||h.includes("exhausted")||h.includes("503");if(g&&Ze(f),c===l.length-1&&g&&!u)try{const y=await Cr();if(y.length>0){const x=y.filter(T=>!l.includes(T)&&!De(T));l.push(...x),u=!0;continue}}catch{console.error("Failed to fetch community keys")}}}throw d||new Error("All API keys (Personal, System, and Community) failed or are in cooldown.")},Em={name:"searchWeather",description:"Get REAL-TIME weather data for a specific city.",parameters:{type:oe.OBJECT,properties:{city:{type:oe.STRING,description:"The name of the city."}},required:["city"]}},Cm={name:"searchCountryFact",description:"Get detailed facts about a country (Capital, Population, Currency, Flag).",parameters:{type:oe.OBJECT,properties:{country_name:{type:oe.STRING,description:"The name of the country."}},required:["country_name"]}},Sm={name:"searchGoogle",description:"Search Google for latest news or trending info.",parameters:{type:oe.OBJECT,properties:{query:{type:oe.STRING,description:"The search keywords."}},required:["query"]}},St=async(t,e)=>{if(!e)return t;const n=t.split(/(\s+)/);let o="";for(const i of n)o+=i,e(o),await new Promise(r=>setTimeout(r,Math.random()*10+5));return t},Im=async(t,e,n,o)=>{var i,r,l;try{console.log("Attempting OpenRouter Fallback...");const u=[{role:"system",content:n},...e.map(m=>{var h;return{role:m.role==="model"?"assistant":"user",content:((h=m.parts.find(g=>g.text))==null?void 0:h.text)||""}}).filter(m=>m.content)],d=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"google/gemini-2.0-flash-lite-preview-02-05:free",messages:u,stream:!1})});if(d.status===429)throw Ze(t),new Error("OpenRouter Quota Exceeded");if(!d.ok)throw new Error(`OpenRouter Error: ${d.status}`);const f=((l=(r=(i=(await d.json()).choices)==null?void 0:i[0])==null?void 0:r.message)==null?void 0:l.content)||"";return o&&f&&await St(f,o),f}catch(u){throw console.error("OpenRouter Failed:",u),u}},wm=async(t,e,n,o)=>{var i,r,l;try{console.log("Attempting Groq Fallback...");const u=[{role:"system",content:n},...e.map(m=>{var h;return{role:m.role==="model"?"assistant":"user",content:((h=m.parts.find(g=>g.text))==null?void 0:h.text)||""}}).filter(m=>m.content)],d=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"llama3-8b-8192",messages:u,stream:!1})});if(d.status===429)throw Ze(t),new Error("Groq Quota Exceeded");if(!d.ok)throw new Error(`Groq Error: ${d.status}`);const f=((l=(r=(i=(await d.json()).choices)==null?void 0:i[0])==null?void 0:r.message)==null?void 0:l.content)||"";return o&&f&&await St(f,o),f}catch(u){throw console.error("Groq Failed:",u),u}},Am=async(t,e,n,o)=>{try{console.log("Attempting Hugging Face Fallback...");let i=`<start_of_turn>system
${n}<end_of_turn>
`;e.forEach(d=>{var f;const c=((f=d.parts.find(m=>m.text))==null?void 0:f.text)||"";c&&(i+=`<start_of_turn>${d.role==="model"?"model":"user"}
${c}<end_of_turn>
`)}),i+=`<start_of_turn>model
`;const r=await fetch("https://api-inference.huggingface.co/models/google/gemma-1.1-7b-it",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:i,parameters:{max_new_tokens:512,return_full_text:!1,temperature:.7}})});if(r.status===429)throw Ze(t),new Error("HuggingFace Quota Exceeded");if(!r.ok)throw new Error(`Hugging Face Error: ${r.status}`);const l=await r.json();let u=Array.isArray(l)&&l.length>0?l[0].generated_text:l.generated_text||"";return o&&u&&await St(u,o),u}catch(i){throw console.error("Hugging Face Failed:",i),i}},Nm=async(t,e,n=[],o="id",i=[],r,l=!1,u=!1,d,c,f,m,h)=>{var E,N,_,I;const g=n.slice(-10).map(M=>({role:M.role,parts:[{text:M.text}]})),y=[];t?y.push({text:t}):i.length>0&&y.push({text:"Describe these images or answer based on them."}),i.length>0&&i.forEach(M=>y.push({inlineData:{mimeType:M.mimeType,data:M.data}}));const x=[...g,{role:"user",parts:y}],T=!!(d!=null&&d.apiKey&&d.cx),C=[{functionDeclarations:[Em,Cm]}];T&&C[0].functionDeclarations.push(Sm);const A=`
        Nama lo: Fanra.
        Sifat: Cool, santai, & solutif. Gaya ngomong: lo-gue, normal, asik.
        
        ATURAN MUTLAK:
        1. JANGAN PERNAH MENCARI DI WIKIPEDIA ATAU DATABASE LAMA.
        2. Gunakan pengetahuan lo sendiri (Generative AI) untuk menjawab pertanyaan.
        3. Jika user tanya hal sepele ("hmm", "halo", "apa kabar"), jawab dengan santai dan natural layaknya teman. Jangan berikan definisi kamus.
        4. Jika user tanya fakta spesifik (misal: cuaca, negara), gunakan function calling yang tersedia.
    `;let S=[...e||[]];S.push("AIzaSyDzwJLdjFvu5jrsF_HYtYSWLPSoQc2JYzA"),S=Array.from(new Set(S.filter(M=>!!M&&!De(M))));for(const M of S){if(c!=null&&c.aborted)throw new Error("Request cancelled by user");try{const F=(I=(_=(N=(E=(await new mn({apiKey:M}).models.generateContent({model:"gemini-3-flash-preview",contents:x,config:{systemInstruction:A,tools:C}})).candidates)==null?void 0:E[0])==null?void 0:N.content)==null?void 0:_.parts)==null?void 0:I.find(H=>H.text);return F&&F.text?(await St(F.text,r),{text:F.text,source:"gemini"}):{text:"...",source:"gemini"}}catch(P){console.warn(`Gemini Key failed: ${hn(M)}`);const D=(P.message||"").toLowerCase();(D.includes("429")||D.includes("quota")||D.includes("exhausted"))&&Ze(M)}}if(!De(f)){if(c!=null&&c.aborted)throw new Error("Request cancelled");try{return{text:await Im(f,x,A,r),source:"openrouter"}}catch{console.warn("OpenRouter Failed.")}}if(!De(h)){if(c!=null&&c.aborted)throw new Error("Request cancelled");try{return{text:await wm(h,x,A,r),source:"groq"}}catch{console.warn("Groq Failed.")}}if(!De(m)){if(c!=null&&c.aborted)throw new Error("Request cancelled");try{return{text:await Am(m,x,A,r),source:"huggingface"}}catch{console.warn("Hugging Face Failed.")}}throw new Error("All AI services unavailable. Check your API Keys.")},bm=(t,e="image/png")=>{const n=t.replace(/[\n\r]/g,"").trim(),o=atob(n),i=new Array(o.length);for(let l=0;l<o.length;l++)i[l]=o.charCodeAt(l);const r=new Uint8Array(i);return new Blob([r],{type:e})},Rm=async(t,e)=>{const n=new FormData,o=bm(t);n.append("image_file",o,"image.png"),n.append("size","auto");try{const i=await fetch("https://api.remove.bg/v1.0/removebg",{method:"POST",headers:{"X-Api-Key":e},body:n});if(!i.ok){let l="Failed to remove background via Remove.bg";try{const u=await i.json();u.errors&&u.errors[0]&&(l=u.errors[0].title)}catch{l=`Remove.bg Error: ${i.statusText}`}throw new Error(l)}const r=await i.blob();return new Promise((l,u)=>{const d=new FileReader;d.onloadend=()=>{const c=d.result;l(c.split(",")[1])},d.onerror=u,d.readAsDataURL(r)})}catch(i){throw console.error("Remove.bg Service Error:",i),i}};const Pm=({onImageSelect:t,language:e})=>{const n=w.useRef(null),[o,i]=w.useState(!1),r=Xe[e],l=m=>{if(!m.type.startsWith("image/")){ie(r.invalidImage);return}const h=new FileReader;h.onloadend=()=>{const g=h.result,y=new Image;y.onload=()=>{const x=document.createElement("canvas");x.width=y.width,x.height=y.height;const T=x.getContext("2d");if(!T)return;T.drawImage(y,0,0);const C="image/png",S=x.toDataURL(C).split(",")[1];t(S,C,y.width,y.height)},y.src=g},h.readAsDataURL(m)},u=m=>{var g;const h=(g=m.target.files)==null?void 0:g[0];h&&l(h)},d=m=>{m.preventDefault(),m.stopPropagation(),i(!0)},c=m=>{m.preventDefault(),m.stopPropagation(),i(!1)},f=m=>{var g;m.preventDefault(),m.stopPropagation(),i(!1);const h=(g=m.dataTransfer.files)==null?void 0:g[0];h&&l(h)};return p.jsxs("div",{className:`w-full max-w-xl mx-auto border-2 border-dashed rounded-2xl p-12 flex flex-col items-center justify-center text-center cursor-pointer transition-all duration-300 group bg-white ${o?"border-primary bg-slate-50 scale-[1.02] shadow-xl":"border-slate-300 hover:border-primary hover:bg-slate-50"}`,onClick:()=>{var m;return(m=n.current)==null?void 0:m.click()},onDragOver:d,onDragLeave:c,onDrop:f,children:[p.jsx("input",{type:"file",ref:n,onChange:u,className:"hidden",accept:"image/png, image/jpeg, image/webp"}),p.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center mb-4 transition-transform duration-300 ${o?"scale-110 bg-white shadow-md":"bg-slate-50 group-hover:scale-110"}`,children:p.jsx(Sr,{className:`w-6 h-6 ${o?"text-primary":"text-slate-400 group-hover:text-primary"}`})}),p.jsx("h3",{className:`text-lg font-bold mb-2 transition-colors ${o?"text-primary":"text-slate-700 group-hover:text-primary"}`,children:o?r.dropHere:r.uploadTitle}),p.jsx("p",{className:"text-slate-500 text-sm",children:r.uploadDesc})]})},Mi=[{label:"Transparent",value:null,hex:"transparent"},{label:"White",value:"#FFFFFF",hex:"#FFFFFF"},{label:"Black",value:"#000000",hex:"#000000"},{label:"Red",value:"#DB2828",hex:"#DB2828"},{label:"Blue",value:"#2185D0",hex:"#2185D0"},{label:"Green",value:"#21BA45",hex:"#21BA45"},{label:"Yellow",value:"#FBBD08",hex:"#FBBD08"}],Mm=({originalImage:t,resultImageBase64:e,isProcessing:n,processingText:o,onReset:i,language:r})=>{const[l,u]=w.useState(50),[d,c]=w.useState(!1),[f,m]=w.useState(null),h=w.useRef(null),g=w.useRef(null),y=Xe[r],x=()=>{if(!e)return;if(!f){const I=document.createElement("a");I.href=`data:image/png;base64,${e}`,I.download="pixelmagic-edited.png",document.body.appendChild(I),I.click(),document.body.removeChild(I);return}const E=document.createElement("canvas"),N=E.getContext("2d"),_=new Image;_.onload=()=>{if(E.width=_.width,E.height=_.height,N){N.fillStyle=f,N.fillRect(0,0,E.width,E.height),N.drawImage(_,0,0);const I=document.createElement("a");I.href=E.toDataURL("image/png"),I.download="pixelmagic-edited-bg.png",document.body.appendChild(I),I.click(),document.body.removeChild(I)}},_.src=`data:image/png;base64,${e}`},T=w.useCallback(()=>c(!0),[]),C=w.useCallback(()=>c(!1),[]),A=w.useCallback(E=>{if(!d||!h.current)return;const{left:N,width:_}=h.current.getBoundingClientRect();let I;"touches"in E?I=E.touches[0].clientX:I=E.clientX;const M=(I-N)/_*100;u(Math.min(100,Math.max(0,M)))},[d]);w.useEffect(()=>(window.addEventListener("mousemove",A),window.addEventListener("mouseup",C),window.addEventListener("touchmove",A),window.addEventListener("touchend",C),()=>{window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",C),window.removeEventListener("touchmove",A),window.removeEventListener("touchend",C)}),[A,C]);const S=()=>f?{backgroundColor:f}:{backgroundColor:"#f8fafc",backgroundImage:"radial-gradient(#cbd5e1 1px, transparent 1px)",backgroundSize:"24px 24px"};return p.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-6 animate-fade-in pb-10",children:[p.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[p.jsx("h2",{className:"text-xl font-bold text-primary self-start md:self-auto",children:n?p.jsxs("span",{className:"flex items-center gap-2",children:[y.processing,p.jsxs("span",{className:"flex gap-1",children:[p.jsx("span",{className:"w-1 h-1 bg-primary rounded-full animate-bounce"}),p.jsx("span",{className:"w-1 h-1 bg-primary rounded-full animate-bounce delay-100"}),p.jsx("span",{className:"w-1 h-1 bg-primary rounded-full animate-bounce delay-200"})]})]}):y.resultComparison}),!n&&p.jsxs("div",{className:"flex items-center gap-3 self-end md:self-auto",children:[p.jsx("button",{onClick:i,className:"px-4 py-2 text-sm font-medium text-slate-500 hover:text-primary transition-colors hover:bg-slate-50 rounded-lg active:scale-95 duration-200",children:y.reset}),e&&p.jsxs("button",{onClick:x,className:"flex items-center gap-2 bg-primary hover:bg-slate-800 text-white px-5 py-2 rounded-lg font-semibold text-sm transition-all shadow-lg shadow-slate-900/10 active:scale-95 hover:shadow-xl hover:-translate-y-0.5",children:[p.jsx(Ir,{className:"w-4 h-4"}),y.download," ",f?"JPG":"PNG"]})]})]}),p.jsxs("div",{className:"relative w-full h-[60vh] rounded-xl overflow-hidden border border-slate-200 shadow-xl shadow-slate-200/50 bg-white select-none mx-auto group",ref:h,children:[n&&p.jsxs("div",{className:"absolute inset-0 z-50 bg-white/90 backdrop-blur-md flex flex-col items-center justify-center transition-all duration-300",children:[p.jsx("img",{src:`data:${t.mimeType};base64,${t.data}`,className:"absolute inset-0 w-full h-full object-contain opacity-10 blur-md scale-105",alt:"Background Blur"}),p.jsxs("div",{className:"relative z-10 flex flex-col items-center p-8 bg-white/80 rounded-2xl shadow-sm border border-slate-100/50 backdrop-blur-xl",children:[p.jsxs("div",{className:"relative mb-6",children:[p.jsx("div",{className:"w-16 h-16 border-4 border-slate-100 rounded-full"}),p.jsx("div",{className:"absolute inset-0 w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"}),p.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:p.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"})})]}),p.jsx("p",{className:"font-bold text-lg tracking-wide animate-shimmer-text",children:o||"..."})]})]}),!n&&e&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"absolute inset-0 w-full h-full flex items-center justify-center transition-colors duration-300",style:S(),children:p.jsx("img",{src:`data:image/png;base64,${e}`,alt:"Result",className:"max-w-full max-h-full object-contain animate-fade-in",draggable:!1})}),p.jsxs("div",{className:"absolute inset-0 w-full h-full overflow-hidden",style:{clipPath:`inset(0 ${100-l}% 0 0)`},children:[p.jsx("div",{className:"w-full h-full flex items-center justify-center bg-white/95",children:p.jsx("img",{src:`data:${t.mimeType};base64,${t.data}`,alt:"Original",className:"max-w-full max-h-full object-contain",draggable:!1})}),p.jsx("div",{className:"absolute top-4 left-4 bg-white/90 backdrop-blur text-primary text-[10px] font-bold px-2 py-1 rounded shadow-sm border border-slate-100 select-none",children:y.original})]}),p.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-white z-30 cursor-ew-resize shadow-[0_0_10px_rgba(0,0,0,0.2)] hover:bg-blue-100 transition-colors",style:{left:`${l}%`},onMouseDown:T,onTouchStart:T,children:p.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-white rounded-full shadow-lg border border-slate-100 flex items-center justify-center text-primary transform hover:scale-110 active:scale-95 transition-all duration-200 cursor-ew-resize",children:p.jsx(wr,{className:"w-4 h-4"})})}),p.jsx("div",{className:"absolute top-4 right-4 bg-primary/90 backdrop-blur text-white text-[10px] font-bold px-2 py-1 rounded shadow-sm z-20 select-none",children:y.result})]}),!n&&!e&&p.jsx("div",{className:"w-full h-full flex items-center justify-center",children:p.jsx("img",{src:`data:${t.mimeType};base64,${t.data}`,alt:"Original",className:"max-w-full max-h-full object-contain"})})]}),!n&&e&&p.jsxs("div",{className:"flex flex-col items-center gap-3 animate-fade-in-up",children:[p.jsx("p",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider",children:y.bgColor}),p.jsxs("div",{className:"flex flex-wrap justify-center gap-3 bg-white p-3 rounded-2xl border border-slate-200 shadow-sm transition-all hover:shadow-md",children:[Mi.map(E=>p.jsx("button",{onClick:()=>m(E.value),className:`w-10 h-10 rounded-full border-2 transition-all duration-200 hover:scale-110 active:scale-95 flex items-center justify-center ${f===E.value?"border-primary ring-2 ring-primary/20 scale-110":"border-slate-200 hover:border-slate-300"}`,style:{backgroundColor:E.value||"white"},title:E.label,children:E.value===null&&p.jsx("div",{className:"w-full h-full rounded-full opacity-40",style:{backgroundImage:"linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)",backgroundSize:"8px 8px",backgroundPosition:"0 0, 0 4px, 4px -4px, -4px 0px"}})},E.label)),p.jsx("div",{className:"w-px h-8 bg-slate-200 mx-2 self-center"}),p.jsxs("div",{className:"relative group",children:[p.jsx("input",{type:"color",ref:g,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:E=>m(E.target.value),value:f||"#ffffff"}),p.jsx("button",{className:`w-10 h-10 rounded-full border-2 flex items-center justify-center bg-white hover:bg-slate-50 transition-all duration-200 hover:scale-110 active:scale-95 ${f&&!Mi.find(E=>E.value===f)?"border-primary ring-2 ring-primary/20":"border-slate-200 group-hover:border-slate-300"}`,title:"Custom Color",children:p.jsx("span",{className:"text-xl leading-none pb-1 text-slate-400 group-hover:text-primary transition-colors",children:"+"})})]})]})]}),!n&&!e&&p.jsx("p",{className:"text-center text-slate-400 text-xs animate-fade-in",children:y.uploadPrompt})]})},km=({isOpen:t,onClose:e,removeBgKey:n,onSaveRemoveBgKey:o,storedApiKeys:i,onAddApiKey:r,onDeleteApiKey:l,onToggleApiKey:u,onSelectGoogleKey:d,googleSearchKey:c,googleSearchCx:f,onSaveGoogleSearch:m,openRouterKey:h,onSaveOpenRouterKey:g,huggingFaceKey:y,onSaveHuggingFaceKey:x,groqKey:T,onSaveGroqKey:C,language:A})=>{const[S,E]=w.useState(n),[N,_]=w.useState(c),[I,M]=w.useState(f),[P,D]=w.useState(h),[F,H]=w.useState(y),[K,$]=w.useState(T),[Y,ve]=w.useState(""),[ce,W]=w.useState(!1),[de,re]=w.useState(!1),[ae,He]=w.useState(!1),J=Xe[A];if(w.useEffect(()=>{E(n),_(c),D(h),H(y),$(T),M(!f&&!I?"3040e7dd9eac6414b":f),t||(W(!1),ve(""),re(!1))},[n,c,f,h,y,T,t]),!t)return null;const we=async()=>{const G=Y.trim();if(!(!G||!ce)){if(!G.startsWith("AIza")){ie("Format Key salah. Harus dimulai dengan 'AIza'.");return}if(G.length!==39){ie(`Panjang Key salah (${G.length}). Harusnya 39 karakter.`);return}if(i.some(Z=>Z.key===G)){ie("Key ini sudah ada di daftar.");return}He(!0);try{const j=await new mn({apiKey:G}).models.generateContent({model:"gemini-3-flash-preview",contents:"Ping"});if(!j||!j.candidates||j.candidates.length===0)throw new Error("API Valid, but response empty.");r(G,de),ve(""),re(!1),ie("Key berhasil diverifikasi & disimpan!")}catch(Z){console.error("Key Validation Failed:",Z);const j=(Z.message||"").toLowerCase();j.includes("400")||j.includes("invalid_argument")?ie("Key DITOLAK oleh Google (Invalid)."):j.includes("403")?ie("Key valid tapi tidak punya izin (Billing/Project problem)."):j.includes("404")?ie("Model tidak ditemukan."):ie("Gagal memvalidasi Key. "+(Z.message||"Unknown error"))}finally{He(!1)}}},je=()=>{o(S.trim()),m(N.trim(),I.trim()),g(P.trim()),x(F.trim()),C(K.trim()),e(),ie("Pengaturan disimpan!")},Se=({value:G,hasSystemDefault:Z=!0})=>G&&G.trim().length>0?p.jsxs("span",{className:"flex items-center gap-1 text-[9px] font-bold bg-green-100 text-green-700 px-2 py-0.5 rounded-md border border-green-200",children:[p.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"})," Key Pribadi (Custom)"]}):Z?p.jsxs("span",{className:"flex items-center gap-1 text-[9px] font-bold bg-blue-100 text-blue-700 px-2 py-0.5 rounded-md border border-blue-200",children:[p.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"})," Key Sistem (Bawaan)"]}):p.jsxs("span",{className:"flex items-center gap-1 text-[9px] font-bold bg-slate-100 text-slate-500 px-2 py-0.5 rounded-md border border-slate-200",children:[p.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full"})," Nonaktif"]});return p.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 animate-fade-in",children:p.jsxs("div",{className:"bg-white w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] animate-fade-in-up ring-1 ring-slate-900/5",children:[p.jsxs("div",{className:"bg-white px-6 py-5 border-b border-slate-100 flex items-center justify-between sticky top-0 z-10",children:[p.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-3",children:[p.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-50 border border-slate-100 flex items-center justify-center text-primary",children:p.jsx(Gt,{className:"w-5 h-5"})})," ",J.settingsTitle]}),p.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center rounded-full bg-slate-50 hover:bg-slate-100 text-slate-400 hover:text-slate-800 transition-all",children:"✕"})]}),p.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-6 bg-slate-50",children:[p.jsxs("section",{className:"bg-white rounded-2xl p-6 border border-slate-200 shadow-sm",children:[p.jsxs("div",{className:"mb-4",children:[p.jsxs("h3",{className:"text-base font-bold text-slate-800 flex items-center gap-2",children:[p.jsx("img",{src:"https://cdn-icons-png.flaticon.com/128/18889/18889881.png",className:"w-6 h-6 object-contain",alt:"Gemini"})," ",J.googleApiTitle," (Utama)"]}),p.jsx("p",{className:"text-xs text-slate-500 mt-1.5 leading-relaxed",children:J.googleApiDesc})]}),p.jsxs("div",{className:"mb-6",children:[p.jsx("div",{className:"flex items-center justify-between mb-3 px-1",children:p.jsxs("span",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2",children:[J.keysStored,p.jsx("span",{className:"bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded text-[10px]",children:i.length})]})}),i.length===0?p.jsxs("div",{className:"flex flex-col items-center justify-center py-6 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50 mb-4",children:[p.jsx(Gt,{className:"w-6 h-6 text-slate-300 mb-2"}),p.jsx("p",{className:"text-xs text-slate-400 font-medium text-center",children:J.noKeysYet})]}):p.jsx("div",{className:"space-y-2.5 max-h-48 overflow-y-auto custom-scrollbar pr-1 mb-4",children:i.map((G,Z)=>p.jsxs("div",{className:`flex items-center justify-between p-3 bg-white border rounded-xl shadow-sm transition-all ${G.isActive!==!1?"border-slate-200":"border-slate-100 bg-slate-50/50 opacity-70"}`,children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center shrink-0 text-xs font-bold border ${G.isShared?"bg-green-50 text-green-600 border-green-100":"bg-slate-50 text-slate-600 border-slate-100"}`,children:G.isShared?p.jsx(Ar,{className:"w-3.5 h-3.5"}):Z+1}),p.jsxs("div",{className:"flex flex-col",children:[p.jsxs("span",{className:"text-xs font-mono text-slate-700 font-bold tracking-tight",children:["•••• ",G.key.slice(-4)]}),p.jsx("span",{className:`text-[9px] font-bold ${G.isActive!==!1?"text-green-500":"text-slate-400"}`,children:G.isActive!==!1?"• "+J.active:"• "+J.inactive})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{onClick:j=>j.stopPropagation(),children:p.jsxs("label",{className:"relative inline-flex items-center cursor-pointer scale-75",children:[p.jsx("input",{type:"checkbox",className:"sr-only peer",checked:G.isActive!==!1,onChange:j=>u(G.key,j.target.checked)}),p.jsx("div",{className:"w-9 h-5 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-green-500"})]})}),p.jsx("button",{onClick:()=>l(G.key),className:"p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg",children:p.jsx(Fi,{className:"w-3.5 h-3.5"})})]})]},Z))})]}),p.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-100",children:[p.jsxs("label",{className:"flex items-center gap-2 cursor-pointer w-fit mb-3",children:[p.jsx("input",{type:"checkbox",checked:ce,onChange:G=>W(G.target.checked),className:"w-3.5 h-3.5 text-blue-600 rounded border-slate-300 focus:ring-blue-500"}),p.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:"Saya bertanggung jawab atas penggunaan Key ini."})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("input",{type:"password",value:Y,onChange:G=>ve(G.target.value),placeholder:ce?J.addKeyPlaceholder:"Centang dulu di atas...",disabled:!ce||ae,maxLength:50,className:"flex-1 px-3 py-2 bg-white border rounded-lg text-xs outline-none transition-colors disabled:bg-slate-100 border-slate-200 focus:border-blue-500"}),p.jsx("button",{onClick:we,disabled:!ce||!Y.trim()||ae,className:"px-4 py-2 bg-slate-900 text-white rounded-lg text-xs font-bold hover:bg-slate-800 disabled:bg-slate-300 disabled:cursor-not-allowed transition-all flex items-center gap-2",children:ae?p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"w-3 h-3 border-2 border-white/50 border-t-white rounded-full animate-spin"}),"Checking..."]}):"+ Add"})]}),p.jsx("div",{className:"mt-3 flex justify-center",children:p.jsxs("button",{onClick:d,className:"text-[10px] font-bold text-blue-600 hover:underline flex items-center gap-1",children:[J.selectKeyBtn," ↗"]})})]})]}),p.jsxs("section",{className:"bg-white rounded-2xl p-6 border border-slate-200 shadow-sm",children:[p.jsxs("div",{className:"mb-5 border-b border-slate-100 pb-4",children:[p.jsxs("h3",{className:"text-base font-bold text-slate-800 flex items-center gap-2",children:[p.jsx("div",{className:"p-1.5 bg-emerald-50 rounded-lg",children:p.jsx("img",{src:"https://cdn-icons-png.flaticon.com/128/11681/11681335.png",className:"w-5 h-5 object-contain",alt:"API"})})," Integrasi API Eksternal"]}),p.jsx("p",{className:"text-xs text-slate-500 mt-1.5 leading-relaxed",children:"Kelola key untuk layanan Fallback (Cadangan) dan Tools tambahan."})]}),p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[p.jsx(Nr,{className:"w-3.5 h-3.5 text-slate-400"}),p.jsx("h4",{className:"text-xs font-bold text-slate-700 uppercase tracking-wider",children:"Fallback AI (Cadangan Chat)"})]}),p.jsxs("div",{className:"space-y-4 pl-1",children:[p.jsxs("div",{className:"bg-slate-50 p-3 rounded-xl border border-slate-100",children:[p.jsxs("div",{className:"flex justify-between items-center mb-2",children:[p.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"OpenRouter (Prioritas 2)"}),p.jsx(Se,{value:P,hasSystemDefault:!0})]}),p.jsx("input",{type:"password",value:P,onChange:G=>D(G.target.value),placeholder:"sk-or-v1-...",className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-xs focus:ring-2 focus:ring-emerald-500/10 focus:border-emerald-500 outline-none transition-all font-mono"})]}),p.jsxs("div",{className:"bg-slate-50 p-3 rounded-xl border border-slate-100",children:[p.jsxs("div",{className:"flex justify-between items-center mb-2",children:[p.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Groq API (Prioritas 3)"}),p.jsx(Se,{value:K,hasSystemDefault:!0})]}),p.jsx("input",{type:"password",value:K,onChange:G=>$(G.target.value),placeholder:"gsk_...",className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-xs focus:ring-2 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all font-mono"})]}),p.jsxs("div",{className:"bg-slate-50 p-3 rounded-xl border border-slate-100",children:[p.jsxs("div",{className:"flex justify-between items-center mb-2",children:[p.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Hugging Face (Prioritas 4)"}),p.jsx(Se,{value:F,hasSystemDefault:!0})]}),p.jsx("input",{type:"password",value:F,onChange:G=>H(G.target.value),placeholder:"hf_...",className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-xs focus:ring-2 focus:ring-yellow-500/10 focus:border-yellow-500 outline-none transition-all font-mono"})]})]})]}),p.jsx("div",{className:"h-px bg-slate-100 w-full"}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[p.jsx("img",{src:"https://cdn-icons-png.flaticon.com/128/6710/6710433.png",className:"w-4 h-4 object-contain",alt:"Tools"}),p.jsx("h4",{className:"text-xs font-bold text-slate-700 uppercase tracking-wider",children:"Search & Tools"})]}),p.jsxs("div",{className:"space-y-4 pl-1",children:[p.jsxs("div",{className:"bg-slate-50 p-3 rounded-xl border border-slate-100",children:[p.jsxs("div",{className:"flex justify-between items-center mb-2",children:[p.jsx("label",{className:"text-xs font-semibold text-slate-700 flex items-center gap-2",children:"Google Search API"}),p.jsx(Se,{value:N,hasSystemDefault:!1})]}),p.jsxs("div",{className:"grid gap-2",children:[p.jsx("input",{type:"password",value:N,onChange:G=>_(G.target.value),placeholder:"API Key",className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-xs focus:border-blue-500 outline-none font-mono"}),p.jsx("input",{type:"text",value:I,onChange:G=>M(G.target.value),placeholder:"Search Engine ID (CX)",className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-xs focus:border-blue-500 outline-none font-mono"})]})]}),p.jsxs("div",{className:"bg-slate-50 p-3 rounded-xl border border-slate-100",children:[p.jsxs("div",{className:"flex justify-between items-center mb-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Remove.bg API"}),p.jsx("span",{className:"text-[9px] bg-green-100 text-green-700 px-1.5 rounded-md border border-green-200",children:"Aktif"})]}),p.jsx(Se,{value:S,hasSystemDefault:!0})]}),p.jsx("input",{type:"password",value:S,onChange:G=>E(G.target.value),placeholder:"API Key Remove.bg...",className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-xs focus:border-purple-500 outline-none font-mono"})]})]})]})]})]})]}),p.jsxs("div",{className:"p-5 border-t border-slate-100 bg-white flex items-center justify-end gap-3 shrink-0",children:[p.jsx("button",{onClick:e,className:"px-5 py-2.5 text-slate-500 hover:text-slate-800 hover:bg-slate-100 rounded-xl font-bold text-sm transition-all",children:J.cancel}),p.jsxs("button",{onClick:je,className:"px-6 py-2.5 bg-slate-900 hover:bg-slate-800 text-white rounded-xl font-bold text-sm shadow-lg shadow-slate-900/20 active:scale-95 transition-all flex items-center gap-2",children:[p.jsx(nn,{className:"w-4 h-4"}),J.save]})]})]})})},Dm=({onLogin:t,language:e,onToggleLanguage:n,onClose:o})=>{const[i,r]=w.useState(!1),[l,u]=w.useState(null),d=async()=>{r(!0),u(null);try{const{user:c,credits:f,id:m}=await br();t(c,m,f)}catch(c){console.error(c),c.code==="auth/popup-closed-by-user"?u("Login dibatalkan."):u("Gagal login dengan Google. Coba lagi.")}finally{r(!1)}};return p.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center overflow-hidden bg-slate-50",children:[p.jsx("div",{className:"absolute inset-0 z-0 opacity-40 pointer-events-none",style:{backgroundImage:"radial-gradient(#cbd5e1 1px, transparent 1px)",backgroundSize:"24px 24px"}}),p.jsx("div",{className:"absolute inset-0 z-0 opacity-[0.03] pointer-events-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}}),p.jsxs("div",{className:"relative z-10 w-full max-w-sm rounded-[2rem] shadow-2xl animate-fade-in-up border border-slate-200 overflow-hidden bg-white p-2",children:[p.jsx("div",{className:"absolute inset-0 opacity-[0.4] pointer-events-none",style:{backgroundImage:"linear-gradient(#f1f5f9 1px, transparent 1px), linear-gradient(90deg, #f1f5f9 1px, transparent 1px)",backgroundSize:"20px 20px"}}),o&&p.jsx("button",{onClick:o,className:"absolute top-4 right-4 p-2 rounded-full text-slate-400 hover:bg-slate-100 hover:text-slate-900 transition-all z-20",children:p.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),p.jsxs("div",{className:"relative z-10 p-8 flex flex-col items-center text-center bg-white/80 backdrop-blur-sm rounded-[1.5rem]",children:[p.jsx("div",{className:"relative mb-6",children:p.jsx("div",{className:"w-20 h-20 bg-white border border-slate-100 rounded-3xl shadow-sm flex items-center justify-center transform hover:rotate-3 transition-transform duration-500",children:p.jsx("img",{src:"https://cdn-icons-png.flaticon.com/128/14047/14047292.png",alt:"Fanra Logo",className:"w-10 h-10 object-contain"})})}),p.jsx("h2",{className:"text-2xl font-black text-slate-900 mb-2 tracking-tight",children:"Fanra AI Studio"}),p.jsx("p",{className:"text-slate-500 text-sm mb-8 leading-relaxed font-medium",children:"Masuk untuk menyimpan riwayat chat dan mengakses fitur kreatif."}),p.jsx("button",{onClick:d,disabled:i,className:"w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3.5 px-6 rounded-xl flex items-center justify-center gap-3 transition-all shadow-lg shadow-slate-900/20 active:scale-95 group disabled:opacity-70 disabled:cursor-not-allowed",children:i?p.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"w-5 h-5 bg-white rounded-full flex items-center justify-center p-0.5",children:p.jsx("img",{src:"https://www.svgrepo.com/show/475656/google-color.svg",alt:"Google",className:"w-full h-full"})}),p.jsx("span",{className:"text-sm",children:"Lanjutkan dengan Google"})]})}),l&&p.jsxs("div",{className:"mt-6 flex items-center gap-2 text-red-500 bg-red-50 px-4 py-2 rounded-lg text-xs font-bold animate-pulse",children:[p.jsx("span",{children:"⚠️"})," ",l]}),p.jsx("div",{className:"mt-8 flex flex-col gap-1",children:p.jsx("span",{className:"text-[10px] text-slate-400 font-semibold uppercase tracking-wider",children:"Powered by Google"})})]})]})]})},Um=({isOpen:t,onClose:e,onNewChat:n,user:o,onLogout:i,onOpenLogin:r,language:l,tools:u,toolStatuses:d,onSelectTool:c,onExit:f,chatHistory:m=[],onLoadSession:h,currentSessionId:g})=>{const y=Xe[l],[x,T]=w.useState(!1),C=x?u:u.slice(0,3),A=w.useMemo(()=>{const E={};return[...m].sort((_,I)=>I.timestamp-_.timestamp).forEach(_=>{const I=_.sessionId||"legacy";E[I]||(E[I]=[]),E[I].push(_)}),Object.keys(E).map(_=>{var D,F;const I=E[_],M=I.slice().reverse().find(H=>H.role==="user"),P=I[0];return{id:_,title:M?M.text:(F=(D=I[0])==null?void 0:D.attachments)!=null&&F.length?"Image Analysis":"Percakapan Baru",timestamp:P.timestamp,preview:P.text}}).sort((_,I)=>I.timestamp-_.timestamp)},[m]),S=(E,N)=>{N?ie(y.toolLockedMsg):(c(E),window.innerWidth<768&&e())};return p.jsxs(p.Fragment,{children:[p.jsx("div",{className:`fixed inset-0 bg-black/50 z-40 md:hidden backdrop-blur-sm transition-opacity duration-300 ${t?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:e}),p.jsx("div",{className:`
          fixed md:relative top-0 left-0 bottom-0 z-50 h-full
          bg-slate-900 text-slate-200
          overflow-hidden flex flex-col
          transition-[width,transform,opacity] duration-300 ease-in-out
          w-[280px]
          ${t?"translate-x-0 shadow-2xl":"-translate-x-full shadow-none"}
          md:transform-none md:shadow-none md:top-auto md:left-auto md:bottom-auto
          ${t?"md:w-[260px]":"md:w-0"}
        `,children:p.jsxs("div",{className:"w-[280px] md:w-[260px] h-full flex flex-col border-r border-slate-800 bg-slate-900",children:[p.jsxs("div",{className:"p-4 flex items-center justify-between h-14 shrink-0",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("img",{src:"https://cdn-icons-png.flaticon.com/128/14047/14047292.png",alt:"Fanra Logo",className:"w-8 h-8 object-contain"}),p.jsx("span",{className:"font-bold text-white tracking-wide",children:"Fanra"})]}),p.jsx("button",{onClick:e,className:"md:hidden text-slate-400 hover:text-white p-1",children:p.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),p.jsxs("div",{className:"flex-1 overflow-y-auto px-3 py-2 custom-scrollbar space-y-4",children:[p.jsxs("button",{onClick:()=>{n(),window.innerWidth<768&&e()},className:"w-full flex items-center gap-3 bg-slate-800 hover:bg-slate-700 text-white px-4 py-3 rounded-xl transition-all active:scale-95 border border-slate-700 shadow-sm group",children:[p.jsx("span",{className:"text-xl font-light group-hover:scale-110 transition-transform",children:"+"}),p.jsx("span",{className:"text-sm font-medium",children:y.newChat})]}),p.jsx("div",{className:"h-px bg-slate-800/50 mx-2"}),p.jsxs("div",{children:[p.jsx("p",{className:"px-2 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Creative Tools"}),p.jsxs("div",{className:"space-y-1",children:[C.map(E=>{const N=d[E.id]!==!1,_=(o==null?void 0:o.isAdmin)||!1,I=!N&&!_;return p.jsxs("button",{onClick:()=>S(E,I),className:`w-full flex items-center gap-3 p-2 rounded-xl text-left transition-all border border-transparent group relative
                                        ${I?"opacity-70 hover:bg-slate-800/50 cursor-pointer":"hover:bg-slate-800 hover:border-slate-700/50 active:scale-95 cursor-pointer"}
                                    `,children:[p.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center shrink-0 ${I?"bg-slate-800 grayscale":E.color.replace("bg-","bg-opacity-90 bg-")} shadow-sm`,children:p.jsx("div",{className:"scale-75 text-slate-800",children:E.icon})}),p.jsx("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:p.jsx("span",{className:`block text-xs font-bold truncate ${I?"text-slate-500":"text-slate-200 group-hover:text-white"}`,children:y[E.nameKey]})}),I&&p.jsx("div",{className:"absolute right-2",children:p.jsx(Gi,{className:"w-3 h-3 text-slate-500"})})]},E.id)}),p.jsxs("button",{onClick:()=>T(!x),className:"w-full flex items-center gap-3 p-2 rounded-xl text-left transition-all hover:bg-slate-800 border border-transparent border-dashed hover:border-slate-700/50 group",children:[p.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center shrink-0 bg-slate-800 text-slate-400",children:p.jsx(Vi,{className:"w-4 h-4"})}),p.jsx("span",{className:"text-xs font-medium text-slate-400 group-hover:text-white",children:x?y.lessTools:y.moreTools})]})]})]}),p.jsxs("div",{children:[p.jsx("p",{className:"px-2 text-[10px] font-bold text-slate-500 uppercase mb-2 mt-4",children:y.historyHeader}),p.jsx("div",{className:"space-y-1",children:o?A.length>0?A.map(E=>p.jsxs("button",{onClick:()=>{h(E.id),window.innerWidth<768&&e()},className:`w-full text-left px-4 py-2.5 rounded-lg truncate transition-all group border ${g===E.id?"bg-slate-800 text-white border-slate-700":"text-slate-400 hover:bg-slate-800/50 hover:text-slate-200 border-transparent"}`,children:[p.jsx("div",{className:"text-xs font-medium truncate",children:E.title}),p.jsxs("div",{className:"text-[9px] text-slate-600 mt-0.5 group-hover:text-slate-500",children:[new Date(E.timestamp).toLocaleDateString()," • ",new Date(E.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]},E.id)):p.jsx("p",{className:"px-4 py-2 text-xs text-slate-600 italic text-center border border-slate-800/50 rounded-lg",children:"Belum ada riwayat chat."}):p.jsx("p",{className:"px-4 py-2 text-xs text-slate-600 italic text-center",children:"Login untuk melihat riwayat."})})]})]}),p.jsxs("div",{className:"p-4 border-t border-slate-800 bg-slate-900 shrink-0",children:[f&&p.jsxs("button",{onClick:f,className:"w-full mb-4 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white rounded-xl font-bold text-xs uppercase tracking-wider transition-all flex items-center justify-center gap-2 border border-slate-700/50 hover:border-slate-600 group",children:[p.jsx(Hi,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),"Exit Studio"]}),o?p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.photoURL?p.jsx("img",{src:o.photoURL,alt:o.name,className:"w-8 h-8 rounded-full object-cover border border-slate-700"}):p.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex items-center justify-center text-xs font-bold text-white shrink-0",children:o.name.charAt(0).toUpperCase()}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("p",{className:"text-sm font-medium text-white truncate",title:o.name,children:o.name.length>20?o.name.substring(0,20)+"...":o.name}),p.jsx("p",{className:"text-xs text-slate-500 truncate",children:o.school})]})]}),p.jsxs("button",{onClick:i,className:"w-full py-2 text-xs font-medium text-slate-400 hover:text-red-400 hover:bg-red-900/10 rounded-lg transition-colors flex items-center justify-center gap-2",children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),y.logOut]})]}):p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-xs text-slate-400 mb-3",children:y.loginToSave}),p.jsxs("button",{onClick:r,className:"w-full py-2.5 bg-white text-slate-900 font-bold rounded-xl text-sm hover:bg-slate-200 transition-colors shadow-lg active:scale-95 flex items-center justify-center gap-2",children:[p.jsx("img",{src:"https://www.svgrepo.com/show/475656/google-color.svg",alt:"G",className:"w-4 h-4"}),y.loginBtn]})]})]})]})})]})};class Lm{constructor(e,n,o,i,r){this.x=e,this.y=n,this.vx=0,this.vy=0,this.radius=i,this.color=o,this.friction=.92,this.ease=r,this.dx=(Math.random()-.5)*80,this.dy=(Math.random()-.5)*80,this.angle=Math.random()*Math.PI*2,this.angleSpeed=.02+Math.random()*.03,this.wobbleRadius=15+Math.random()*25}update(e,n,o){if(o)this.x+=this.vx,this.y+=this.vy,this.vx*=this.friction,this.vy*=this.friction;else{this.angle+=this.angleSpeed;const i=Math.cos(this.angle)*this.wobbleRadius,r=Math.sin(this.angle)*this.wobbleRadius,l=e+this.dx+i,u=n+this.dy+r;this.x+=(l-this.x)*this.ease,this.y+=(u-this.y)*this.ease,this.vx=0,this.vy=0}}shatter(){const e=Math.random()*Math.PI*2,n=Math.random()*30+15;this.vx=Math.cos(e)*n,this.vy=Math.sin(e)*n}draw(e){e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fillStyle=this.color,e.fill()}}const Fm=({onEnter:t})=>{const[e,n]=w.useState(!1),[o,i]=w.useState(!1),r=w.useRef(null),l=w.useRef(!1),u=w.useRef({x:window.innerWidth/2,y:window.innerHeight/2}),d=w.useRef([]);w.useEffect(()=>{setTimeout(()=>i(!0),300);const m=r.current;if(!m)return;const h=m.getContext("2d");if(!h)return;const g=()=>{m.width=window.innerWidth,m.height=window.innerHeight};window.addEventListener("resize",g),g();const y=S=>{u.current={x:S.clientX,y:S.clientY}};window.addEventListener("mousemove",y);const x=["#0f172a","#1e293b","#312e81","#1e1b4b","#4c1d95","#2563eb"],T=[];for(let S=0;S<15;S++){const E=Math.random()*30+20,N=x[Math.floor(Math.random()*x.length)],_=Math.random()*.08+.03;T.push(new Lm(m.width/2,m.height/2,N,E,_))}d.current=T;let C;const A=()=>{h.clearRect(0,0,m.width,m.height),d.current.forEach(S=>{S.update(u.current.x,u.current.y,l.current),S.draw(h)}),C=requestAnimationFrame(A)};return A(),()=>{window.removeEventListener("resize",g),window.removeEventListener("mousemove",y),cancelAnimationFrame(C)}},[]);const c=()=>{l.current||(l.current=!0,d.current.forEach(m=>m.shatter()),setTimeout(()=>{l.current=!1},1500))},f=()=>{n(!0),setTimeout(()=>{t()},900)};return p.jsxs("div",{className:`fixed inset-0 z-[999] bg-white flex flex-col items-center justify-center overflow-hidden transition-transform duration-[900ms] cubic-bezier(0.76, 0, 0.24, 1) ${e?"-translate-y-full rounded-b-[3rem] shadow-2xl":"translate-y-0 rounded-none shadow-none"}`,onDoubleClick:c,children:[p.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none filter blur-[60px] opacity-80",children:p.jsx("canvas",{ref:r,className:"w-full h-full"})}),p.jsx("div",{className:"absolute inset-0 z-0 opacity-[0.4] pointer-events-none mix-blend-multiply",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}}),p.jsxs("div",{className:`relative z-10 flex flex-col items-center max-w-lg w-full text-center px-6 transition-all duration-1000 ease-out transform select-none ${o?"translate-y-0 opacity-100":"translate-y-12 opacity-0"}`,children:[p.jsxs("h1",{className:"text-5xl md:text-7xl font-black text-slate-900 mb-2 tracking-tighter",children:["FANRA",p.jsx("span",{className:"text-blue-600",children:"."})]}),p.jsx("h2",{className:"text-xl md:text-2xl font-bold text-slate-400 mb-8 tracking-widest uppercase",children:"AI Studio"}),p.jsxs("p",{className:"text-slate-500 text-sm md:text-base font-medium leading-relaxed mb-16 max-w-xs mx-auto",children:["Ruang imajinasi tanpa batas. ",p.jsx("br",{}),p.jsx("span",{className:"text-slate-800",children:"Edit, Ciptakan, dan Berdiskusi."})]}),p.jsxs("button",{onClick:f,className:"group flex flex-col items-center gap-4 transition-all outline-none cursor-pointer",children:[p.jsx("div",{className:"w-16 h-16 rounded-full border border-slate-200 bg-white/80 backdrop-blur-sm flex items-center justify-center shadow-lg transition-all duration-500 group-hover:scale-110 group-hover:bg-white group-hover:border-slate-300 group-active:scale-95 group-hover:shadow-xl",children:p.jsx(qi,{className:"w-6 h-6 text-slate-400 group-hover:text-slate-900 transition-colors duration-300 transform group-hover:translate-y-0.5"})}),p.jsx("span",{className:"text-[10px] font-bold uppercase tracking-[0.3em] text-slate-400 group-hover:text-slate-600 transition-colors duration-300",children:"Open Studio"})]})]})]})},Gm="3JEZ69gonQmxU83WxzidFCFf",Vm="AIzaSyDzwJLdjFvu5jrsF_HYtYSWLPSoQc2JYzA",Hm="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",qm="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",Bm="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",Km="sb_publishable_ikw-BNV8Wu3qhNPuSti8Rg_7XmPMWqV",$m="",lt=[{id:te.BACKGROUND_REMOVER,nameKey:"toolBgRemove",descKey:"toolBgRemoveDesc",icon:p.jsx("img",{src:"https://cdn-icons-png.flaticon.com/128/593/593398.png",className:"w-8 h-8 object-contain",alt:"Hapus Background"}),color:"bg-blue-50",model:"gemini-2.5-flash-image",cost:1},{id:te.HD_UPSCALE,nameKey:"toolUpscale",descKey:"toolUpscaleDesc",icon:p.jsx("img",{src:"https://cdn-icons-png.flaticon.com/128/17558/17558323.png",className:"w-8 h-8 object-contain",alt:"HD Upscale"}),color:"bg-amber-50",model:"gemini-2.5-flash-image",cost:3},{id:te.CREATIVE_REMIX,nameKey:"toolRemix",descKey:"toolRemixDesc",icon:p.jsx("img",{src:"https://cdn-icons-png.flaticon.com/128/17142/17142644.png",className:"w-8 h-8 object-contain",alt:"Creative Remix"}),color:"bg-purple-50",model:"gemini-2.5-flash-image",cost:3},{id:te.COLORIZE,nameKey:"toolColorize",descKey:"toolColorizeDesc",icon:p.jsx("img",{src:"https://cdn-icons-png.flaticon.com/128/15109/15109276.png",className:"w-8 h-8 object-contain",alt:"Warnai Foto"}),color:"bg-pink-50",model:"gemini-2.5-flash-image",cost:2},{id:te.SKETCH_TO_REAL,nameKey:"toolSketch",descKey:"toolSketchDesc",icon:p.jsx("img",{src:"https://cdn-icons-png.flaticon.com/128/9798/9798973.png",className:"w-8 h-8 object-contain",alt:"Sketsa ke Nyata"}),color:"bg-emerald-50",model:"gemini-2.5-flash-image",cost:3}],Jm=({language:t,code:e})=>{const[n,o]=w.useState(!1),i=()=>{navigator.clipboard.writeText(e),o(!0),setTimeout(()=>o(!1),2e3)},r=l=>l.split(`
`).map((u,d)=>p.jsxs("div",{className:"table-row",children:[p.jsx("span",{className:"table-cell select-none text-slate-600 text-right pr-4 w-8 text-xs",children:d+1}),p.jsx("span",{className:"table-cell",children:u.split(/([<>{}"']|class|const|let|var|function|return|import|export)/g).map((c,f)=>c.startsWith("<")||c.startsWith(">")?p.jsx("span",{className:"text-blue-400",children:c},f):c.startsWith('"')||c.startsWith("'")?p.jsx("span",{className:"text-green-400",children:c},f):["const","let","var","function","return","import","export","class"].includes(c)?p.jsx("span",{className:"text-purple-400 font-bold",children:c},f):["=","{","}","(",")",";"].includes(c)?p.jsx("span",{className:"text-slate-400",children:c},f):p.jsx("span",{className:"text-slate-200",children:c},f))})]},d));return p.jsxs("div",{className:"my-4 rounded-xl overflow-hidden border border-slate-700/50 shadow-lg bg-[#1e1e1e] w-full max-w-full group",children:[p.jsxs("div",{className:"bg-[#2d2d2d] px-4 py-2 flex items-center justify-between border-b border-white/5",children:[p.jsx("span",{className:"text-xs font-mono text-slate-400 lowercase font-bold",children:t||"code"}),p.jsx("button",{onClick:i,className:"flex items-center gap-1.5 text-[10px] font-medium text-slate-400 hover:text-white bg-white/5 hover:bg-white/10 px-2 py-1 rounded transition-all",children:n?p.jsxs(p.Fragment,{children:[p.jsx(nn,{className:"w-3 h-3 text-green-400"})," Copied"]}):p.jsxs(p.Fragment,{children:[p.jsx(Bi,{className:"w-3 h-3"})," Copy Code"]})})]}),p.jsx("div",{className:"p-4 overflow-x-auto custom-scrollbar",children:p.jsx("pre",{className:"font-mono text-sm leading-relaxed whitespace-pre font-normal",style:{tabSize:2},children:p.jsx("code",{className:"table w-full border-collapse",children:r(e)})})})]})},Om=({isOpen:t,onClose:e})=>t?p.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 animate-fade-in",children:p.jsxs("div",{className:"bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl animate-fade-in-up border border-slate-100",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.jsx("div",{className:"w-10 h-10 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center",children:p.jsx(Gt,{className:"w-5 h-5"})}),p.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Cara Dapet API Key Gemini"})]}),p.jsxs("ol",{className:"space-y-4 text-sm text-slate-600 mb-6 list-decimal list-inside marker:font-bold marker:text-blue-600",children:[p.jsxs("li",{className:"pl-2",children:["Buka website ",p.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 font-bold hover:underline",children:"Google AI Studio"}),"."]}),p.jsx("li",{className:"pl-2",children:"Login pakai akun Google kamu."}),p.jsxs("li",{className:"pl-2",children:["Klik tombol biru besar bertuliskan ",p.jsx("b",{children:'"Create API Key"'}),"."]}),p.jsxs("li",{className:"pl-2",children:["Pilih ",p.jsx("b",{children:'"Create API key in new project"'}),"."]}),p.jsxs("li",{className:"pl-2",children:["Salin (Copy) kode yang muncul, lalu tempel di menu ",p.jsx("b",{children:"Pengaturan"})," aplikasi ini."]})]}),p.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg border border-slate-200 text-xs text-slate-500 mb-6",children:["💡 ",p.jsx("b",{children:"Tips:"})," API Key ini gratis (Free Tier). Jangan kasih tau kode ini ke orang lain ya."]}),p.jsx("button",{onClick:e,className:"w-full py-3 bg-primary text-white rounded-xl font-bold shadow-lg shadow-primary/20 hover:bg-slate-800 transition-all active:scale-95",children:"Oke, Siap!"})]})}):null,ki=({text:t,block:e=!1})=>{const[n,o]=w.useState(t);w.useEffect(()=>{if(window.katex)try{const r=window.katex.renderToString(t,{throwOnError:!1,displayMode:e});o(r)}catch{o(t)}},[t,e]);const i=()=>{navigator.clipboard.writeText(t),ie("Rumus LaTeX disalin! 📋")};return window.katex?p.jsx("span",{dangerouslySetInnerHTML:{__html:n},className:`${e?"block my-2 overflow-x-auto overflow-y-hidden py-1":""} cursor-pointer hover:bg-slate-100/50 rounded transition-colors`,title:"Klik 2x untuk salin rumus",onDoubleClick:i}):p.jsx("code",{children:t})},Di=t=>{const e=[],n=r=>{const l=`___TOKEN_${e.length}___`;return e.push({id:l,node:r}),l};let o=t.replace(/```([\w-]*)\n([\s\S]*?)```/g,(r,l,u)=>n(p.jsx(Jm,{language:l,code:u})));return o=o.replace(/(\$\$[\s\S]*?\$\$|\\\[[\s\S]*?\\\])/g,r=>{const l=(r.startsWith("$$"),r.slice(2,-2));return n(p.jsx(ki,{text:l,block:!0}))}),o=o.replace(new RegExp("(\\\\\\([\\s\\S]*?\\\\\\)|(?<!\\\\)\\$(?:[^$\\n]+?)(?<!\\\\)\\$)","g"),r=>{const l=r.startsWith("\\(")?r.slice(2,-2):r.slice(1,-1);return n(p.jsx(ki,{text:l,block:!1}))}),o.split(`
`).map((r,l)=>r.trim().startsWith("### ")?p.jsx("h3",{className:"text-base font-bold text-slate-900 mt-3 mb-1",children:Ft(r.replace(/^###\s+/,""),e)},l):r.trim().startsWith("## ")?p.jsx("h2",{className:"text-lg font-bold text-slate-900 mt-4 mb-2",children:Ft(r.replace(/^##\s+/,""),e)},l):r.trim()==="***"||r.trim()==="---"?p.jsx("div",{className:"h-px bg-slate-200 my-4 w-full"},l):r.trim()===""?p.jsx("div",{className:"h-2"},l):p.jsx("div",{className:"block leading-relaxed",children:Ft(r,e)},l))},Ft=(t,e)=>t.split(/(\*\*[\s\S]*?\*\*)/g).map((o,i)=>o.startsWith("**")&&o.endsWith("**")?p.jsx("strong",{className:"font-bold text-slate-900",children:Ui(o.slice(2,-2),e)},i):p.jsx(Vt.Fragment,{children:Ui(o,e)},i)),Ui=(t,e)=>t.split(new RegExp("(?<!\\*)\\*([^*]+?)\\*(?!\\*)","g")).map((o,i)=>i%2===1?p.jsx("em",{className:"italic text-slate-800",children:Li(o,e)},i):Li(o,e)),Li=(t,e)=>t.split(/(___TOKEN_\d+___)/g).map((o,i)=>{const r=e.find(d=>d.id===o);if(r)return p.jsx(Vt.Fragment,{children:r.node},i);const u=/\[(.*?)\]\((.*?)\)/g.exec(o);return u?p.jsxs(Vt.Fragment,{children:[o.substring(0,u.index),p.jsx("a",{href:u[2],target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline font-medium",children:u[1]}),o.substring(u.index+u[0].length)]},i):o});function Xm({onExit:t,isAdmin:e=!1}){const[n,o]=w.useState(!0),[i,r]=w.useState("id"),[l,u]=w.useState(null),[d,c]=w.useState(null),f=(l==null?void 0:l.isAdmin)||e,[m,h]=w.useState(!1),[g,y]=w.useState(!1),[x,T]=w.useState(!1),[C,A]=w.useState(!0),[S,E]=w.useState(null),[N,_]=w.useState(null),[I,M]=w.useState(null),[P,D]=w.useState(""),[F,H]=w.useState({isProcessing:!1,progress:"",error:null}),[K,$]=w.useState({}),[Y,ve]=w.useState(Date.now().toString()),[ce,W]=w.useState([]),[de,re]=w.useState([]),[ae,He]=w.useState(""),[J,we]=w.useState([]),[je,Se]=w.useState(null),[G,Z]=w.useState(!1),[j,et]=w.useState(!1),[gn,Gs]=w.useState(null),Re=w.useRef(null),yn=w.useRef(null),vn=w.useRef(null),qe=w.useRef(null),[Vs,It]=w.useState(!1),[Tn,xn]=w.useState(""),[Te,Be]=w.useState([]),[wt,_n]=w.useState(""),[At,En]=w.useState(""),[Cn,Sn]=w.useState(""),[In,wn]=w.useState(""),[An,Nn]=w.useState(""),[bn,Rn]=w.useState(!0),[Pn,Mn]=w.useState(!0),[tt,kn]=w.useState(!1),[Dn,Un]=w.useState(!1),[nt,Ln]=w.useState(!1),[Nt,Fn]=w.useState(!1),[he,bt]=w.useState(!1),[Hs,Gn]=w.useState(!1),[qs,Rt]=w.useState(!1),[Bs,Pt]=w.useState(null),B=Xe[i];w.useEffect(()=>{const v=(k,L)=>{const q=localStorage.getItem(k);q&&L(q)};v("remove_bg_key",xn),v("google_search_key",_n),v("google_search_cx",En),v("open_router_key",Sn),v("hugging_face_key",wn),v("groq_key",Nn),localStorage.getItem("fanra_rb_enabled")==="false"&&Rn(!1),localStorage.getItem("fanra_sb_enabled")==="false"&&Mn(!1),localStorage.getItem("fanra_km_enabled")==="true"&&kn(!0),localStorage.getItem("fanra_wiki_enabled")==="true"&&Un(!0),(async()=>{const k={};for(const L of lt){const q=`tool_status_${L.id}`,z=await Hr(q);k[L.id]=z!=="false"}$(k)})(),Ke()},[]),w.useEffect(()=>{he&&Te.some(v=>v.isActive)&&bt(!1)},[Te]),w.useEffect(()=>{var v;(v=yn.current)==null||v.scrollIntoView({behavior:"smooth"})},[de,F.isProcessing,J]),w.useEffect(()=>{d&&(Rr(d).then(v=>{W(v);const R=v.filter(k=>k.sessionId===Y);re(R)}),Pr(d).then(v=>Be(v))),Ke()},[d,Y]),w.useEffect(()=>{if(qe.current){qe.current.style.height="auto";const v=Math.min(qe.current.scrollHeight,128);qe.current.style.height=`${Math.max(42,v)}px`}},[ae,J]);const Ks=()=>Tn||Gm,Vn=()=>{const v=Te.filter(R=>R.isActive!==!1).map(R=>R.key);return v.length===0?[Vm]:v},$s=v=>{xn(v),localStorage.setItem("remove_bg_key",v)},Js=(v,R)=>{_n(v),En(R),localStorage.setItem("google_search_key",v),localStorage.setItem("google_search_cx",R)},Os=v=>{Sn(v),localStorage.setItem("open_router_key",v)},Ws=v=>{wn(v),localStorage.setItem("hugging_face_key",v)},Ys=v=>{Nn(v),localStorage.setItem("groq_key",v)},zs=async(v,R)=>{const k={key:v,addedAt:Date.now(),isShared:R,isActive:!0},L=[...Te,k];Be(L),d&&await Qn(d,L)},Xs=async v=>{const R=Te.filter(k=>k.key!==v);Be(R),d&&await qr(d,v,R)},Qs=async(v,R)=>{const k=Te.map(L=>L.key===v?{...L,isActive:R}:L);Be(k),d&&await Qn(d,k)},Zs=v=>{Rn(v),localStorage.setItem("fanra_rb_enabled",v.toString())},js=v=>{Mn(v),localStorage.setItem("fanra_sb_enabled",v.toString())},er=v=>{kn(v),localStorage.setItem("fanra_km_enabled",v.toString())},tr=v=>{Un(v),localStorage.setItem("fanra_wiki_enabled",v.toString())},nr=async()=>{try{window.aistudio&&await window.aistudio.openSelectKey()}catch(v){console.error(v)}},Ke=()=>{if(Te.length>0){Ln(!1),Fn(!1);return}const v=new Date().toISOString().split("T")[0],R=l?d||"user":"guest",k=`fanra_limit_${v}_${R}_chat`,L=`fanra_limit_${v}_${R}_image`,q=parseInt(localStorage.getItem(k)||"0"),z=parseInt(localStorage.getItem(L)||"0"),O=l?10:3,ge=l?3:1;Ln(q>=O),Fn(z>=ge)},Mt=v=>{if(Te.length>0)return!0;const L=`fanra_limit_${new Date().toISOString().split("T")[0]}_${l?d||"user":"guest"}_${v}`,q=parseInt(localStorage.getItem(L)||"0");let z=0;return l?z=v==="chat"?10:3:z=v==="chat"?3:1,q>=z?(Ke(),!1):(localStorage.setItem(L,(q+1).toString()),Ke(),!0)},Hn=(v,R,k,L)=>{_({data:v,mimeType:R,width:k,height:L})},or=(v,R,k)=>{u(v),c(R),h(!1)},$e=()=>{_(null),M(null),D(""),E(null),H({isProcessing:!1,progress:"",error:null}),we([]),Pt(null)},ir=async()=>{await Br(),u(null),c(null),Be([]),$e(),W([]),re([]),bt(!1),Ke()},qn=()=>r(v=>v==="id"?"en":"id"),sr=(v,R)=>{v&&navigator.clipboard.writeText(v).then(()=>{Se(R),setTimeout(()=>Se(null),2e3)})},rr=v=>{Gs(R=>R===v?null:v)},ar=async(v,R)=>{if(R.stopPropagation(),!f)return;const k=!K[v];$(L=>({...L,[v]:k}));try{await Kr(`tool_status_${v}`,k.toString())}catch{$(q=>({...q,[v]:!k}))}},lr=(v,R)=>{R?ie(B.toolLockedMsg):E(v)},ur=v=>{v.preventDefault(),v.stopPropagation(),Z(!0)},cr=v=>{v.preventDefault(),v.stopPropagation(),Z(!1)},dr=v=>{const R=new FileReader;R.onloadend=()=>{const k=R.result,L=new Image;L.onload=()=>{Hn(k.split(",")[1],v.type,L.width,L.height)},L.src=k},R.readAsDataURL(v)},Bn=v=>{if(v.length+J.length>3){alert("Maksimal 3 gambar sekaligus.");return}v.forEach(R=>{if(!R.type.startsWith("image/"))return;const k=new FileReader;k.onloadend=()=>{const L=k.result.split(",")[1];we(q=>[...q,{data:L,mimeType:R.type,name:R.name}])},k.readAsDataURL(R)})},fr=v=>{v.preventDefault(),v.stopPropagation(),Z(!1);const R=Array.from(v.dataTransfer.files);if(R.length!==0)if(S){const k=R[0];k.type.startsWith("image/")&&dr(k)}else Bn(R)},Kn=()=>{const v=Date.now().toString();ve(v),re([]),we([]),$e(),y(!1)},pr=v=>{ve(v);const R=ce.filter(k=>k.sessionId===v);re(R),y(!1),$e()},$n=()=>{I?(Pt("back"),Rt(!0)):$e()},mr=()=>{Bs==="back"&&$e(),Rt(!1),Pt(null)},hr=()=>{Re.current&&(Re.current.abort(),Re.current=null,H({isProcessing:!1,progress:"",error:"Stopped by user."}))},Jn=async v=>{var q,z;if(v==null||v.preventDefault(),!ae.trim()&&J.length===0||he||!Mt("chat")||J.length>0&&!Mt("image"))return;const R={id:Date.now().toString(),sessionId:Y,role:"user",text:ae,timestamp:Date.now(),attachments:[...J]},k={id:"temp-thinking",sessionId:Y,role:"model",text:"",timestamp:Date.now()+1},L=[...de,R,k];re(L),W(O=>[...O,R,k]),He(""),we([]),H({isProcessing:!0,progress:"AI Thinking...",error:null}),d&&Zn(d,R);try{Re.current=new AbortController;const O=wt&&At?{apiKey:wt,cx:At}:void 0,ge=Vn(),ye=await Nm(R.text,ge,de,i,R.attachments||[],Je=>{re(Ae=>Ae.map(kt=>kt.id==="temp-thinking"?{...kt,text:Je}:kt))},tt,Dn,O,Re.current.signal,Cn||Hm,In||qm,An||Bm),xe={id:(Date.now()+2).toString(),sessionId:Y,role:"model",text:ye.text,timestamp:Date.now(),source:ye.source};re(Je=>Je.map(Ae=>Ae.id==="temp-thinking"?xe:Ae)),W(Je=>Je.map(Ae=>Ae.id==="temp-thinking"?xe:Ae)),d&&Zn(d,xe)}catch(O){if(O.message==="Request cancelled by user")re(ge=>ge.filter(ye=>ye.id!=="temp-thinking")),W(ge=>ge.filter(ye=>ye.id!=="temp-thinking"));else{const ge={id:(Date.now()+2).toString(),sessionId:Y,role:"model",text:B.chatFallbackError+(O.message?` (${O.message})`:""),timestamp:Date.now()};re(ye=>ye.map(xe=>xe.id==="temp-thinking"?ge:xe)),W(ye=>ye.map(xe=>xe.id==="temp-thinking"?ge:xe)),((q=O.message)!=null&&q.includes("429")||(z=O.message)!=null&&z.includes("quota"))&&bt(!0)}}finally{H({isProcessing:!1,progress:"",error:null}),Re.current=null}},gr=v=>{we(R=>R.filter((k,L)=>L!==v))},On=()=>{var v;Nt||(v=vn.current)==null||v.click()},yr=v=>{if(v.target.files){const R=Array.from(v.target.files);Bn(R)}v.target.value=""},vr=l||{name:"Guest"},Tr=x?lt:lt.slice(0,3),xr=async()=>{if(!N||!S||!Mt("image"))return;H({isProcessing:!0,progress:B.initializing,error:null}),M(null);const v=S.id===te.BACKGROUND_REMOVER,R=Ks(),k=Vn();try{let L="",q=!1;if(v&&R&&bn&&!q)try{H(O=>({...O,progress:B.processingStandard})),L=await Rm(N.data,R),q=!0}catch{console.warn("Standard Engine failed")}if(!q&&(v||!v)&&!q&&k.length>0)try{H(O=>({...O,progress:B.processingAI})),L=await _m({image:N,tool:S.id,prompt:S.id===te.CREATIVE_REMIX?P:void 0,apiKeys:k}),v&&(H(O=>({...O,progress:B.refining})),L=await $r(L)),q=!0}catch(O){console.warn("Gemini failed",O)}if(!q||!L)throw new Error("No available API Keys or Services found/enabled.");M(L),H({isProcessing:!1,progress:"",error:null})}catch(L){console.error("Execution Error:",L);let q=B.serviceBusy;const z=(L.message||"").toLowerCase();z.includes("network")||z.includes("fetch")?q=B.networkError:z.includes("memory")||z.includes("oom")?q=B.memoryError:(z.includes("no available api")||z.includes("enabled"))&&(q=B.insufficientCredits),H({isProcessing:!1,progress:"",error:q})}},Wn=nt&&!he&&!F.isProcessing,_r=/(\$\$|\\\[|\\\(|\$)/.test(ae);return p.jsxs("div",{className:"flex h-[100dvh] bg-white font-sans text-primary overflow-hidden relative",onDragOver:ur,onDragLeave:cr,onDrop:fr,children:[n&&p.jsx(Fm,{onEnter:()=>o(!1)}),G&&p.jsx("div",{className:"absolute inset-0 z-[100] bg-primary/10 backdrop-blur-sm border-4 border-primary border-dashed m-4 rounded-3xl flex items-center justify-center pointer-events-none",children:p.jsxs("div",{className:"bg-white px-8 py-4 rounded-2xl shadow-xl flex items-center gap-3",children:[p.jsx(Yn,{className:"w-6 h-6 text-primary"}),p.jsx("span",{className:"font-bold text-lg text-primary",children:"Drop files to send"})]})}),m&&p.jsx("div",{className:"fixed inset-0 z-[60] bg-white",children:p.jsx(Dm,{onLogin:or,language:i,onToggleLanguage:qn,onClose:()=>h(!1)})}),p.jsx(Om,{isOpen:Hs,onClose:()=>Gn(!1)}),p.jsx(km,{isOpen:Vs,onClose:()=>It(!1),removeBgKey:Tn,onSaveRemoveBgKey:$s,storedApiKeys:Te,onAddApiKey:zs,onDeleteApiKey:Xs,onToggleApiKey:Qs,onSelectGoogleKey:nr,knowledgeMode:tt,onToggleKnowledgeMode:er,wikiEnabled:Dn,onToggleWiki:tr,removeBgEnabled:bn,onToggleRemoveBg:Zs,supabaseEnabled:Pn,onToggleSupabase:js,googleSearchKey:wt,googleSearchCx:At,onSaveGoogleSearch:Js,openRouterKey:Cn,onSaveOpenRouterKey:Os,huggingFaceKey:In,onSaveHuggingFaceKey:Ws,groqKey:An,onSaveGroqKey:Ys,language:i}),p.jsx(Jr,{isOpen:qs,title:B.confirmTitle,description:B.confirmDesc,confirmText:B.yesChange,onConfirm:mr,onCancel:()=>Rt(!1)}),p.jsx(Um,{isOpen:g,onClose:()=>y(!1),onNewChat:Kn,user:l,onLogout:ir,onOpenLogin:()=>h(!0),language:i,tools:lt,toolStatuses:K,onSelectTool:E,onExit:t,chatHistory:ce,onLoadSession:pr,currentSessionId:Y}),p.jsxs("div",{className:"flex-1 flex flex-col h-full relative w-full overflow-hidden bg-slate-50/50",children:[p.jsx("header",{className:"absolute top-0 left-0 right-0 z-30 p-4 pointer-events-none",children:p.jsxs("div",{className:"max-w-5xl mx-auto bg-white/80 backdrop-blur-xl border border-white/40 shadow-lg shadow-slate-200/50 rounded-2xl px-4 py-3 flex items-center justify-between pointer-events-auto",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("button",{onClick:()=>y(!g),className:"p-2 rounded-xl hover:bg-slate-100 text-slate-600 transition-colors",children:p.jsx(Mr,{className:"w-5 h-5"})}),p.jsx("div",{className:"font-bold text-lg tracking-tight bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent hidden md:block",children:"Fanra Studio"})]}),p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsxs("button",{onClick:qn,className:"flex items-center gap-2 px-3 py-1.5 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-full text-xs font-bold text-slate-700 transition-all hover:shadow-sm active:scale-95",children:[p.jsx("img",{src:i==="id"?"https://cdn-icons-png.flaticon.com/128/11654/11654463.png":"https://cdn-icons-png.flaticon.com/128/9906/9906532.png",alt:"Lang",className:"w-4 h-4 object-contain"}),p.jsx("span",{children:i.toUpperCase()})]}),p.jsxs("button",{onClick:()=>It(!0),className:"p-2 text-slate-400 hover:text-primary hover:bg-slate-100 rounded-full transition-all relative",children:[p.jsx(zn,{className:"w-5 h-5"}),he&&p.jsx("span",{className:"absolute top-1.5 right-1.5 w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse"})]})]})]})}),p.jsx("div",{className:"flex-1 overflow-y-auto pt-24 px-4 scroll-smooth custom-scrollbar",children:p.jsxs("div",{className:"max-w-3xl mx-auto min-h-full flex flex-col pb-4",children:[de.length===0&&!S&&p.jsxs("div",{className:"flex-1 flex flex-col justify-center items-center py-10 animate-fade-in-up",children:[p.jsxs("div",{className:"mb-8 text-center",children:[p.jsxs("h2",{className:"text-3xl md:text-4xl font-bold text-slate-800 mb-3 tracking-tight",children:[B.heroTitle," ",vr.name]}),p.jsx("p",{className:"text-slate-500 text-lg",children:B.heroSubtitle})]}),p.jsxs("div",{className:"grid grid-cols-3 gap-3 md:gap-5 w-full max-w-2xl px-2",children:[Tr.map(v=>{const R=K[v.id]!==!1,k=!R&&!f;return p.jsxs("button",{onClick:()=>lr(v,k),className:`relative flex flex-col items-center text-center p-4 md:p-6 bg-white border rounded-2xl shadow-sm transition-all duration-300 group h-full ${k?"border-slate-100 opacity-80 bg-slate-50 hover:bg-slate-100 cursor-pointer":"hover:border-primary/20 hover:shadow-xl hover:-translate-y-1 border-slate-100 cursor-pointer"}`,children:[f&&p.jsx("div",{className:"absolute top-2 right-2 z-20",onClick:L=>ar(v.id,L),children:p.jsx("div",{className:`w-8 h-4 rounded-full transition-colors flex items-center p-0.5 ${R?"bg-green-500":"bg-slate-300"}`,children:p.jsx("div",{className:`w-3 h-3 bg-white rounded-full shadow-sm transform transition-transform ${R?"translate-x-4":"translate-x-0"}`})})}),k&&p.jsx("div",{className:"absolute top-2 right-2 z-10",children:p.jsx("div",{className:"bg-slate-100 p-1.5 rounded-full shadow-sm",children:p.jsx(Gi,{className:"w-3 h-3 text-slate-400"})})}),p.jsx("div",{className:`w-12 h-12 md:w-14 md:h-14 ${k?"bg-slate-200 grayscale":v.color} rounded-2xl flex items-center justify-center mb-4 transition-transform group-hover:scale-110 shadow-sm`,children:v.icon}),p.jsx("span",{className:`text-xs md:text-sm font-bold leading-tight ${k?"text-slate-400":"text-slate-700"}`,children:B[v.nameKey]}),p.jsx("span",{className:"hidden md:block text-[10px] text-slate-400 mt-2 leading-tight",children:B[v.descKey]})]},v.id)}),p.jsxs("button",{onClick:()=>T(!x),className:`flex flex-col items-center justify-center text-center p-4 md:p-6 bg-slate-50 border border-slate-200 border-dashed rounded-2xl hover:bg-white hover:border-slate-300 hover:shadow-md transition-all duration-300 group h-full ${x?"":"col-start-2"}`,children:[p.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-slate-100 text-slate-400 rounded-2xl flex items-center justify-center mb-4 transition-transform group-hover:scale-110",children:p.jsx(Vi,{className:"w-6 h-6"})}),p.jsx("span",{className:"text-xs md:text-sm font-bold text-slate-500 group-hover:text-slate-700 leading-tight",children:x?B.lessTools:B.moreTools})]})]})]}),de.map(v=>p.jsxs("div",{className:`flex flex-col mb-6 animate-fade-in ${v.role==="user"?"items-end":"items-start"}`,children:[v.attachments&&v.attachments.length>0&&p.jsx("div",{className:`flex flex-wrap gap-2 mb-2 max-w-[85%] ${v.role==="user"?"justify-end":"justify-start"}`,children:v.attachments.map((R,k)=>p.jsx("div",{className:"rounded-xl overflow-hidden border border-slate-200/50 shadow-sm transition-transform hover:scale-[1.02]",children:p.jsx("img",{src:`data:${R.mimeType};base64,${R.data}`,alt:R.name,className:"h-32 w-auto object-cover md:h-48 rounded-lg bg-slate-100"})},k))}),(v.text||v.role==="model"&&!v.text)&&p.jsxs("div",{className:`flex flex-col gap-1 max-w-lg lg:max-w-2xl ${v.role==="user"?"items-end":"items-start"}`,children:[p.jsx("div",{className:`relative px-5 py-3.5 rounded-2xl text-sm leading-relaxed shadow-sm break-words group w-full ${v.role==="user"?"bg-white text-slate-800 rounded-tr-sm border border-slate-100 shadow-slate-200/50":"bg-transparent text-slate-700 p-0 shadow-none"}`,children:v.role==="model"&&!v.text?p.jsxs("div",{className:"flex gap-1.5 h-5 items-center",children:[p.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"}),p.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-100"}),p.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-200"})]}):Di(v.text)}),p.jsxs("div",{className:`flex items-center gap-2 mt-1 px-1 ${v.role==="user"?"justify-end":"justify-start"}`,children:[v.role==="model"&&v.source&&p.jsxs("div",{className:"relative",children:[p.jsx("button",{onClick:()=>rr(v.id),className:`p-1.5 rounded-full transition-all ${gn===v.id?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-400 hover:text-slate-600"}`,title:"Info Sumber",children:p.jsx(kr,{className:"w-3.5 h-3.5"})}),gn===v.id&&p.jsxs("div",{className:"absolute bottom-8 left-0 z-10 bg-white border border-slate-200 rounded-xl shadow-xl p-2 min-w-[140px] animate-fade-in-up origin-bottom-left flex flex-col gap-1",children:[p.jsx("span",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-wider px-1",children:"Sumber Data"}),p.jsxs("div",{className:"flex items-center gap-2 p-1.5 rounded-lg bg-slate-50 text-xs font-semibold text-slate-700",children:[v.source==="gemini"&&p.jsx(Xn,{className:"w-3.5 h-3.5"}),v.source==="openrouter"&&p.jsx("div",{className:"w-3.5 h-3.5 bg-green-500 rounded-full flex items-center justify-center text-[8px] text-white font-bold",children:"OR"}),v.source==="groq"&&p.jsx(Dr,{className:"w-3.5 h-3.5 text-orange-500"}),v.source==="huggingface"&&p.jsx("div",{className:"w-3.5 h-3.5 bg-yellow-400 rounded-full flex items-center justify-center text-[8px] text-black font-bold",children:"HF"}),v.source==="google_search"&&p.jsx(Xn,{className:"w-3.5 h-3.5 text-orange-500"}),v.source==="weather"&&p.jsx(Ur,{className:"w-3.5 h-3.5 text-blue-400"}),v.source==="country_fact"&&p.jsx(Lr,{className:"w-3.5 h-3.5 text-red-500"}),p.jsx("span",{children:v.source==="gemini"?"Google Gemini":v.source==="openrouter"?"OpenRouter":v.source==="groq"?"Groq LPU":v.source==="huggingface"?"HuggingFace":v.source==="weather"?"Open-Meteo":v.source==="country_fact"?"RestCountries":v.source==="google_search"?"Google":v.source})]})]})]}),v.text&&p.jsx("button",{onClick:()=>sr(v.text,v.id),className:`p-1.5 rounded-full transition-all ${je===v.id?"bg-green-100 text-green-600":"bg-white border border-slate-100 text-slate-400 hover:text-slate-600 hover:bg-slate-50"}`,children:je===v.id?p.jsx(nn,{className:"w-3.5 h-3.5"}):p.jsx(Bi,{className:"w-3.5 h-3.5"})})]})]})]},v.id)),S&&p.jsxs("div",{className:"w-full animate-fade-in py-4",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsxs("button",{onClick:$n,className:"text-xs flex items-center gap-1 text-slate-500 hover:text-primary px-3 py-1.5 bg-white border border-slate-200 rounded-full shadow-sm hover:shadow transition-all",children:[p.jsx(Hi,{className:"w-4 h-4"})," ",B.back]}),p.jsx("span",{className:"font-bold text-sm text-slate-700 bg-white px-3 py-1 rounded-full border border-slate-100 shadow-sm",children:B[S.nameKey]})]}),N?p.jsxs("div",{className:"space-y-4",children:[!I&&!F.isProcessing&&p.jsx("div",{className:"bg-slate-100 p-4 rounded-2xl border border-slate-200/60 max-w-sm mx-auto shadow-inner",children:p.jsx("img",{src:`data:${N.mimeType};base64,${N.data}`,className:"rounded-xl max-h-60 mx-auto object-contain shadow-sm"})}),S.id===te.CREATIVE_REMIX&&!I&&p.jsx("textarea",{className:"w-full bg-white border border-slate-200 rounded-2xl p-4 text-sm focus:ring-2 focus:ring-primary/10 focus:border-primary outline-none shadow-sm transition-all",placeholder:B.aiPromptPlaceholder,value:P,onChange:v=>D(v.target.value)}),!I&&!F.isProcessing&&p.jsx("button",{onClick:xr,disabled:S.id===te.CREATIVE_REMIX&&!P.trim(),className:"w-full py-4 bg-primary text-white rounded-2xl font-bold shadow-xl shadow-slate-900/10 active:scale-95 transition-all hover:-translate-y-0.5",children:B.generateMagic}),(F.isProcessing||I)&&p.jsx(Mm,{originalImage:N,resultImageBase64:I,isProcessing:F.isProcessing,processingText:F.progress,onReset:$n,language:i})]}):p.jsx(Pm,{onImageSelect:Hn,language:i})]}),F.isProcessing&&S&&p.jsx("div",{className:"flex gap-4 animate-fade-in pl-5",children:p.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[p.jsx("div",{className:"w-2 h-2 bg-slate-300 rounded-full animate-bounce"}),p.jsx("div",{className:"w-2 h-2 bg-slate-300 rounded-full animate-bounce delay-100"}),p.jsx("div",{className:"w-2 h-2 bg-slate-300 rounded-full animate-bounce delay-200"})]})}),p.jsx("div",{ref:yn})]})}),!S&&p.jsx("div",{className:"shrink-0 w-full px-4 pb-6 pt-2 z-40 bg-slate-50/50 backdrop-blur-sm",children:p.jsxs("div",{className:"max-w-3xl mx-auto",children:[he&&p.jsx("div",{className:"mb-3 animate-fade-in-up",children:p.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-3 flex items-center justify-between shadow-sm",children:[p.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[p.jsx(Fr,{className:"w-5 h-5"}),p.jsx("span",{className:"text-xs font-bold",children:"Limit Chat Habis."})]}),p.jsx("button",{onClick:()=>Gn(!0),className:"text-xs font-bold text-white bg-red-500 hover:bg-red-600 px-3 py-1.5 rounded-lg transition-colors shadow-sm",children:"Cara Dapet API Key?"})]})}),Wn&&p.jsxs("div",{className:"bg-slate-900 text-white rounded-t-3xl p-3 px-4 flex items-center justify-between shadow-2xl animate-fade-in z-10 relative mt-2 mx-1",children:[p.jsx("div",{className:"flex items-center gap-3",children:p.jsx("span",{className:"text-xs font-bold leading-tight",children:l?"Limit harian habis. Besok lagi ya!":"Login/Masuk untuk lanjut mengobrol dengan Fanra"})}),!l&&p.jsx("button",{onClick:()=>h(!0),className:"text-[10px] font-bold bg-white text-slate-900 px-3 py-1.5 rounded-lg hover:bg-slate-200 transition-colors shadow-sm whitespace-nowrap",children:"Login Sekarang"})]}),p.jsxs("form",{onSubmit:Jn,className:`relative flex flex-col bg-white border shadow-2xl shadow-slate-200/60 transition-all duration-300 focus-within:shadow-xl ${he?"border-red-200 opacity-80 rounded-3xl":Wn?"rounded-b-3xl rounded-t-sm border-t-0 border-slate-900/10":"rounded-3xl border-slate-200 focus-within:border-slate-300"}`,children:[_r&&p.jsxs("div",{className:"border-b border-slate-100 bg-slate-50/50 rounded-t-2xl animate-fade-in overflow-hidden transition-all",children:[p.jsxs("div",{onClick:()=>A(!C),className:"flex items-center justify-between p-2 cursor-pointer hover:bg-slate-100 transition-colors select-none",children:[p.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase px-1",children:"Pratinjau Rumus"}),p.jsx(qi,{className:`w-3 h-3 text-slate-400 transition-transform ${C?"":"-rotate-90"}`})]}),C&&p.jsx("div",{className:"p-3 bg-white text-sm overflow-x-auto border-t border-slate-100 max-h-40 custom-scrollbar",children:Di(ae)})]}),J.length>0&&p.jsxs("div",{className:"p-3 border-b border-slate-100 bg-slate-50 flex items-start gap-3 animate-fade-in overflow-x-auto custom-scrollbar rounded-t-[22px]",children:[J.map((v,R)=>p.jsxs("div",{className:"relative group flex-shrink-0",children:[p.jsx("img",{src:`data:${v.mimeType};base64,${v.data}`,alt:"Preview",className:"h-16 w-16 object-cover rounded-lg border border-slate-200 shadow-sm"}),p.jsx("button",{type:"button",onClick:()=>gr(R),className:"absolute -top-1.5 -right-1.5 bg-red-500 text-white rounded-full p-0.5 shadow-md hover:bg-red-600 transition-colors",children:p.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},R)),J.length<3&&p.jsx("div",{onClick:On,className:"h-16 w-16 rounded-lg border-2 border-dashed border-slate-300 flex items-center justify-center cursor-pointer hover:border-primary hover:bg-white transition-colors flex-shrink-0 text-slate-400 hover:text-primary",children:p.jsx("span",{className:"text-xs font-bold",children:"+"})})]}),p.jsxs("div",{className:"flex items-end gap-1.5 p-2.5",children:[p.jsxs("div",{className:"relative",children:[p.jsx("button",{type:"button",onClick:()=>et(!j),className:"p-2.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition-colors flex-shrink-0 mb-0.5",children:p.jsx(Gr,{className:"w-5 h-5"})}),j&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"fixed inset-0 z-50",onClick:()=>et(!1)}),p.jsxs("div",{className:"absolute bottom-12 left-0 w-48 bg-white border border-slate-200 rounded-xl shadow-xl z-[60] py-1 overflow-hidden animate-fade-in-up origin-bottom-left",children:[p.jsxs("button",{type:"button",onClick:()=>{Kn(),et(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-red-500 hover:bg-red-50 flex items-center gap-2",children:[p.jsx(Fi,{className:"w-4 h-4"})," Clear Chat"]}),p.jsxs("button",{type:"button",onClick:()=>{It(!0),et(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-600 hover:bg-slate-50 flex items-center gap-2",children:[p.jsx(zn,{className:"w-4 h-4"})," Settings"]})]})]})]}),p.jsx("input",{type:"file",ref:vn,className:"hidden",accept:"image/*",multiple:!0,onChange:yr}),p.jsx("button",{type:"button",onClick:On,disabled:Nt,className:`p-2.5 rounded-full transition-colors flex-shrink-0 mb-0.5 ${Nt?"text-slate-300 cursor-not-allowed":"text-slate-400 hover:text-slate-600 hover:bg-slate-100"}`,children:p.jsx(Yn,{className:"w-5 h-5"})}),p.jsx("textarea",{ref:qe,value:ae,onChange:v=>He(v.target.value),onKeyDown:v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),Jn(v))},disabled:he||nt,placeholder:he?"Limit API Key Habis.":tt?"(Knowledge Mode Active)":J.length>0?B.aiPromptPlaceholder:B.chatPlaceholder,className:"flex-1 bg-transparent border-none focus:ring-0 focus:outline-none resize-none max-h-32 py-3 px-2 text-sm text-primary placeholder:text-slate-400 leading-relaxed custom-scrollbar disabled:text-slate-400 disabled:cursor-not-allowed",rows:1,style:{minHeight:"44px",overflowY:"auto"}}),F.isProcessing&&!S?p.jsx("button",{type:"button",onClick:hr,className:"p-2.5 rounded-full transition-all shadow-md active:scale-90 flex-shrink-0 mb-0.5 bg-slate-900 text-white hover:bg-slate-700 animate-pulse",title:"Stop Generation",children:p.jsx(Vr,{className:"w-5 h-5"})}):p.jsx("button",{type:"submit",disabled:!ae.trim()&&J.length===0||F.isProcessing||he||nt&&ae.trim().length>0,className:`p-2.5 rounded-full transition-all shadow-md active:scale-90 flex-shrink-0 mb-0.5 ${tt?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-primary text-white hover:bg-slate-800"} ${he||nt?"bg-slate-300 text-white cursor-not-allowed opacity-50 blur-[1px]":""}`,children:p.jsx("svg",{className:"w-5 h-5 transform rotate-90",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})]})]})]})})]})]})}export{Xm as default};
