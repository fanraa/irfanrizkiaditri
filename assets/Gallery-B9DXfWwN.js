import{a as Pe,u as Ie,r as l,j as e,h as Me,U as ne,i as ie,R as ce,P as de,T as ue,c as L,C as xe,b as Fe,k as Ae,m as me,s as d,n as Ge,l as De,o as Le}from"./index-COUSDRnw.js";import{c as he}from"./imageUtils-Bq9wc1XJ.js";import{C as Te}from"./ConfirmModal-CyNdXQx2.js";const $e=({isAdmin:k})=>{const T=Pe(),{photoId:p}=Ie(),[u,C]=l.useState([]),[S,z]=l.useState(!0),[f,fe]=l.useState("All"),[a,g]=l.useState(null),b=9,[v,E]=l.useState(b),[be,R]=l.useState(!1),[O,$]=l.useState(!1),[P,Y]=l.useState("add"),[o,x]=l.useState({}),[H,U]=l.useState(!1),[h,_]=l.useState(!1),j=l.useRef(null),[q,B]=l.useState(null),[J,V]=l.useState(null),[I,K]=l.useState(null),[M,F]=l.useState(null),[Q,A]=l.useState(!1),G=async()=>{z(!0);try{const t=await Ae();C(t)}catch(t){console.error("Failed to load photos",t)}finally{z(!1)}};l.useEffect(()=>{G()},[]),l.useEffect(()=>{E(b)},[f]),l.useEffect(()=>{if(u.length>0)if(p){const t=u.find(s=>(s.caption?s.caption.toLowerCase().replace(/\s+/g,"-"):s.id)===p||s.id===p);t&&g(t)}else g(null)},[p,u]),l.useEffect(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[a]);const pe=["All",...Array.from(new Set(u.map(t=>t.year))).sort().reverse()],n=f==="All"?u:u.filter(t=>t.year===f),W=n.slice(0,v),ge=v<n.length,ve=v>b,X=W.reduce((t,s)=>(t[s.year]||(t[s.year]=[]),t[s.year].push(s),t),{}),je=Object.keys(X).sort().reverse(),w=a?n.findIndex(t=>t.id===a.id):-1,Z=w<n.length-1,ee=w>0,te=t=>{t==null||t.stopPropagation(),Z&&c(n[w+1])},se=t=>{t==null||t.stopPropagation(),ee&&c(n[w-1])},c=t=>{if(t){const s=t.caption?t.caption.toLowerCase().replace(/\s+/g,"-"):t.id;T(`/gallery/${s}`),De("photo",t.id||"unknown",t.caption||"Untitled Photo")}else A(!1),setTimeout(()=>{T("/gallery")},500)};l.useEffect(()=>{a?requestAnimationFrame(()=>{requestAnimationFrame(()=>{A(!0)})}):A(!1)},[a]),l.useEffect(()=>{if(!a)return;const t=s=>{s.key==="ArrowRight"&&te(),s.key==="ArrowLeft"&&se(),s.key==="Escape"&&c(null),s.key==="Home"&&(s.preventDefault(),n.length>0&&c(n[0])),s.key==="End"&&(s.preventDefault(),n.length>0&&c(n[n.length-1]))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[a,n]);const we=()=>{E(t=>t+b)},ye=()=>{E(b);const t=document.getElementById("gallery-top-anchor");t&&t.scrollIntoView({behavior:"smooth"})},ae=()=>{R(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{$(!0)})})},y=()=>{$(!1),setTimeout(()=>{R(!1)},500)},Ne=()=>{Y("add"),x({src:"",caption:"",month:"Januari",year:new Date().getFullYear().toString(),timestamp:Date.now()}),ae()},le=(t,s)=>{t.stopPropagation(),Y("edit"),x({...s}),ae()},re=(t,s)=>{t.stopPropagation(),s&&F(s)},oe=(t,s)=>{t.stopPropagation(),B(s),j.current&&(j.current.value="",j.current.click())},ke=async t=>{var r;const s=(r=t.target.files)==null?void 0:r[0];if(s&&q){const i=q;V(i);try{const m=await he(s);await me(i,{src:m}),C(N=>N.map(D=>D.id===i?{...D,src:m}:D)),a&&a.id===i&&g(N=>N?{...N,src:m}:null),d("Foto berhasil diganti!")}catch(m){console.error("Gagal ganti foto:",m),d("Gagal mengganti foto.")}finally{V(null),B(null)}}},Ce=async()=>{if(!M)return;const t=M;K(t),F(null);try{await Ge(t),C(s=>s.filter(r=>r.id!==t)),(a==null?void 0:a.id)===t&&c(null),d("Foto berhasil dihapus.")}catch(s){console.error(s),d("Gagal menghapus foto. Cek koneksi internet."),G()}finally{K(null)}},Se=async()=>{if(!o.src||!o.year){d("Gambar dan Tahun wajib diisi.");return}U(!0);try{P==="add"?await Le(o):o.id&&(await me(o.id,o),a&&a.id===o.id&&g(o)),y(),d(P==="add"?"Foto ditambahkan!":"Foto diperbarui!"),G()}catch(t){console.error(t),d("Gagal menyimpan data.")}finally{U(!1)}},Ee=async t=>{var r;const s=(r=t.target.files)==null?void 0:r[0];if(s){_(!0);try{const i=await he(s);x(m=>({...m,src:i}))}catch(i){console.error("Compression failed",i),d("Gagal memproses gambar.")}finally{_(!1)}}};return l.useEffect(()=>{const t=new IntersectionObserver(r=>{r.forEach(i=>{i.isIntersecting&&(i.target.classList.add("opacity-100","translate-y-0"),i.target.classList.remove("opacity-0","translate-y-10"),t.unobserve(i.target))})},{threshold:.1});return document.querySelectorAll(".scroll-reveal").forEach(r=>t.observe(r)),()=>t.disconnect()},[u,v,f]),e.jsxs("div",{className:"min-h-screen bg-white animate-fade-in pb-20",children:[e.jsx("input",{type:"file",ref:j,onChange:ke,accept:"image/*",className:"hidden"}),e.jsx(Te,{isOpen:!!M,title:"Hapus Memori?",description:"Foto ini akan dihapus secara permanen dari galeri. Tindakan ini tidak dapat dibatalkan.",confirmText:"Ya, Hapus",onConfirm:Ce,onCancel:()=>F(null)}),e.jsxs("div",{id:"gallery-top-anchor",className:"max-w-7xl mx-auto px-6 pt-12 pb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl md:text-6xl font-black text-slate-900 mb-4 tracking-tight",children:["Visual ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600",children:"Diaries"})]}),e.jsx("p",{className:"text-lg text-slate-500 max-w-2xl leading-relaxed",children:"Koleksi momen acak, dikelompokkan berdasarkan waktu."})]}),k&&e.jsxs("button",{onClick:Ne,className:"bg-slate-900 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2 hover:bg-slate-800 transition-all shadow-lg active:scale-95",children:[e.jsx(ne,{className:"w-5 h-5"}),"Add Memory"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-8",children:pe.map(t=>e.jsx("button",{onClick:()=>fe(t),className:`px-5 py-2 rounded-full text-sm font-bold transition-all duration-300 ${f===t?"bg-slate-900 text-white shadow-lg shadow-slate-900/20":"bg-slate-50 text-slate-500 hover:bg-slate-100 hover:text-slate-900"}`,children:t},t))})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6",children:[S&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-slate-200 border-t-slate-900 rounded-full animate-spin"}),e.jsx("p",{className:"text-slate-400 text-sm font-medium",children:"Memuat Galeri..."})]}),!S&&n.length===0&&e.jsxs("div",{className:"text-center py-20 border-2 border-dashed border-slate-200 rounded-3xl",children:[e.jsx(ie,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 font-medium",children:"Belum ada foto di periode ini."})]}),!S&&W.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-16",children:je.map(t=>e.jsxs("div",{className:"animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center gap-6 mb-8 mt-4",children:[e.jsx("span",{className:"text-3xl md:text-4xl font-black text-slate-900 tracking-tighter",children:t}),e.jsx("div",{className:"h-0.5 bg-slate-200 flex-1 rounded-full opacity-50"})]}),e.jsx("div",{className:"columns-1 sm:columns-2 lg:columns-3 gap-6 space-y-6",children:X[t].map(s=>e.jsxs("div",{className:"break-inside-avoid relative group cursor-pointer rounded-2xl overflow-hidden bg-slate-100 shadow-sm hover:shadow-lg transition-all duration-700 transform translate-z-0 scroll-reveal opacity-0 translate-y-10",onClick:()=>c(s),children:[J===s.id&&e.jsxs("div",{className:"absolute inset-0 z-30 bg-slate-900/50 backdrop-blur-sm flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin mb-2"}),e.jsx("span",{className:"text-white text-[10px] font-bold uppercase tracking-wider",children:"Mengganti..."})]}),e.jsx("img",{src:s.src,alt:s.caption,loading:"lazy",className:"w-full h-auto object-cover transform transition-transform duration-700 group-hover:scale-105"}),k&&e.jsxs("div",{className:"absolute top-3 right-3 z-20 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:r=>oe(r,s.id),className:"p-2.5 bg-white text-slate-700 rounded-full shadow-md hover:bg-green-50 hover:text-green-600 transition-colors border border-slate-100",title:"Ganti Foto (Quick Swap)",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:r=>le(r,s),className:"p-2.5 bg-white text-slate-700 rounded-full shadow-md hover:bg-blue-50 hover:text-blue-600 transition-colors border border-slate-100",title:"Edit Caption & Info",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("button",{onClick:r=>re(r,s.id),disabled:I===s.id,className:`p-2.5 bg-white rounded-full shadow-md transition-colors border border-slate-100 ${I===s.id?"text-slate-300 cursor-wait":"text-red-500 hover:bg-red-50"}`,title:"Hapus",children:I===s.id?e.jsx("div",{className:"w-4 h-4 border-2 border-slate-300 border-t-red-500 rounded-full animate-spin"}):e.jsx(ue,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"absolute bottom-4 left-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx("span",{className:"bg-black/30 backdrop-blur-md text-white text-[10px] font-bold px-3 py-1.5 rounded-full border border-white/20 uppercase tracking-widest shadow-sm",children:s.month})})]},s.id||s.src))})]},t))}),e.jsxs("div",{className:"flex flex-col items-center gap-3 mt-20 mb-8",children:[ge&&e.jsxs("button",{onClick:we,className:"px-6 py-3 rounded-full bg-white border border-slate-200 text-slate-700 font-bold text-xs hover:bg-slate-50 hover:text-slate-900 hover:border-slate-300 transition-all flex items-center gap-2 shadow-sm",children:["Lihat Momen Terdahulu ",e.jsx(L,{className:"w-4 h-4"})]}),ve&&e.jsxs("button",{onClick:ye,className:"text-xs font-bold text-slate-400 hover:text-slate-600 transition-colors flex items-center gap-1.5 py-2",children:["Tutup / Sembunyikan ",e.jsx(L,{className:"w-3.5 h-3.5 rotate-180"})]})]})]})]}),a&&Me.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100000] flex items-end justify-center pointer-events-none",children:[e.jsx("div",{className:`fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity duration-500 ease-in-out pointer-events-auto ${Q?"opacity-100":"opacity-0"}`,onClick:()=>c(null)}),e.jsxs("div",{className:`
                            w-full h-[95vh] md:h-[90vh] bg-white rounded-t-[2.5rem] shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.2)] 
                            overflow-hidden transform transition-transform duration-500 cubic-bezier(0.32, 0.72, 0, 1) pointer-events-auto relative flex flex-col
                            ${Q?"translate-y-0":"translate-y-full"}
                        `,onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-8 flex justify-center pt-3 z-20 bg-white cursor-pointer",onClick:()=>c(null),children:e.jsx("div",{className:"w-12 h-1.5 bg-slate-200 rounded-full"})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center relative w-full h-full p-4 md:p-8 pt-12",children:[e.jsxs("div",{className:"flex-1 w-full h-full flex items-center justify-center relative min-h-0",children:[ee&&e.jsx("button",{onClick:se,className:"absolute left-0 md:left-4 top-1/2 -translate-y-1/2 z-[100001] p-3 bg-white/80 hover:bg-white text-slate-800 rounded-full shadow-lg border border-slate-200 transition-all hover:scale-110 active:scale-95 group hidden md:block",title:"Sebelumnya (Arrow Left)",children:e.jsx(xe,{className:"w-6 h-6"})}),Z&&e.jsx("button",{onClick:te,className:"absolute right-0 md:right-4 top-1/2 -translate-y-1/2 z-[100001] p-3 bg-white/80 hover:bg-white text-slate-800 rounded-full shadow-lg border border-slate-200 transition-all hover:scale-110 active:scale-95 group hidden md:block",title:"Selanjutnya (Arrow Right)",children:e.jsx(xe,{className:"w-6 h-6 rotate-180"})}),J===a.id&&e.jsxs("div",{className:"absolute inset-0 z-30 bg-slate-900/50 backdrop-blur-sm flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-white/30 border-t-white rounded-full animate-spin mb-3"}),e.jsx("span",{className:"text-white text-xs font-bold uppercase tracking-wider",children:"Updating..."})]}),e.jsx("img",{src:a.src,alt:a.caption,className:"max-w-full max-h-full object-contain shadow-2xl rounded-lg"})]}),e.jsxs("div",{className:"w-full max-w-3xl mx-auto mt-6 text-center shrink-0 pb-8 animate-fade-in-up",children:[e.jsxs("p",{className:"text-lg md:text-xl text-slate-900 font-medium leading-relaxed",children:['"',a.caption,'"']}),e.jsx("div",{className:"mt-3 flex items-center justify-center gap-3",children:e.jsxs("div",{className:"inline-block px-3 py-1 bg-slate-100 rounded-full text-slate-600 text-xs font-bold uppercase tracking-widest border border-slate-200",children:[a.month," ",a.year]})}),k&&e.jsxs("div",{className:"flex justify-center gap-3 mt-6 pt-6 border-t border-slate-100",children:[e.jsxs("button",{onClick:t=>oe(t,a.id),className:"px-4 py-2 bg-green-50 text-green-700 hover:bg-green-100 rounded-lg text-xs font-bold flex items-center gap-2 transition-colors border border-green-100",children:[e.jsx(ce,{className:"w-3.5 h-3.5"})," Ganti Foto"]}),e.jsxs("button",{onClick:t=>le(t,a),className:"px-4 py-2 bg-blue-50 text-blue-700 hover:bg-blue-100 rounded-lg text-xs font-bold flex items-center gap-2 transition-colors border border-blue-100",children:[e.jsx(de,{className:"w-3.5 h-3.5"})," Edit Info"]}),e.jsxs("button",{onClick:t=>re(t,a.id),className:"px-4 py-2 bg-red-50 text-red-700 hover:bg-red-100 rounded-lg text-xs font-bold flex items-center gap-2 transition-colors border border-red-100",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Hapus"]})]})]})]})]})]}),document.body),be&&e.jsxs("div",{className:"fixed inset-0 z-[120] flex items-start justify-center pointer-events-none",children:[e.jsx("div",{className:`fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity duration-500 ease-in-out pointer-events-auto ${O?"opacity-100":"opacity-0"}`,onClick:y}),e.jsxs("div",{className:`
                            w-full h-[96vh] bg-white rounded-b-[2rem] shadow-2xl 
                            overflow-hidden transform transition-transform duration-500 cubic-bezier(0.32, 0.72, 0, 1) pointer-events-auto relative flex flex-col
                            ${O?"translate-y-0":"-translate-y-full"}
                        `,children:[e.jsx("div",{className:"flex-1 overflow-y-auto px-6 pt-10 pb-6 md:px-10 md:pt-10 md:pb-2",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsx("h3",{className:"text-3xl font-black text-slate-900 tracking-tight",children:P==="add"?"New Memory":"Edit Memory"}),e.jsx("button",{onClick:y,className:"w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 text-slate-500 hover:bg-slate-200 hover:text-slate-900 transition-colors",children:"âœ•"})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-8 min-h-0",children:[e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2 tracking-wide",children:"Image Source"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("label",{className:`flex-1 cursor-pointer bg-slate-50 hover:bg-blue-50 border border-slate-200 hover:border-blue-200 text-slate-600 hover:text-blue-600 rounded-xl px-4 py-3 flex items-center justify-center gap-2 transition-all group ${h?"opacity-50 pointer-events-none":""}`,children:[h?e.jsx("div",{className:"w-4 h-4 border-2 border-slate-300 border-t-blue-600 rounded-full animate-spin"}):e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-bold",children:h?"Processing...":"Upload File"}),e.jsx("input",{type:"file",accept:"image/*",onChange:Ee,className:"hidden",disabled:h})]})}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",placeholder:"Or paste image URL...",value:o.src||"",onChange:t=>x(s=>({...s,src:t.target.value})),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 text-sm focus:bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none",disabled:h})})]}),e.jsx("div",{className:"flex-1 bg-slate-50 rounded-2xl border border-slate-200 overflow-hidden relative group min-h-[200px]",children:o.src?e.jsx("img",{src:o.src,alt:"Preview",className:"w-full h-full object-contain bg-slate-100/50"}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-300",children:[e.jsx(ie,{className:"w-12 h-12 mb-2 opacity-50"}),e.jsx("span",{className:"text-sm font-bold",children:"No Image Selected"})]})})]}),e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2 tracking-wide",children:"Caption / Story"}),e.jsx("textarea",{value:o.caption||"",onChange:t=>x(s=>({...s,caption:t.target.value})),className:"flex-1 w-full px-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl text-slate-800 text-base focus:bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none resize-none leading-relaxed placeholder:text-slate-400",placeholder:"Write something about this moment..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2 tracking-wide",children:"Month"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:o.month||"Januari",onChange:t=>x(s=>({...s,month:t.target.value})),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 text-sm focus:bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none appearance-none font-bold cursor-pointer",children:["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"].map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400",children:e.jsx(L,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2 tracking-wide",children:"Year"}),e.jsx("input",{type:"number",value:o.year||"",onChange:t=>x(s=>({...s,year:t.target.value})),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 text-sm focus:bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none font-bold"})]})]}),e.jsx("div",{className:"pt-4 mt-auto",children:e.jsx("button",{onClick:Se,disabled:H||h,className:"w-full py-4 bg-slate-900 text-white rounded-xl text-base font-bold hover:bg-slate-800 disabled:opacity-50 transition-all shadow-xl shadow-slate-900/10 active:scale-[0.98] flex items-center justify-center gap-3",children:H?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"w-5 h-5"}),e.jsx("span",{children:"Save Memory"})]})})})]})]})]})}),e.jsx("div",{className:"w-full h-8 flex justify-center items-center shrink-0 cursor-pointer hover:bg-slate-50 transition-colors border-t border-slate-100",onClick:y,children:e.jsx("div",{className:"w-16 h-1.5 bg-slate-300 rounded-full"})})]})]})]})};export{$e as default};
